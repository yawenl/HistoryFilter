/*!CK:1700560396!*//*1406238972,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["ZrL6x"]); }

__d("BugBar",["Event","fbt","AsyncRequest","AsyncDialog","CSS","DOM","DataCollector","Dialog","Input","BanzaiScribe","BanzaiODS","copyProperties","ge","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){var u={};r(u,{_nub:null,_nubClasses:['bugNubInfo','bugNubWarning','bugNubFatal'],_taskTags:[],_taskSubscribers:[],_savedInput:null,_form:null,_duplicate_task_title:null,addMetadata:function(v){m.addMetadata(v);},getMetadata:function(){return m.getMetadata();},addTaskSubscribers:function(v){u._taskSubscribers=u._taskSubscribers.concat(v);},getTaskSubscribers:function(){return u._taskSubscribers;},addTaskTags:function(v){u._taskTags=u._taskTags.concat(v);},getTaskTags:function(){return u._taskTags;},reset:function(){m.reset();u._taskTags=[];},cancel:function(){var v=u._dialog;delete u._dialog;u.reset();if(v)v.hide();},initForm:function(v){var w=v.form;this._form=v.form;this.initFormField(w.logs);this.initFormField(w.metadata);setTimeout(u.setProductAreaFocus,0);},initFormField:function(v){var w;if(v.name=="logs"){try{w=m._collectLogs();v.value=JSON.stringify(w);}catch(x){q.bumpEntityKey('flytrap','client_log_failed');p.log('flytrap',x.message);}}else if(v.name=="metadata")try{w=m._collectMetadata();v.value=JSON.stringify(w);}catch(x){q.bumpEntityKey('flytrap','metadata_log_failed');p.log('flytrap',x.message);}},initNub:function(v){this._nub=v;},initScreenshotUploader:function(v){var w=l.scry(u._dialog.getRoot(),'button');v.setSubmitButtons(w);},setProductAreaFocus:function(){var v=l.scry(document.body,'select#product_category');v&&v.length&&v[0].focus();},taskCreated:function(v,w){this.cancel();var x=new n().setTitle(v).setBody(w).setButtons(n.OK).show();},subscribeSubmit:function(v,w){u._dialog=v;v.subscribe(['submit'],function(){if(this._form.duplicate_task_id){var x=this._form.duplicate_task_id.value;if(x){var y="Another report of bug: "+this._duplicate_task_title;if(!o.isEmpty(w))y=y+"\n\nAdditional description: "+w.value;o.setValue(w,y);}}if(o.getValue(w).length<4){k.show(s('bug_report_warning'));l.setContent(s('bug_report_warning'),"Please provide more details about the problem you are experiencing.");return false;}if(this._form.product_category_id.value=='100977986739334'){k.show(s('bug_report_warning'));l.setContent(s('bug_report_warning'),"Please select a product.");return false;}}.bind(this));},fillSavedDescription:function(v){v=s(v);this._savedInput=this._savedInput||"Sorry, we lost your original description :(";l.setContent(v,this._savedInput);},hide:function(){if(u._dialog){k.hide(u._dialog.getRoot());return true;}return false;},unhide:function(){if(u._dialog){k.show(u._dialog.getRoot());var v=JSON.parse(this._form.debuginfo.value);v.additionalmetadata=v.additionalmetadata||{};r(v.additionalmetadata,u.getMetadata());this._form.debuginfo.value=JSON.stringify(v);return true;}return false;},openBugDialog:function(v){if(u._dialog)return false;var w=new i(v);j.send(w,function(x){x.subscribe('cancel',u.cancel);});},registerMeToo:function(v,w,x,y,z){g.listen(v,'click',function(event){k.show(s('bug_report_warning'));l.setContent(s('bug_report_warning'),['When you submit this bug report, it will be merged into task ',l.create('a',{href:z},"#"+x+": "+y),'. '+'It is optional to include a description. Please hit submit!']);this._form.duplicate_task_id.value=x;this._duplicate_task_title=y;}.bind(this));},setNubLevel:function(v){if(this._nub){this._nubClasses.forEach(function(w){k.removeClass(this._nub,w);}.bind(this));k.addClass(this._nub,this._nubClasses[v]);}}});e.exports=u;},null);