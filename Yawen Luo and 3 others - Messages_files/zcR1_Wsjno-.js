/*!CK:1585398816!*//*1409753509,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["C3juU"]); }

__d("PUWMethods",[],function(a,b,c,d,e,f){e.exports={DRAGDROP:"dragdrop",FILE_SELECTOR:"file_selector",VAULT:"vault",RECENT_PHOTOS:"recent_photos",PHOTOS_OF_YOU:"photos_of_you",METHOD_EDITOR:"editor",SUGGESTIONS:"suggestions"};},null);
__d("fileSlice",["UserAgent_DEPRECATED"],function(a,b,c,d,e,f,g){var h='slice',i,j;if(i=g.chrome()){if(i<21)h='webkitSlice';}else if(i=g.firefox()){if(i<13)h='mozSlice';}else if(!(i=g.safari()))if(g.webkit())h='webkitSlice';j=a.File&&a.File.prototype[h];e.exports=j;},null);
__d("VideoUploadFeatureDetector",["UserAgent_DEPRECATED","fileSlice"],function(a,b,c,d,e,f,g,h){var i={supportsChunking:function(){return (typeof h==='function')&&this.supportsXHR();},supportsFullProgress:function(){return !g.firefox();},supportsFileAPI:function(){return ('FileList' in window);},supportsFileReading:function(){return ('FileReader' in window&&'DataView' in window);},supportsXHR:function(){return ('FormData' in window);}};e.exports=i;},null);
__d("VideoUploadFile",["fileSlice","VideoUploadFeatureDetector"],function(a,b,c,d,e,f,g,h){function i(j){"use strict";this.$VideoUploadFile0=j;this.$VideoUploadFile1=i.getExtensionFromFileInput(j);if(h.supportsFileAPI()&&j.files.length){this.$VideoUploadFile2=j.files[0];this.$VideoUploadFile3=this.$VideoUploadFile2.size;}else{this.$VideoUploadFile2=null;this.$VideoUploadFile3=null;}}i.prototype.getFileInput=function(){"use strict";return this.$VideoUploadFile0;};i.prototype.getFile=function(){"use strict";return this.$VideoUploadFile2;};i.prototype.getSize=function(){"use strict";return this.$VideoUploadFile3;};i.prototype.getExtension=function(){"use strict";return this.$VideoUploadFile1;};i.prototype.getChunk=function(j,k){"use strict";return this.$VideoUploadFile2?g.call(this.$VideoUploadFile2,j,k):null;};i.getExtensionFromFileInput=function(j){"use strict";return j.value.indexOf('.')!=-1?j.value.split('.').pop().toLowerCase():'';};e.exports=i;},null);
__d("ComposerXMediaUploadHandler",["Arbiter","ComposerXAjaxEndpoint","ComposerXController","Dialog","VideoUploadConfig","VideoUploadFile","fbt","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=h.MEDIA_UPLOAD,p='/ajax/composerx/attachment/video/upload/';function q(r,s){"use strict";this.$ComposerXMediaUploadHandler0=r;this.$ComposerXMediaUploadHandler1=s;}q.prototype.fetchAttachments=function(){"use strict";[this.getPhotoUploadAttachmentEndpoint(),p].forEach(function(r){i.fetchAttachmentData(this.$ComposerXMediaUploadHandler0,r);}.bind(this));};q.prototype.handleFileSelected=function(r){"use strict";if(q.isVideoFile(r)){this.handleVideoSelected(r);}else this.handlePhotoSelected(r);};q.prototype.handleVideoSelected=function(r){"use strict";if(this.$ComposerXMediaUploadHandler1&&this.$ComposerXMediaUploadHandler1.imagesOnly){var s=new j().setModal(true).setButtons([j.OK]);if(this.$ComposerXMediaUploadHandler1.isEditComposer){s.setTitle("Can't add video").setBody("Sorry, you can't add a video to a post you're editing.");}else s.setTitle("Invalid Image File").setBody("Please upload a valid image file.");s.show();return;}i.getAttachment(this.$ComposerXMediaUploadHandler0,p);g.inform('ComposerXFilesStore/filesAdded/'+this.$ComposerXMediaUploadHandler0+'/videoupload',{fileInput:r},g.BEHAVIOR_PERSISTENT);};q.prototype.handlePhotoSelected=function(r){"use strict";i.getAttachment(this.$ComposerXMediaUploadHandler0,this.getPhotoUploadAttachmentEndpoint());g.inform('ComposerXFilesStore/filesAdded/'+this.$ComposerXMediaUploadHandler0+'/mediaupload',{fileInput:r},g.BEHAVIOR_PERSISTENT);};q.isVideoFile=function(r){"use strict";var s=l.getExtensionFromFileInput(r.getInput());return !!k.videoExtensions[s];};q.prototype.$ComposerXMediaUploadHandler2=function(){"use strict";return (this.$ComposerXMediaUploadHandler1)?this.$ComposerXMediaUploadHandler1.photoUploadOverrideEndpoint:null;};q.prototype.getPhotoUploadAttachmentEndpoint=function(){"use strict";var r=this.$ComposerXMediaUploadHandler2();return (r)?r:o;};e.exports=q;},null);
__d("BanzaiScribe",["Banzai"],function(a,b,c,d,e,f,g){function h(j){return {log:function(k,l,m){var n=[l];if(m!=null)n.push(m);g.post('scribe:'+k,n,j);}};}var i=h({});i.create=h;e.exports=i;},null);
__d("SamplingPolicyBase",[],function(a,b,c,d,e,f){function g(){"use strict";throw 'Tried to instantiate SamplingPolicyBase';}g.prototype.getName=function(){"use strict";return this.name;};g.prototype.isSampled=function(){"use strict";if(typeof(this.sampled)=='undefined')this.sampled=this.decideIfSampled();return this.sampled;};e.exports=g;},null);
__d("FbtraceForcedByServerPolicy",["FbtraceForcedByServer","SamplingPolicyBase","copyProperties"],function(a,b,c,d,e,f,g,h,i){'use strict';var j;function k(){this.name='FbtraceForcedByServerPolicy';}k.get=function(){if(typeof(j)=='undefined')j=new k();return j;};function l(){return g.forced;}i(k.prototype,h.prototype,{decideIfSampled:l});e.exports=k;},null);
/**
 * @generated SignedSource<<091461a353d9b40c12f5a66d653a6b62>>
 * 
 * !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 * !! This file is a check-in of a static_upstream project!      !!
 * !!                                                            !!
 * !! You should not modify this file directly. Instead:         !!
 * !! 1) Use `fjs use-upstream` to temporarily replace this with !!
 * !!    the latest version from upstream.                       !!
 * !! 2) Make your changes, test them, etc.                      !!
 * !! 3) Use `fjs push-upstream` to copy your changes back to    !!
 * !!    static_upstream.                                        !!
 * !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 * 
 * Copyright (C) 2010 by Johannes Baagoe <baagoe@baagoe.org>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 * @providesModule Alea
 * @preserve-header
 */__d("Alea",[],function(a,b,c,d,e,f){function g(){var i=4022871197,j=function(k){k=k.toString();for(var l=0;l<k.length;l++){i+=k.charCodeAt(l);var m=.02519603282416938*i;i=m>>>0;m-=i;m*=i;i=m>>>0;m-=i;i+=m*4294967296;}return (i>>>0)*2.3283064365386963e-10;};j.version='Mash 0.9';return j;}function h(){return (function(i){var j=0,k=0,l=0,m=1;if(i.length===0)i=[new Date()];var n=new g();j=n(' ');k=n(' ');l=n(' ');for(var o=0;o<i.length;o++){j-=n(i[o]);if(j<0)j+=1;k-=n(i[o]);if(k<0)k+=1;l-=n(i[o]);if(l<0)l+=1;}n=null;var p=function(){var q=2091639*j+m*2.3283064365386963e-10;j=k;k=l;l=q-(m=q|0);return l;};p.version='Alea 0.9';p.args=i;return p;}(Array.prototype.slice.call(arguments)));}e.exports=h;},null);
__d("Random",["Alea","ServerNonce"],function(a,b,c,d,e,f,g){'use strict';var h=b('ServerNonce').ServerNonce,i=g(h),j={random:i,uint32:function(){return Math.floor(i()*4294967296);}};e.exports=j;},null);
__d("Fbtrace",["Arbiter","BanzaiScribe","ErrorUtils","FbtraceForcedByServer","FbtraceForcedByServerPolicy","Random","SiteData","copyProperties","guardFunction"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){'use strict';var p='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/',q='AAAAAAAAAAA';for(var r in Error)if(Error.hasOwnProperty(r))t[r]=Error[r];var s=Error===null?null:Error.prototype;t.prototype=Object.create(s);t.prototype.constructor=t;t.__superConstructor__=Error;function t(ia){Error.call(this,ia);}function u(ia){i.reportError(new t(ia));}function v(){var ia=function(){var la=0,ma=0,na='';for(var oa=10;oa>=0;oa--){if(la<6){ma=l.uint32();la=32;}if(oa===0)ma=ma&7;na=p.charAt(ma&63)+na;ma>>=6;la-=6;}return na;},ja,ka;for(ja=3;ja>0;ja--){ka=ia();if(ka!=q)return ka;}u('failed to generate valid Fbtrace id');return q;}function w(){n(this,w);}n(w,{isOn:function(){return false;},replySend:function(ia,ja){},requestSend:function(ia,ja,ka){ca(ia,ja);return {metadata:function(){return undefined;},replyReceive:function(la){}};}});var x=new w();function y(ia,ja,ka){if(!ia)throw {name:'ArgumentError',message:'no valid service name specified'};if(!ja)throw {name:'ArgumentError',message:'no valid version specified'};var la=h,ma=0,na=v(),oa=v(),pa=ba(na),qa={service:ia,version:ja},ra=function(wa){if(typeof(wa)=='undefined')return 'undefined';if(typeof(wa)!='string')wa=ra(JSON.stringify(wa));return wa;},sa=function(wa){var xa='';for(var ya in wa){if(xa.length>0)xa+='\x02';xa+=ra(ya)+'\x03'+ra(wa[ya]);}return xa;},ta=function(wa,xa,event,ya,za){ma++;return [za,ma,na,wa,xa,ra(event),sa(ya)].join('\x01');},ua=function(wa,xa,event,ya,za){if(!za&&typeof(za)=='undefined')za=Date.now()*1000;var ab=ta(wa,xa,event,ya,za);la.log('fbtrace',ab,pa);},va=function(){return oa;};ua(q,oa,'#rqrecv',n(ka,qa));n(this,y);n(this,{replySend:function(wa,xa){xa=n(xa,qa,{success:wa?'true':'false'});ua(q,oa,'#rpsend',xa);},requestSend:function(wa,xa,ya){ca(wa,xa);var za=va(),ab=v();ya=n(ya,qa,{op:wa,'remote:service':xa});ua(za,ab,'#rqsend',ya);return {metadata:function(){return na+ab;},replyReceive:function(bb){ua(za,ab,'#rprecv',n(bb,qa));},parentNode:this};}});}n(y,{isOn:function(){return true;}});function z(){return x;}function aa(ia,ja,ka){ka=ka||{};ka.init=true;var la=k.get();if(la.isSampled()){return new y(ia,ja,ka);}else return new w();}function ba(ia){var ja=ia.charAt(ia.length-1);return p.indexOf(ja)%32;}function ca(ia,ja){if(!ia)throw {name:'ArgumentError',message:'no valid operation specified'};if(!ja)throw {name:'ArgumentError',message:'no valid remote:service specified'};}function da(ia,ja){var ka=x,la;x=ia;try{la=ja();}finally{x=ka;}return la;}var ea=function(ia,ja){var ka=z(),la=ja.request;if(!ka.isOn()&&j.forced&&/\/upload\/(?:composer|photos)\/|\/ajax\/composerx\/attachment\/media\//.test(la.uri.toString()))ka=aa('photo_upload_kludge',String(m.revision||'dev'),{policy:'PhotoUpload'});if(ka.isOn()){var ma={policy:'PhotoUpload'};if(la.userActionId)ma.user_action_id=la.userActionId;var na=ka.requestSend(la.uri.toString(),'www',ma);la.fbtraceRemoteNode=na;la.transport.setRequestHeader('X-Fbtrace-Meta',na.metadata());}},fa=function(ia,ja){ja.request.fbtraceRemoteNode.replyReceive({is_last:ja.response.is_last,success:true});setTimeout(function(){ja.request.fbtraceRemoteNode.parentNode.replySend(true,{});},0);},ga=function(ia,ja){ja.request.fbtraceRemoteNode.replyReceive({is_last:ja.response.is_last,success:false,error_code:ja.response.error,error_summary:ja.response.errorSummary,error_description:ja.response.errorDescription});setTimeout(function(){ja.request.fbtraceRemoteNode.parentNode.replySend(false,{});},0);},ha=function(ia,ja){return ja.request.fbtraceRemoteNode;};g.subscribe('AsyncRequest/send',ea);g.subscribe('AsyncRequest/response',o(ha,fa));g.subscribe('AsyncRequest/error',o(ha,ga));e.exports={defaultNode:z,requestReceive:aa,withDefaultNode:da};},null);
__d("PhotosMultiUploadInput",["Arbiter","Animation","AsyncUploadRequest","ComposerXController","ComposerXDragDrop","ComposerXMediaUploadHandler","CSS","Dialog","DOM","DOMQuery","DragDropTarget","Event","FileInputUploader","JpegResizer","JSLogger","Parent","PhotosMimeType","PhotosUploadID","PhotosUploadWaterfallXMixin","PUWApplications","PUWMethods","PUWSteps","ProgressBar","WaterfallIDGenerator","$","copyProperties","createArrayFrom","csx","cx","mixin","performanceNow","tx","updatePhotoProgressBar","Fbtrace"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma){var na=u.create('composer');b("Fbtrace");function oa(xa,ya,za,ab){"use strict";this._grid=ua.getInstance(ab.gridID);this._grid.setProgressBarMarkup(xa).setVideoIconMarkup(ya).setConfig(ab);za.getInput().multiple=(ab.maxselect!=1)&&i.isSupported();za.subscribe('change',function(bb,event){if(event.getTarget().value)this._grid.doFileUpload(za);}.bind(this));if(!this._grid.sessionStarted){this._grid.sessionStarted=true;this._grid.logStep(ba.CLIENT_FLOW_BEGIN);}this._grid.logStep(ba.CLIENT_SELECT_BEGIN);g.inform('PhotosMultiUploadInput/loaded/'+ab.gridID,null,g.BEHAVIOR_PERSISTENT);}oa.prototype.getGrid=function(){"use strict";return this._grid;};fa(oa,{imageUploadDone:function(xa,ya,za,ab){pa[xa].imageUploadDone(ya,za,ab);},initDragDrop:function(xa,ya){g.inform('PhotosMultiUploadInput/initDragDrop/'+xa,{dragDropArea:ya},g.BEHAVIOR_PERSISTENT);},imageUploadFail:function(xa,ya){pa[xa].removeLoadingIndicator(ya.getFile().uploadID);},doFileUpload:function(xa,ya){pa[xa].doFileUpload(ya);},onFilesDrop:function(xa,ya){pa[xa].onFilesDrop(ya);},getWaterfallID:function(xa){return ua.getInstance(xa).getWaterfallID();},clearSession:function(xa){pa[xa].clearSession();},getConfig:function(xa){return pa[xa].getConfig();}});var pa={},qa=0,ra=ja(y);for(var sa in ra)if(ra.hasOwnProperty(sa))ua[sa]=ra[sa];var ta=ra===null?null:ra.prototype;ua.prototype=Object.create(ta);ua.prototype.constructor=ua;ua.__superConstructor__=ra;function ua(xa){"use strict";this._loadingIndicators={};this._numRemainingFiles=0;this._progressBarMarkup=null;this._videoIconMarkup=null;this._gridID=xa;this._dragDropTarget=null;this._submitListener=null;this._fileInputInstances=[];this._uploadTimers={};this._sessionsStarted=false;this._waterfallID=null;this._resizer=null;this._numUploadsSucceeded=0;this._numUploadsFailed=0;g.subscribe('multi-upload/video-removed/'+this._gridID,function(){o.remove(this._videoIconMarkup);this._submitListener&&this._submitListener.remove();this._submitListener=null;this._fileInputInstances.forEach(function(ya){ya.clear();});}.bind(this));g.subscribe('PhotosMultiUploadInput/initDragDrop/'+xa,function(ya,za){this.initDragDrop(za.dragDropArea);}.bind(this));g.subscribe('AttachmentsPhotoEditor/newImage'+xa,this._onEditedImage.bind(this));}ua.prototype.getWaterfallID=function(){"use strict";if(!this._waterfallID)this._waterfallID=da.generate();return this._waterfallID;};ua.prototype.getWaterfallAppName=function(){"use strict";return z.WEB_COMPOSER;};ua.prototype.getLoadingIndicator=function(xa){"use strict";var ya=this._loadingIndicators[xa];return ya;};ua.prototype.initDragDrop=function(xa){"use strict";this._dragDropTarget&&this._dragDropTarget.disable();this._dragDropTarget=new q(xa).setOnFilesDropCallback(this.onFilesDrop.bind(this)).setFileFilter(k.filterImages).enable();};ua.prototype.setConfig=function(xa){"use strict";this._config=xa;if(!t.isSupported()){this.logStep(ba.CLIENT_PROCESS_UNAVAILABLE);}else if(this._config.useResizer)this._resizer=new t(this._config.maxselect===1?1:t.DEFAULT_POOL_SIZE);if(!this._waterfallID)this._waterfallID=xa.waterfallID;return this;};ua.prototype.setProgressBarMarkup=function(xa){"use strict";this._progressBarMarkup=xa;return this;};ua.prototype.setVideoIconMarkup=function(xa){"use strict";this._videoIconMarkup=xa;var ya=o.find(xa,"._3ev");r.listen(ya,'click',this._onVideoRemoved.bind(this));return this;};ua.prototype.imageUploadDone=function(xa,ya,za){"use strict";this._numUploadsSucceeded++;var ab=this.getLoadingIndicator(ya);if(!ab)return;if(o.contains(document.body,ab.getRoot()))o.replace(ab.getRoot(),xa);var bb={};bb[ya]=za;g.inform(['multi-upload/images-added/'+this._gridID,'multi-upload/images-added'],{fbids:bb,tagInfo:{}});this._numRemainingFiles--;if(this._numRemainingFiles===0)this._finishUploadBatch();this._loadingIndicators[ya]=null;};ua.prototype._generateLoadingIndicator=function(xa){"use strict";this._numRemainingFiles++;var ya=this._progressBarMarkup.cloneNode(true);this.insertIntoGrid(ya);this._loadingIndicators[xa]=new ca(ya);};ua.prototype._generateUploadIDsAndLoadingIndicators=function(xa){"use strict";for(var ya=0;ya<xa.length;ya++){if(!xa[ya].uploadID)xa[ya].uploadID=x.getNewID();this._generateLoadingIndicator(xa[ya].uploadID);}};ua.prototype.fileUploadFailure=function(xa,ya){"use strict";this._numUploadsFailed++;var za=Date.now()-this._uploadTimers[xa],ab=0;if(ya.upload)ab=ya.upload.getRetryCount?ya.upload.getRetryCount():0;this.logStep(ba.CLIENT_TRANSFER_FAIL,{dt:za,error_code:ya.response.getError(),error_info:ya.response.getErrorDescription(),bytes:ya.upload.getFile().size,auto_retry_count:ab});this._showUploadFailedMessage(xa);this._fadeOutFileUpload(xa);};ua.prototype._fadeOutFileUpload=function(xa){"use strict";new h(this.getLoadingIndicator(xa).getRoot()).duration(2000).checkpoint().from('opacity',1).to('opacity',0).duration(1000).ondone(this.removeFileUpload.bind(this,xa)).go();};ua.prototype._showUploadFailedMessage=function(xa){"use strict";m.hide(p.find(this.getLoadingIndicator(xa).getRoot(),"._5l83"));m.show(p.find(this.getLoadingIndicator(xa).getRoot(),"._5l82"));};ua.prototype._finishUploadBatch=function(){"use strict";g.inform('multi-upload/images-upload-completed/'+this._gridID);if(this._numUploadsFailed>0){this.logStep(ba.CLIENT_TRANSFER_BATCH_FAIL,{volume:this._numUploadsFailed,batch_size:this._numUploadsSucceeded+this._numUploadsFailed});}else this.logStep(ba.CLIENT_TRANSFER_BATCH_SUCCESS,{volume:this._numUploadsSucceeded});this._numUploadsSucceeded=0;this._numUploadsFailed=0;};ua.prototype.fileUploadCanceled=function(xa,ya){"use strict";var za={latency:Date.now()-this._uploadTimers[xa]};if(ya.upload&&ya.upload.getFile())za.bytes=ya.upload.getFile().size;this.logStep(ba.CLIENT_TRANSFER_CANCEL,za);this.removeFileUpload(xa);};ua.prototype.removeFileUpload=function(xa){"use strict";this._numRemainingFiles=Math.max(0,this._numRemainingFiles-1);this.removeLoadingIndicator(xa);if(this._numRemainingFiles===0)this._finishUploadBatch();};ua.prototype.doFileUpload=function(xa){"use strict";var ya=false,za=false;switch(this._config.supportedFileTypes){case 'photos':za=true;break;case 'videos':ya=true;break;case 'both':ya=za=true;break;}var ab=ya&&l.isVideoFile(xa);this._submitListener&&this._submitListener.remove();if(ab){var bb=v.byTag(ea(this._gridID),'form'),cb=j.getComposerID(bb),db=new l(cb);db.handleVideoSelected(xa);}else if(za){this._photosSelected(xa);}else new n().setBody("Sorry, you can only select video files.").setTitle("Unsupported File").setModal(true).setButtons(n.OK).show();};ua.prototype.getConfig=function(){"use strict";return this._config;};ua.prototype._resizeUpload=function(xa,ya){"use strict";var za=xa.getFile();if(!za||!w(za.type).isJpeg())return ya(xa);var ab=ka();this.logStep(ba.CLIENT_PROCESS_BEGIN,{bytes:za.size});this._resizer.resizeBlob(za,function(bb,cb,db){cb=cb||za;if(bb){this.logStep(ba.CLIENT_PROCESS_FAIL,{dt:ka()-ab,bytes:cb.size,error_code:bb.code,error_info:bb.message});return ya(xa);}cb.uploadID=za.uploadID;xa.setFile(cb);this.logStep(ba.CLIENT_PROCESS_SUCCESS,{dt:ka()-ab,media_data_size:za.size,bytes:cb.size,custom_tags:{skipped_resizing:db}});ya(xa);}.bind(this),this._onResizeProgress.bind(this,za.uploadID));};ua.prototype._isExceedMaxSelect=function(xa){"use strict";return this._config.maxselect>1&&xa>this._config.maxselect;};ua.prototype._showTooManyPhotosDialog=function(){"use strict";new n().setTitle("Too Many Photos").setBody(la._("Sorry, you can only add {maxselect} photos to a message. If you'd like, you can add photos to additional messages.",{maxselect:this._config.maxselect})).setButtons(n.OK).setModal(true).show();};ua.prototype._photosSelected=function(xa){"use strict";var ya=xa.getInput(),za=va(ya);if(this._isExceedMaxSelect(za)){this._showTooManyPhotosDialog();return;}this._onBeforeAddUploadedImages();var ab=this._config.uploadData,bb=null;if(!wa(ya)){ya.uploadID=x.getNewID();this._generateLoadingIndicator(ya.uploadID);ab.upload_id=ya.uploadID;}else{bb=ga(ya.files);this._generateUploadIDsAndLoadingIndicators(bb);}g.inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:za});if(this._config.waterfallID)ab.qn=this._config.waterfallID;var cb=new s(ya).setURI(this._config.photoEndpoint).setData(ab).setAllowCrossOrigin(true).setNetworkErrorRetryLimit(this._config.retryLimit).setUploadInParallel(true);if(bb){cb.setFiles(bb);if(this._resizer)cb.setPreprocessHandler(this._resizeUpload.bind(this));}cb.subscribe('progress',function(eb,fb){this._onUploadProgress(this._getUploadID(fb,ya),fb);}.bind(this));cb.subscribe('failure',function(eb,fb){this.fileUploadFailure(this._getUploadID(fb,ya),fb);}.bind(this));cb.subscribe('start',function(eb,fb){this._onFileUploadStart(this._getUploadID(fb,ya),fb);}.bind(this));cb.subscribe('success',function(eb,fb){this._onFileUploadSuccess(this._getUploadID(fb,ya),fb);}.bind(this));try{cb.send();xa.clear();}catch(db){na.error('error_send_unpublished_files',db);throw db;}this.logStep(ba.CLIENT_SELECT_SUCCESS,{times_selected:qa++,volume:za,method:'file_selector'});};ua.prototype._onVideoRemoved=function(){"use strict";this._dragDropTarget&&this._dragDropTarget.enable();g.inform('multi-upload/video-removed/'+this._gridID);};ua.prototype.removeLoadingIndicator=function(xa){"use strict";var ya=this.getLoadingIndicator(xa);ya&&o.remove(ya.getRoot());delete this._loadingIndicators[xa];};ua.prototype._onFileUploadStart=function(xa,ya){"use strict";var za=o.find(this.getLoadingIndicator(xa).getRoot(),"._639");m.show(za);r.listen(za,'click',function(){if(ya.upload)ya.upload.abort();this.fileUploadCanceled(xa,ya);}.bind(this));this._uploadTimers[xa]=Date.now();var ab={};if(ya.upload&&ya.upload.getFile())ab.size=ya.upload.getFile().size;this.logStep(ba.CLIENT_TRANSFER_BEGIN,ab);};ua.prototype._onUploadProgress=function(xa,ya){"use strict";var za=this.getLoadingIndicator(xa);if(!za)return;this._showProgressBar(za);m.removeClass(za.getRoot(),"_5v_0");ma(za,ya.event);};ua.prototype._onResizeProgress=function(xa,event){"use strict";var ya=this.getLoadingIndicator(xa);if(!ya)return;this._showProgressBar(ya);m.addClass(ya.getRoot(),"_5v_0");ya.setPosition(100*event.written/event.total);};ua.prototype._showProgressBar=function(xa){"use strict";m.hide(o.find(xa.getRoot(),"._2om"));m.show(o.find(xa.getRoot(),"._5e4h"));};ua.prototype._onFileUploadSuccess=function(xa,ya){"use strict";var za=Date.now()-this._uploadTimers[xa],ab={dt:za};if(ya.upload){ab.bytes=ya.upload.getFile().size;ab.auto_retry_count=ya.upload.getRetryCount?ya.upload.getRetryCount():0;}this.logStep(ba.CLIENT_TRANSFER_SUCCESS,ab);};ua.prototype._onEditedImage=function(xa,ya){"use strict";this._onBeforeAddUploadedImages();this.logStep(ba.CLIENT_SELECT_BEGIN);this._generateUploadIDsAndLoadingIndicators([ya]);g.inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:1,method:aa.EDITOR});var za=new i().setData(this._config.uploadData).setFiles([ya]).setAllowCrossOrigin(true).setURI(this._config.photoEndpoint);za.subscribe('failure',function(ab,bb){this.fileUploadFailure(bb.getFile().uploadID,{upload:bb,response:bb.getResponse()});}.bind(this));za.subscribe('progress',function(ab,bb){this._onUploadProgress(bb.getFile().uploadID,{upload:bb,event:bb.getProgressEvent()});}.bind(this));za.subscribe('start',function(ab,bb){this._onFileUploadStart(bb.getFile().uploadID,{upload:bb});}.bind(this));za.subscribe('success',function(ab,bb){this._onFileUploadSuccess(bb.getFile().uploadID,{upload:bb});}.bind(this));za.send();this.logStep(ba.CLIENT_SELECT_SUCCESS,{volume:1,method:aa.EDITOR});};ua.prototype.onFilesDrop=function(xa){"use strict";if(this._isExceedMaxSelect(xa.length)){this._showTooManyPhotosDialog();return;}this._onBeforeAddUploadedImages();this.logStep(ba.CLIENT_SELECT_BEGIN);this._generateUploadIDsAndLoadingIndicators(xa);g.inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:xa.length,method:aa.DRAGDROP||'dragdrop'});var ya=new i().setData(this._config.uploadData).setFiles(xa).setAllowCrossOrigin(true).setURI(this._config.photoEndpoint);if(this._resizer)ya.setPreprocessHandler(this._resizeUpload.bind(this));ya.subscribe('failure',function(za,ab){this.fileUploadFailure(ab.getFile().uploadID,{upload:ab,response:ab.getResponse()});}.bind(this));ya.subscribe('progress',function(za,ab){this._onUploadProgress(ab.getFile().uploadID,{upload:ab,event:ab.getProgressEvent()});}.bind(this));ya.subscribe('start',function(za,ab){this._onFileUploadStart(ab.getFile().uploadID,{upload:ab});}.bind(this));ya.subscribe('success',function(za,ab){this._onFileUploadSuccess(ab.getFile().uploadID,{upload:ab});}.bind(this));ya.send();this.logStep(ba.CLIENT_SELECT_SUCCESS,{volume:xa.length,method:'drag_drop'});};ua.prototype._onBeforeAddUploadedImages=function(){"use strict";if(!this.sessionStarted)this.logStep(ba.CLIENT_FLOW_BEGIN);if(this._config.maxselect==1)g.inform('multi-upload/composer-reset/'+this._gridID);this.sessionStarted=true;};ua.prototype.clearSession=function(){"use strict";this.sessionStarted=false;};ua.prototype.insertIntoGrid=function(xa){"use strict";var ya=o.scry(ea(this._gridID),"._577")[0];if(ya){o.insertBefore(ya,xa);}else o.prependContent(ea(this._gridID),xa);};ua.prototype._getUploadID=function(xa,ya){"use strict";if(xa.upload){return xa.upload.getFile().uploadID;}else return ya.uploadID;};ua.getInstance=function(xa){"use strict";pa[xa]=pa[xa]||new ua(xa);return pa[xa];};function va(xa){if(!wa(xa))return 1;return xa.files.length;}function wa(xa){return !!xa.files&&i.isSupported();}e.exports=oa;},null);
__d("TimelineMapScrollableArea",["Animation","ArbiterMixin","CSS","DOM","Event","Run","SimpleDrag","Style","Vector","$","copyProperties","shield"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){function s(t,u){t&&this.init(p(t),u);}q(s.prototype,h,{init:function(t,u){u=u||{};this._elem=t;this._wrap=j.find(t,'div.fbScrollableAreaWrap');this._body=j.find(this._wrap,'div.fbScrollableAreaBody');this._track=j.find(t,'div.fbScrollableAreaTrack');this._gripper=j.find(this._track,'div.fbScrollableAreaGripper');this._options=u;this.adjustGripper();this._listeners=[k.listen(this._wrap,'scroll',this._handleScroll.bind(this))];if(u.fade!==false)this._listeners.push(k.listen(t,'mouseenter',r(this.adjustGripper,this)),k.listen(t,'mouseenter',r(this.showScrollbar,this)),k.listen(t,'mousemove',this._handleMousemove.bind(this)),k.listen(t,'mouseout',r(this.hideScrollbar,this)));if(u.fade!==undefined)this._listeners.push(k.listen(this._track,'click',this.clickToScroll.bind(this)));if(u.verticalscroll)this._listeners.push(k.listen(this._wrap,'mousewheel',this.mouseWheel.bind(this)),k.listen(this._wrap,'DOMMouseScroll',this.mouseWheel.bind(this)));this.initDrag();if(!u.persistent)l.onLeave(this.destroy.bind(this));},getRoot:function(){return this._elem;},initDrag:function(){var t=new m(this._gripper);t.subscribe('start',function(u,event){if(!((event.which&&event.which===1)||(event.button&&event.button===1)))return;this.inform('dragstart');var v=o.getEventPosition(event).x,w=this._gripper.offsetLeft,x=t.subscribe('update',function(z,aa){var ba=o.getEventPosition(aa).x-v,ca=this._elem.clientWidth,da=this._body.offsetWidth,ea=this._track.offsetWidth,fa=ca/da*ea,ga=da-this._wrap.offsetWidth,ha=w+ba,ia=ea-fa;ha=Math.max(Math.min(ha,ia),0);var ja=ha/ia*ga;this._wrap.scrollLeft=ja;}.bind(this)),y=t.subscribe('end',function(){t.unsubscribe(x);t.unsubscribe(y);this.inform('dragend');}.bind(this));}.bind(this));},adjustGripper:function(){var t=this._elem.clientWidth,u=this._body.offsetWidth,v=this._track.offsetWidth,w=t/u*v;if(w<v){n.set(this._gripper,'width',w+'px');var x=this._wrap.scrollLeft/u*v;n.set(this._gripper,'left',x+'px');i.show(this._gripper);}else i.hide(this._gripper);this._checkContentBoundaries();return this;},_checkContentBoundaries:function(){var t=this._wrap.scrollLeft,u=this._wrap.scrollWidth-this._wrap.clientWidth;i.conditionClass(this._elem,'contentBefore',t>0);i.conditionClass(this._elem,'contentAfter',t<u);},destroy:function(){this._listeners.forEach(function(t){t.remove();});this._listeners.length=0;},_handleMousemove:function(event){var t=o.getElementPosition(this._track).y,u=o.getElementDimensions(this._track).y;if(Math.abs(t+u/2-o.getEventPosition(event).y)<25){this.showScrollbar(false);}else this.hideScrollbar();},_handleScroll:function(event){this.adjustGripper();if(this._options.fade!==false)this.showScrollbar();},hideScrollbar:function(){if(!this._scrollbarVisible)return this;this._scrollbarVisible=false;if(this._hideTimeout){clearTimeout(this._hideTimeout);this._hideTimeout=null;}this._hideTimeout=setTimeout(function(){if(this._scrollbarAnimation){this._scrollbarAnimation.stop();this._scrollbarAnimation=null;}this._scrollbarAnimation=new g(this._track).from('opacity',1).to('opacity',0).duration(250).ondone(i.addClass.bind(null,this._track,'invisible_elem')).go();}.bind(this),750);return this;},showScrollbar:function(t){if(this._scrollbarVisible)return this;this._scrollbarVisible=true;if(this._hideTimeout){clearTimeout(this._hideTimeout);this._hideTimeout=null;}if(this._scrollbarAnimation){this._scrollbarAnimation.stop();this._scrollbarAnimation=null;}this.adjustGripper();n.set(this._track,'opacity',1);i.removeClass(this._track,'invisible_elem');if(t!==false)this.hideScrollbar();return this;},clickToScroll:function(event){var t=o.getEventPosition(event).x,u=this._elem.clientWidth,v=this._body.offsetWidth,w=this._track.offsetWidth,x=u/v*w,y=o.getElementPosition(this._gripper);if(t>=y.x&&t<=y.x+x)return;var z=t<y.x?-1:1,aa=this._wrap.offsetWidth*.8*z;this.scrollBy(aa);},scrollBy:function(t){this.setScroll(this._wrap.scrollLeft+t);},getMaxBodyOffset:function(){return this._body.offsetWidth-this._wrap.offsetWidth;},setScroll:function(t){var u=t;u=Math.max(Math.min(u,this.getMaxBodyOffset()),0);this._wrap.scrollLeft=u;},scrollIntoView:function(t){var u=this._wrap.clientWidth,v=t.offsetWidth,w=this._wrap.scrollLeft,x=w+u,y=t.offsetLeft,z=y+v;if(y<w||u<v){this.setScroll(y);}else if(z>x)this.setScroll(w+(z-x));},mouseWheel:function(event){if(this.getMaxBodyOffset()<=0)return;var t=0;if(event.wheelDelta){var u=event.wheelDelta;if(event.wheelDeltaX&&event.wheelDeltaY)u=Math.abs(event.wheelDeltaX)>Math.abs(event.wheelDeltaY)?event.wheelDeltaX:event.wheelDeltaY;t=-u*10/40;}else if(event.detail)t=event.detail*10;this.scrollBy(t);event.prevent();}});e.exports=a.TimelineMapScrollableArea||s;},null);
__d("VaultEditableGrid",["Event","Arbiter","AsyncRequest","CSS","DOM","$","copyProperties","csx","ge","removeFromArray"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q={};function r(s,t,u,v){q[s.id]=this;this._grid=s;this._gridID=s.id;this._dialogEndpoint=t;this._collapseWhenEmpty=u;this._attachmentCount=v;this._selectedVaultImageIDs=[];h.subscribe('multi-upload/image-removed/'+this._gridID,function(w,x){p(this._selectedVaultImageIDs,x);this.updateAttachmentCount(this._attachmentCount-1);}.bind(this));h.subscribe('multi-upload/composer-reset/'+this._gridID,function(w,x){this.removeImages();}.bind(this));h.subscribe(['multi-upload/images-upload-start/'+this._gridID,'multi-upload/video-added/'+this._gridID],function(){this.updateAttachmentCount(this._attachmentCount+1);}.bind(this));h.inform('fbVaultEditableGrid/created/'+s.id,this,h.BEHAVIOR_PERSISTENT);h.subscribe('multi-upload/images-upload-start/'+this._gridID,this._scrollToRight.bind(this));this.updateAttachmentCount(this._attachmentCount);}m(r,{VAULT_IMAGE:'vault_image',getInstance:function(s){return q[s];},registerDialogWithGrid:function(s,t,u){h.subscribe(['multi-upload/images-upload-start/'+s,'multi-upload/video-added/'+s],u.hide.bind(u));h.subscribe('fbVaultEditableGrid/created/'+s,function(v,w){w._registerDialogWithGrid(t,u);});},onImagesSelected:function(s,t,u){q[s]._onImagesSelected(t,u);}});m(r.prototype,{getRoot:function(){var s=o(this._gridID);if(s){return s;}else return this._grid;},_registerDialogWithGrid:function(s,t){this._dialog=t;var u=this.getMoreLink();u&&g.listen(u,'click',function(){t.show();return false;});t.subscribe('aftershow',function(){var v=[];k.scry(l(this._gridID),'input[type="hidden"]').forEach(function(x){if(x.name.match('composer_vault_images')||x.name.match('composer_unpublished_photo'))v.push(x.value);});var w=s.getGrid();w.bulkChange(function(){var x=w.getSelectionSet();x.clear();x.addAll(v);});}.bind(this));},updateAttachmentCount:function(s){this._attachmentCount=s;if(this._collapseWhenEmpty)j.conditionShow(this._grid,this._attachmentCount>0);},getID:function(){return this._gridID;},_onImagesSelected:function(s,t){var u=k.find(this.getRoot(),"._577");this.removeImages();this._selectedVaultImageIDs=t;s.forEach(function(v){k.insertBefore(u,v);});h.inform('multi-upload/images-added/'+this._gridID,{fbids:t});this._scrollToRight();},removeImages:function(){k.scry(this.getRoot(),'.fbVaultGridItem').forEach(function(s){if(!j.hasClass(s,'fbVaultEditableGridMoreLink'))k.remove(s);});this._selectedVaultImageIDs=[];h.inform('multi-upload/all-images-removed/'+this._gridID);this.updateAttachmentCount(0);},_scrollToRight:function(){var s=this.getRoot(),t=k.find(s,'.fbScrollableAreaWrap');t.scrollLeft=Math.max(0,k.find(s,'.fbScrollableAreaBody').offsetWidth-t.offsetWidth);},showDialog:function(s,t){if(this._dialog){this._dialog.show();}else i.bootstrap(this._dialogEndpoint,s);},getMoreLink:function(){return k.scry(this.getRoot(),'.fbVaultEditableGridMoreLink')[0];}});e.exports=r;},null);
__d("BasePhotoUploader",["Arbiter","ArbiterMixin","CSS","DOM","PhotosMultiUploadInput","VaultEditableGrid","TimelineMapScrollableArea","mixin","getObjectValues"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=n(h);for(var q in p)if(p.hasOwnProperty(q))s[q]=p[q];var r=p===null?null:p.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=p;function s(t,u){"use strict";new m(t,{verticalscroll:true});this.$BasePhotoUploader0=t;this.$BasePhotoUploader1=this.$BasePhotoUploader2();this.$BasePhotoUploader3=false;this.$BasePhotoUploader4=null;u.addSubscriptions(g.subscribe('multi-upload/images-added/'+this.$BasePhotoUploader0.id,function(v,w){var x=Object.assign({},w.fbids);Object.assign(this.$BasePhotoUploader1,x);this.$BasePhotoUploader5();this.inform('upload-completed',{fbids:o(x)});}.bind(this)),g.subscribe('multi-upload/image-removed/'+this.$BasePhotoUploader0.id,function(v,w){for(var x in this.$BasePhotoUploader1)if(this.$BasePhotoUploader1[x]===w){delete this.$BasePhotoUploader1[x];break;}this.$BasePhotoUploader5();}.bind(this)),g.subscribe('multi-upload/images-upload-start/'+this.$BasePhotoUploader0.id,function(v,w){i.show(this.$BasePhotoUploader0);this.$BasePhotoUploader3=true;this.inform('dom-updated');this.inform('upload-started',w);}.bind(this)),g.subscribe('multi-upload/composer-reset/'+this.$BasePhotoUploader0.id,this.clear.bind(this)),g.subscribe('multi-upload/all-images-removed/'+this.$BasePhotoUploader0.id,this.$BasePhotoUploader6.bind(this)),g.subscribe('multi-upload/images-upload-completed/'+this.$BasePhotoUploader0.id,function(v){this.$BasePhotoUploader3=false;this.inform('all-uploads-completed');this.$BasePhotoUploader5();}.bind(this)));i.conditionShow(this.$BasePhotoUploader0,Object.keys(this.$BasePhotoUploader1).length);}s.prototype.getSelectedFBIDs=function(){"use strict";var t=Object.keys(this.$BasePhotoUploader1).sort();return t.map(function(u){return this.$BasePhotoUploader1[u];}.bind(this));};s.prototype.isUploading=function(){"use strict";return this.$BasePhotoUploader3;};s.prototype.clear=function(){"use strict";var t=l.getInstance(this.$BasePhotoUploader0.id);t&&t.removeImages();};s.prototype.getWaterfallID=function(){"use strict";return k.getWaterfallID(this.$BasePhotoUploader0.id);};s.prototype.$BasePhotoUploader6=function(){"use strict";this.$BasePhotoUploader1={};this.$BasePhotoUploader3=false;i.hide(this.$BasePhotoUploader0);this.inform('all-uploads-completed');this.inform('dom-updated');};s.prototype.$BasePhotoUploader2=function(){"use strict";var t={},u=-10000;j.scry(this.$BasePhotoUploader0,'input[type="hidden"]').forEach(function(v){if(v.name.match('composer_vault_images')){t[u]=v.value;u--;}});return t;};s.prototype.$BasePhotoUploader5=function(){"use strict";i.conditionShow(this.$BasePhotoUploader0,Object.keys(this.$BasePhotoUploader1).length>0);this.inform('dom-updated');};s.prototype.setCurrentMethod=function(t){"use strict";this.$BasePhotoUploader4=t;};s.prototype.getCurrentMethod=function(){"use strict";return this.$BasePhotoUploader4;};e.exports=s;},null);
__d("MercuryPhotoUploader",["Arbiter","AsyncRequest","copyProperties","DOM","FileInput","Parent","PhotosMultiUploadInput","PUWMethods","VaultEditableGrid","Focus","csx","cx","Event","BasePhotoUploader"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){for(var u in t)if(t.hasOwnProperty(u))w[u]=t[u];var v=t===null?null:t.prototype;w.prototype=Object.create(v);w.prototype.constructor=w;w.__superConstructor__=t;function w(x,y,z,aa){"use strict";t.call(this,x,z);this.$MercuryPhotoUploader0=x.id;this.$MercuryPhotoUploader1=false;g.subscribe('PhotosMultiUploadInput/loaded/'+x.id,function(){this.$MercuryPhotoUploader1=true;}.bind(this));g.subscribe('MercuryPhotoUploader/initUploadButton/'+x.id,function(){var ba=j.scry(y,'input[type="file"]')[0];if(!ba)ba=j.create('input',{accept:'image/*',type:'file',className:"_n",name:'composer_unpublished_photo[]',multiple:1});var ca=l.byClass(y,"_9_h"),da=new k(ca,j.find(ca,"._214"),ba);da.subscribe('change',m.doFileUpload.bind(null,x.id,da));});g.subscribe('MercuryPhotoUploader/registerPhotoMenu/'+x.id,function(ba,ca){var da=ca.menu.getRoot();ca.menu.setContext(y);var ea=j.scry(da,"._d2p"),fa=ea&&ea[0];fa&&s.listen(fa,'click',function(){o.getInstance(x.id).showDialog(fa,o.VAULT_IMAGE);this.setCurrentMethod(n.VAULT);this.inform('selection-start',{method:n.VAULT});}.bind(this));s.listen(y,'click',function(){if(!this.$MercuryPhotoUploader1)return;if(!ca.menu.isShown()){var ha=j.scry(ca.menu.getContentRoot(),'li');this.inform('menu-show');ca.menu.show();if(ha)p.setWithoutOutline(ha[0]);}else{this.inform('menu-hide');ca.menu.hide();}}.bind(this));s.listen(document.documentElement,'click',function(event){if(!j.contains(y,event.getTarget())&&!j.contains(fa,event.getTarget())){if(ca.menu.isShown())this.inform('menu-hide');ca.menu.hide();}}.bind(this));var ga=j.find(da,"._9_h");s.listen(ga,'click',function(){this.setCurrentMethod(n.FILE_SELECTOR);this.inform('selection-start',{method:n.FILE_SELECTOR});}.bind(this));}.bind(this));aa&&m.initDragDrop(x.id,aa);}w.prototype.uploadPastedFile=function(x){"use strict";m.onFilesDrop(this.$MercuryPhotoUploader0,[x]);};w.prototype.addCachedPhotos=function(x){"use strict";h.post('/ajax/vault/selected.php',{max_select:10,grid_id:this.$MercuryPhotoUploader0,source:'messenger',image_ids:x});};i(w,{initUploadButton:function(x){g.inform('MercuryPhotoUploader/initUploadButton/'+x,{},g.BEHAVIOR_PERSISTENT);},registerPhotoMenu:function(x,y){g.inform('MercuryPhotoUploader/registerPhotoMenu/'+x,{menu:y},g.BEHAVIOR_PERSISTENT);}});e.exports=w;},null);
__d("MercuryDrafts",["CacheStorage","MercurySingletonMixin","copyProperties","isEmpty"],function(a,b,c,d,e,f,g,h,i,j){function k(l){"use strict";this.$MercuryDrafts0=l;this.$MercuryDrafts1=new g('localstorage','mercury-drafts:'+this.$MercuryDrafts0);}k.prototype.saveDraft=function(l,m){"use strict";if(this.isMessageEmpty(m)){this.removeDraft(l);}else this.$MercuryDrafts1.set(l,this.$MercuryDrafts2(l,m));};k.prototype.removeDraft=function(l){"use strict";this.$MercuryDrafts1.remove(l);};k.prototype.getDraft=function(l){"use strict";var m=this.$MercuryDrafts1.get(l,{});return m.message;};k.prototype.isMessageEmpty=function(l){"use strict";return j(l)||(j(l.body)&&j(l.content_attachment)&&j(l.raw_attachments)&&j(l.photo_fbids)&&j(l.image_ids));};k.prototype.$MercuryDrafts2=function(l,m){"use strict";return {thread_id:l,message:m};};i(k,h);e.exports=k;},null);
__d("MercuryDraftsController",["Input","MercurySingletonMixin","copyProperties","isEmpty","MercuryDrafts"],function(a,b,c,d,e,f,g,h,i,j){var k=b('MercuryDrafts').get();function l(m){"use strict";this.$MercuryDraftsController0;}l.prototype.clearDraft=function(m){"use strict";if(this.canSaveDrafts(m))k.removeDraft(m);};l.prototype.saveDraft=function(m,n,o,p,q){"use strict";if(!this.canSaveDrafts(m))return;var r={body:g.getValue(n)};if(!j(o.getAttachments())){r.has_attachment=true;r.raw_attachments=o.getAttachments();}if(!j(o.getImageFiles())){r.has_attachment=true;r.image_ids=o.getImageFiles();}if(q&&!j(q.getSelectedFBIDs())){r.has_attachment=true;r.photo_fbids=q.getSelectedFBIDs();}if(p.getAttachData()){r.has_attachment=true;r.content_attachment=p.getAttachData();}k.saveDraft(m,r);};l.prototype.loadDraft=function(m,n,o,p,q){"use strict";if(!this.canSaveDrafts(m)||this.$MercuryDraftsController1(n,o,p,q))return;var r=k.getDraft(m);if(!j(r)){if(r.body){n.focus();g.setValue(n,r.body);}if(!j(r.raw_attachments))o.addCachedAttachments(r.raw_attachments);if(!j(r.image_ids))o.addCachedImageFiles(r.image_ids);if(!j(r.content_attachment))p.loadShare(r.content_attachment.attachment.params.url);if(q&&!j(r.photo_fbids))q.addCachedPhotos(r.photo_fbids);this.clearDraft(m);}};l.prototype.canSaveDrafts=function(m){"use strict";return !!(m);};l.prototype.$MercuryDraftsController1=function(m,n,o,p){"use strict";return !g.isEmpty(m)||!j(n.getAttachments())||!j(n.getImageFiles())||(p&&!j(p.getSelectedFBIDs()))||o.getAttachData();};l.prototype.toString=function(){"use strict";return '[object MercuryDraftsController:'+this.$MercuryDraftsController0+']';};i(l,h);e.exports=l;},null);
__d("MercuryDataSources",[],function(a,b,c,d,e,f){var g={},h={add:function(i,j){g[i]=j;},get:function(i){!g[i];return g[i];}};e.exports=h;},null);
__d("MercuryTypeaheadRenderer",["Event","CSS","MercuryConstants","DOM","Image.react","MercuryParticipantsConstants","React","MercuryTypeaheadTemplates","copyProperties","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(s,t){var u=i.MercuryTypeaheadConstants,v;switch(s.type){case u.HEADER_TYPE:v=n[':fb:mercury:typeahead:header'].build();q.renderHeader(v,s);break;case u.USER_TYPE:case u.PAGE_TYPE:v=n[':fb:mercury:typeahead:result'].build();q.renderPerson(v,s);break;default:throw new Error('Unsupported result type: '+s.type);}return v.getRoot();}o(q,{renderHeader:function(s,t){if(t.disabled){h.hide(s.getRoot());return;}var u=t.getLinkHandler&&t.getLinkHandler();if(u){var v=s.getNode('link');j.setContent(v,t.linkText);g.listen(v,'click',u);}else h.hide(s.getNode('link'));s.setNodeContent('text',t.text);},renderPersonWithBigPhoto:function(s,t){r(s,t,l.BIG_IMAGE_SIZE);},renderPerson:function(s,t){r(s,t,l.IMAGE_SIZE);},renderPage:function(s,t){r(s,t,l.IMAGE_SIZE);}});function r(s,t,u){if(t.photo){var v=m.createElement(k,{width:u,height:u,src:t.photo});m.renderComponent(v,s.getNode('image'));}if(t.text){j.setContent(s.getNode('name'),t.text);s.getRoot().setAttribute('aria-label',t.text);}var w=[];if(t.subtext||t.category){if(t.subtext)w.push(t.subtext);if(t.category)w.push(t.category);j.appendContent(s.getNode('snippet'),w.join(" \u00b7 "));}if(t.non_employee){if(w.length)j.prependContent(s.getNode('snippet')," \u00b7 ");var x=j.create('span',{className:"_52l8 highlight"},'(Non-Employee)');j.prependContent(s.getNode('snippet'),x);}}e.exports=q;},null);
__d("WebMessengerAddPeopleToConversationDialog",["ContextualTypeaheadView","Dialog","DOM","MercuryAPIArgsSource","MercuryDataSources","MercuryLogMessageType","MercurySourceType","MercuryTypeahead","MercuryTypeaheadRenderer","WebMessengerTemplates","WebMessengerConstants","tx","MercuryMessages","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=b('MercuryMessages').get(),t=b('MercuryThreads').get(),u={show:function(w){var x="Add People",y={};y[q.FRIEND_TYPE]={uid:q.FRIEND_TYPE,type:q.HEADER_TYPE,disabled:true};y[q.NON_FRIEND_TYPE]={uid:q.NON_FRIEND_TYPE,text:"Other People",type:q.HEADER_TYPE};var z=new n(k.get('MercuryRecipientsDataSource'),g);z.setViewOption('renderer',o);z.setViewOption('typeObjects',y);z.setPlaceholder("Add friends to this chat");var aa=[];aa.push({name:'subscribe',label:x,handler:v.bind(null,w,z)});aa.push(h.CANCEL);var ba=p[':fb:web-messenger:add-people-dialog'].build(),ca=new h().setTitle(x).setBody(ba.getRoot()).setButtons(aa).showLoading();t.getThreadMeta(w,function(da){z.setFullWidthView(ba.getNode('participantsTypeahead'));z.setExcludedParticipantsFromThreadMeta(da);z.build();i.appendContent(ba.getNode('participantsTypeahead'),z.getElement());ca.show();z.focus();},j.WEBMESSENGER);}};function v(w,x){var y=x.getTokens(),z=y.map(function(aa){if(aa.getInfo().type==q.USER_TYPE){return 'fbid:'+aa.getValue();}else return 'email:'+aa.getValue();});if(!z.length)return false;s.sendMessage(s.constructLogMessageObject(m.TITAN_WEB,w,l.SUBSCRIBE,{added_participants:z}),null,j.WEBMESSENGER);return true;}e.exports=u;},null);
__d("Autosize",["CSS","cx","DOM","Style"],function(a,b,c,d,e,f,g,h,i,j){var k=['fontFamily','fontStyle','fontVariant','fontWeight','letterSpacing','textDecoration','textIndent','textTransform','whiteSpace','wordSpacing','wordWrap'],l=/^[0-9]+$/;function m(r){var s=r.cloneNode(true);g.addClass(s,"_4g");var t=r.clientWidth-j.getFloat(r,'paddingLeft')-j.getFloat(r,'paddingRight');j.set(s,'width',t+'px');var u=r.clientHeight-j.getFloat(r,'paddingTop')-j.getFloat(r,'paddingBottom');j.set(s,'height',u+'px');i.insertAfter(r,s);return s;}function n(r,s,t,u,v){var w=r.style.fontSize,x=r.style.height;j.set(r,"height","auto");if(s!==null){var y=r.style.width;j.set(r,"width","auto");}var z=0,aa=v.length-1;while(z<aa){var ba=Math.ceil((z+aa)/2);j.set(r,"font-size",v[ba]+u);if((t!==null&&r.scrollHeight>t)||(s!==null&&r.scrollWidth>s)){aa=ba-1;}else z=ba;}r.style.fontSize=w;r.style.height=x;if(s!==null)r.style.width=y;return v[z]+u;}function o(r,s,t,u,v,w){var x=r.style.fontSize,y=r.style.height;j.set(r,"height","auto");if(s!==null){var z=r.style.width;j.set(r,"width","auto");}j.set(r,"font-size",w+u);if((t===null||r.scrollHeight<=t)&&(s===null||r.scrollWidth<=s)){r.style.fontSize=x;r.style.height=y;if(s!==null)r.style.width=z;return w+u;}j.set(r,"font-size",v+u);if((t!==null&&r.scrollHeight>t)||(s!==null&&r.scrollWidth>s)){r.style.fontSize=x;r.style.height=y;if(s!==null)r.style.width=z;return v+u;}while(v+1<w){var aa=Math.ceil((v+w)/2);j.set(r,"font-size",aa+u);if((t!==null&&r.scrollHeight>t)||(s!==null&&r.scrollWidth>s)){w=aa;}else v=aa;}r.style.fontSize=x;r.style.height=y;if(s!==null)r.style.width=z;return v+u;}function p(r,s){this._wrap=r;this._attr=s;if(this._attr.sizes){var t=this._attr.sizes;for(var u=1,v=t.length;u<v;u++){if(t[u-1]<=t[u])continue;t.sort(function(x,y){return x-y;});break;}}else if(s.min>s.max){var w=s.min;s.min=s.max;s.max=w;}this.fit();}p.prototype.fit=function(r,s){var t=this._wrap;if(!t.clientWidth){q.push(this);return;}var u=m(t);if(typeof r==="undefined")r=this._attr.width;if(l.test(r)){u.style.width=r+"px";}else if(r!==null&&r!=="auto")u.style.width=r;if(typeof s==="undefined")s=this._attr.height;if(l.test(s)){u.style.height=s+"px";}else if(s!==null&&s!=="auto")u.style.height=s;var v=null;if(!this._attr.wrap)v=u.clientWidth;var w=null;if(this._attr.wrap||s!==null)w=u.clientHeight;var x;if(this._attr.sizes){x=n(u,v,w,"px",this._attr.sizes);}else x=o(u,v,w,"px",this._attr.min,this._attr.max);i.remove(u);j.set(t,"font-size",x);g.removeClass(t,"invisible_elem");};var q=[];p.onNodeInserted=function(){var r=q;q=[];r.forEach(function(s){s.fit();});};e.exports=p;},null);
__d("WebMessengerEditThreadDialog",["Event","Button","ContextualDialog","CSS","DOM","FileInput","FileInputUploader","Input","InputSelection","LayerFadeOnHide","LayerFadeOnShow","LayerHideOnTransition","MercuryAPIArgsSource","MercuryLogMessageType","MercurySourceType","WebMessengerTemplates","URI","WebMessengerSubscriptionsHandler","csx","cx","MercuryMessages","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){var aa=b('MercuryMessages').get(),ba=b('MercuryThreads').get(),ca=':fb:web-messenger:read-view:header:edit-multichat';function da(){"use strict";var ea=v[ca].build();this._dialog=new i({position:'below',addedBehaviors:[p,q,r]},ea.getRoot());this._saveButton=ea.getNode('saveButton');this._cancelButton=ea.getNode('cancelButton');this._pictureInput=ea.getNode('newPicture');this._uploadButton=ea.getNode('uploadButton');this._uploadingThrobber=ea.getNode('uploadingThrobber');this._uploadedFileDetails=ea.getNode('uploadedFileDetails');this._fileNameNode=ea.getNode('fileName');this._cancelImageButton=ea.getNode('cancelImage');this._threadID=null;var fa=ea.getNode('newName');this._uploadedImage=null;if(!this._pictureInput){var ga=k.scry(ea.getRoot(),"._8-9")[0];this._pictureInput=k.create('input',{accept:'image/*',type:'file',className:"_n",name:'attachment[]',tabindex:2});new l(ga,this._uploadButton,this._pictureInput);}this._uploader=new m(this._pictureInput);this._uploader.setURI(w('/ajax/mercury/upload.php').setSubdomain('upload').toString());this._uploader.setData({images_only:true});x.addSubscriptions(this._uploader.subscribe('success',this._onFileUploadSuccess.bind(this)),this._uploader.subscribe('failure',this._onFileUploadFailure.bind(this)),g.listen(this._pictureInput,'change',this._onFileUploadChange.bind(this)),g.listen(this._cancelImageButton,'click',this._resetImageUpload.bind(this)));g.listen(this._saveButton,'click',function(){this.save(n.getValue(fa));this._dialog.hide();}.bind(this));g.listen(this._cancelButton,'click',function(){this._dialog.hide();}.bind(this));this._dialog.subscribe('show',function(){var ha=ba.getThreadMetaNow(this._threadID);n.setValue(fa,ha.name);this._resetImageUpload();}.bind(this));this._dialog.subscribe('aftershow',function(){o.set(fa,0,n.getValue(fa).length);}.bind(this));}da.prototype.toggleShown=function(ea,fa){"use strict";if(!this._dialog.isShown()){this._dialog.setContext(ea);this._threadID=fa;this._uploadedImage=null;this._dialog.show();}else this._dialog.hide();};da.prototype.save=function(ea){"use strict";var fa=null,ga=ba.getThreadMetaNow(this._threadID);if(ga)fa=ga.name;if((ea||fa)&&(ea!=fa))aa.sendMessage(aa.constructLogMessageObject(u.CHAT_WEB,this._threadID,t.THREAD_NAME,{name:ea}),null,s.WEBMESSENGER);if(this._uploadedImage)aa.sendMessage(aa.constructLogMessageObject(u.CHAT_WEB,this._threadID,t.THREAD_IMAGE,{image:this._uploadedImage}));};da.prototype._onFileUploadChange=function(event){"use strict";var ea=n.getValue(event.getTarget());if(ea){h.setEnabled(this._saveButton,false);j.hide(this._uploadButton);j.hide(this._uploadedFileDetails);j.show(this._uploadingThrobber);this._uploader.send();}};da.prototype._onFileUploadSuccess=function(ea,fa){"use strict";var ga=fa.response.getPayload();this._uploadedImage=ga.metadata[0];k.setContent(this._fileNameNode,this._uploadedImage.filename);j.hide(this._uploadingThrobber);j.hide(this._uploadButton);j.show(this._uploadedFileDetails);h.setEnabled(this._saveButton,true);};da.prototype._onFileUploadFailure=function(ea,fa){"use strict";h.setEnabled(this._saveButton,true);this._resetImageUpload();};da.prototype._resetImageUpload=function(){"use strict";this._uploadedImage=null;this._pictureInput.value=null;j.hide(this._uploadingThrobber);j.hide(this._uploadedFileDetails);j.show(this._uploadButton);};e.exports=da;},null);
__d("WebMessengerStateConstants",[],function(a,b,c,d,e,f){var g={STATE_CHANGE_EVENT:'state-changed',DETAIL:{COMPOSE_MAIN:'compose-main',COMPOSE_TYPEAHEAD_RESULTS:'compose-typeahead-results',COMPOSE_ALL_PEOPLE_RESULTS:'compose-all-people-results',RECENT_MESSAGES:'recent-messages',SEARCH_CONTEXT:'search-context',SEARCH_SNIPPET:'search-snippet',SEARCH_THREAD_SNIPPET:'search-thread-snippet',SHARED_PHOTOS:'shared-photos'},MASTER:{RECENT_THREADS:'recent-threads',SEARCH:'search'},MESSAGE_ACTION:{DELETE:'delete',REPORT_SPAM:'report_spam'}};e.exports=g;},null);
__d("WebMessengerOldToNewPermalink",["WebMessengerPermalinkConstants","WebMessengerStateConstants"],function(a,b,c,d,e,f,g,h){function i(n){if(!j(n))return n;k(n);m(n);l(n);return n;}function j(n){var o=n.getQueryData();if(o.sk)switch(o.sk){case 'inbox':n.setPath(g.BASE_PATH);n.removeQueryData('sk');break;case 'other':n.setPath(g.OTHER_PATH);n.removeQueryData('sk');break;default:return false;}return true;}function k(n){var o=n.getQueryData();switch(o.action){case 'read':if(!o.tid){n.addQueryData({action:h.DETAIL.RECENT_MESSAGES});}else n.removeQueryData('action');break;}}function l(n){var o=n.getQueryData();if(o.tid){n.setPath(g.getURIPathForThreadID(o.tid,n.getPath()));n.removeQueryData('tid');}}function m(n){var o=n.getQueryData();if(!n.getPath().match(g.SEARCH_POSTFIX_PATH)&&o.action!=h.DETAIL.SEARCH_SNIPPET&&!o.mid){var p=o.query;if(o.query){var q=/\bis:(archived|spam)\b(.*)/,r=q.exec(o.query);if(r){switch(r[1]){case 'archived':n.setPath(g.ARCHIVED_PATH);break;case 'spam':n.setPath(g.SPAM_PATH);break;}var s=o.query.substr(0,o.query.length-r[0].length),t=r[2];p=(s.trim()+' '+t.trim()).trim();}}if(o.thread_query){n.setPath(n.getPath()+g.SEARCH_POSTFIX_PATH);n.setQueryData({query:o.thread_query});}else if(p){n.setPath(n.getPath()+g.SEARCH_POSTFIX_PATH);n.addQueryData({query:p});}else n.removeQueryData('query');}}e.exports=i;},null);
__d("WebMessengerStateStore",["MercuryAssert","PresenceState"],function(a,b,c,d,e,f,g,h){var i=null;function j(){var l=h.get();if(l&&l.wml)return l.wml;return {};}h.registerStateStorer(function(l){if(i)l.wml=i;i=null;});var k={getLastSeenThreadID:function(){var l=j();return l.thread_id||null;},getLastSeenFolder:function(){var l=j();return l.folder||null;},setLastSeen:function(l,m){m&&g.isThreadID(m);i={folder:l,thread_id:m||null};h.doSync();}};e.exports=k;},null);
__d("WebMessengerPermalinks",["MercuryAPIArgsSource","MercuryConfig","MercuryFilters","MercuryIDs","MercuryParticipants","MercuryParticipantTypes","MessagingTag","WebMessengerOldToNewPermalink","WebMessengerPermalinkConstants","WebMessengerStateConstants","WebMessengerStateStore","Token","URI","WebMessengerConstants","WebMessengerPreferences","WWWBase","MercuryUnreadState","isWebMessengerURI","goURI","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){var z=b('MercuryServerRequests').get(),aa=b('MercuryThreads').get(),ba='(/|\\?|$)',ca={getDefaultURI:function(){var pa=new s(v.uri);pa.setPath(o.BASE_PATH);return pa;},goNextURI:function(pa,qa,ra,sa){if(la(pa,qa,ra)){var ta=ca.getURI(pa,qa,ra);y(ta,false,sa);return true;}return false;},getURI:function(pa,qa,ra){var sa=ca.getDefaultURI();if(!pa||!qa||!ra)return sa;switch(ra.folder){case m.OTHER:sa.setPath(o.OTHER_PATH);break;case m.ACTION_ARCHIVED:sa.setPath(o.ARCHIVED_PATH);break;case m.SPAM:sa.setPath(o.SPAM_PATH);break;}if(ra.filter&&(ra.filter!=i.ALL))sa.addQueryData({filter:ra.filter});var ta;switch(pa){case p.MASTER.SEARCH:ta=false;sa.setPath(sa.getPath()+o.SEARCH_POSTFIX_PATH);break;}switch(qa){case p.DETAIL.COMPOSE_MAIN:case p.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:case p.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:sa.setPath(sa.getPath()+o.COMPOSE_POSTFIX_PATH);ta=false;break;case p.DETAIL.RECENT_MESSAGES:ta=!ra.thread_id;break;case p.DETAIL.SEARCH_CONTEXT:case p.DETAIL.SHARED_PHOTOS:ta=false;break;default:ta=true;break;}if(ta)sa.addQueryData({action:qa});if(ra.thread_id){var ua=aa.getCanonicalUserInThread(ra.thread_id),va=ua&&k.getNow(k.getIDForUser(ua));if(va&&va.type!==l.EVENT){var wa=(va&&va.vanity)||ua;sa.setPath(o.getURIPathForIDOrVanity(wa,sa.getPath()));}else{var xa=z.getServerThreadIDNow(ra.thread_id),ya=xa?xa:ra.thread_id;sa.setPath(o.getURIPathForThreadID(ya,sa.getPath()));}}if(ra.query)sa.addQueryData({query:ra.query});if(ra.message_query)sa.addQueryData({mquery:ra.message_query});if(ra.message_id)sa.addQueryData({mid:ra.message_id});if(ra.reuse_composer)sa.addQueryData({rc:true});return sa;},processURI:function(pa){pa=n(pa);if(!x(pa))return false;var qa=ma(pa);if(!qa.master_state||!qa.detail_state)return na(pa);var ra={data:{folder:ja(pa),filter:ka(pa)},redirect:false,master_state:qa.master_state,detail_state:qa.detail_state};if(pa.getQueryData().rc)ra.data.reuse_composer=true;ra=ga(pa,ra);switch(qa.detail_state){case p.DETAIL.RECENT_MESSAGES:return ia(pa,ra);case p.DETAIL.COMPOSE_MAIN:return da(pa,ra);case p.DETAIL.SEARCH_SNIPPET:ra=ha(pa,ra);return ra;case p.DETAIL.SEARCH_CONTEXT:ra=ia(pa,ra);ra=ha(pa,ra);return fa(pa,ra);}ra.redirect=true;ra.detail_state=null;return ra;}};function da(pa,qa){var ra=null;if(pa.getQueryData().to)ra=[].concat(pa.getQueryData().to);return ea(ra,qa);}function ea(pa,qa){if(pa){qa.data.new_tokens=[];pa.forEach(function(ra){var sa=k.getNow(k.getIDForUser(ra));if(sa){var ta={uid:ra,text:sa.name,type:t.USER_TYPE};qa.data.new_tokens.push(new r(ta));}});}qa.data.start=true;return qa;}function fa(pa,qa){var ra=pa.getQueryData().mid;if(ra){qa.data.message_id=ra;}else qa.redirect=true;return qa;}function ga(pa,qa){var ra=pa.getQueryData().query;qa.data.query=ra;return qa;}function ha(pa,qa){var ra=pa.getQueryData().mquery;qa.data.message_query=ra;return qa;}function ia(pa,qa){var ra=o.getThreadIDFromURI(pa);if(ra){var sa=j.isValidThreadID(ra)?ra:z.getClientThreadIDNow(ra)||z.getClientThreadIDForPermalinks(ra);if(sa){qa.data.thread_id=sa;}else qa.redirect=true;}else{var ta=o.getUserIDOrVanity(pa.getPath());if(ta){var ua=k.getIDFromVanityOrFBID(ta),va=ua&&aa.getCanonicalThreadToParticipant(ua,null,g.WEBMESSENGER);if(va){if(va.timestamp){qa.data.thread_id=va.thread_id;}else{qa.detail_state=p.DETAIL.COMPOSE_MAIN;qa=ea([k.getUserID(ua)],qa);}}else qa.redirect=true;}}return qa;}function ja(pa,qa){var ra=pa.getPath();if(ra.match('^'+o.ARCHIVED_PATH+ba))return m.ACTION_ARCHIVED;if(ra.match('^'+o.OTHER_PATH+ba))return m.OTHER;if(ra.match('^'+o.SPAM_PATH+ba))return m.SPAM;if(qa!==undefined)return qa;return m.INBOX;}function ka(pa){return pa.getQueryData().filter||i.ALL;}function la(pa,qa,ra){if(qa===p.DETAIL.SEARCH_CONTEXT||qa===p.DETAIL.SEARCH_THREAD_SNIPPET||qa===p.DETAIL.SHARED_PHOTOS)return false;if(ra&&ra.no_uri===true){delete ra.no_uri;return false;}var sa=qa==p.DETAIL.COMPOSE_MAIN||qa==p.DETAIL.COMPOSE_TYPEAHEAD_RESULTS||qa==p.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS;if(sa&&(!ra.start||ra.new_tokens))return false;if(!pa||!qa||!ra)return true;if(ra.bug_reporting_enabled)return false;return !ra.message_action;}function ma(pa){var qa={},ra=pa.getPath(),sa=pa.getQueryData(),ta=ra.match(o.BASE_PATH+'(/[^/]+)?'+o.SEARCH_POSTFIX_PATH+ba);qa.master_state=ta&&sa.query?p.MASTER.SEARCH:p.MASTER.RECENT_THREADS;if(sa.action){qa.detail_state=sa.action;return qa;}if(ra.match(o.BASE_PATH+'(/[^/]+)?'+o.COMPOSE_POSTFIX_PATH+ba)){qa.detail_state=p.DETAIL.COMPOSE_MAIN;return qa;}if(ra.match(o.TID_POSTFIX_PARTIAL_PATH)||o.getUserIDOrVanity(ra)){if(sa.mid&&sa.mquery){qa.detail_state=p.DETAIL.SEARCH_CONTEXT;}else qa.detail_state=p.DETAIL.RECENT_MESSAGES;}else if(sa.mquery)qa.detail_state=p.DETAIL.SEARCH_SNIPPET;return qa;}function na(pa){var qa=ja(pa,null)||q.getLastSeenFolder(),ra=q.getLastSeenThreadID()||oa(qa||m.INBOX),sa=w.get();if(qa===m.OTHER&&sa.getUnreadCount(qa)===0){var ta=m.INBOX;if(sa.exceedsMaxCount(ta)||sa.getUnreadCount(ta)>0)qa=ta;}var ua={redirect:!!ra||!!qa,replace:true,master_state:p.MASTER.RECENT_THREADS,detail_state:p.DETAIL.RECENT_MESSAGES,data:{folder:qa||m.INBOX,filter:i.ALL,thread_id:ra}};return ua;}function oa(pa){var qa=u.lastReadThreadForFolder[pa];if(qa){var ra;if(h.MercuryFBIDGK){ra=qa.canonical_fbid||qa.thread_fbid;}else ra=qa.thread_id;return z.getClientThreadIDNow(ra)||null;}else return null;}e.exports=ca;},null);
__d("WebMessengerStateManager",["Arbiter","CurrentUser","Dialog","Focus","JSLogger","MercuryFilters","MessagingTag","WebMessengerPermalinks","WebMessengerStateConstants","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=k.create('wm_state_manager'),r=h.getID(),s=p(new g(),{getCurrentUserID:function(){return r;},getCurrentMasterState:function(){return v;},getCurrentDetailState:function(){return w;},getCurrentStateData:function(){return x;},setUserID:function(z){r=z||h.getID();},updateMasterState:function(z,aa){s.updateAllStates(z,w,aa);},updateDetailState:function(z,aa){s.updateAllStates(v,z,aa);},updateAllStates:function(z,aa,ba){for(var ca=0;ca<y.length;ca++)if(y[ca]){var da=y[ca](z,aa,ba);if(da){q.log('confirmation_dialog',{master_state:v,detail_state:w,data:x,new_master_state:z,new_detail_state:aa,new_data:ba});da.setHandler(t.bind(null,z,aa,ba)).show();var ea=da.getButtonElement(i.OK.label);ea&&j.set(ea);return;}}t(z,aa,ba);},updateStateOnURI:function(z,aa,ba){u(z,aa,ba);},registerConfirmationBeforeStateUpdate:function(z){var aa=y.length;y.push(z);return aa;},unregisterConfirmationBeforeStateUpdate:function(z){delete y[z];}});function t(z,aa,ba){if(!ba.folder)ba.folder=x.folder;if(!ba.filter)ba.filter=x.filter;if(!n.goNextURI(z,aa,ba))u(z,aa,ba);}function u(z,aa,ba){v=z;w=aa;x=ba;var ca=p({},x);ca.new_tokens=[];(x.new_tokens||[]).forEach(function(da){ca.new_tokens.push(da.getInfo());});ca.new_tokens=[];q.log('state_updated',{master_state:v,detail_state:w,data:ca});s.inform(o.STATE_CHANGE_EVENT);}var v=o.MASTER.RECENT_THREADS,w=o.DETAIL.RECENT_MESSAGES,x={thread_id:null,folder:m.INBOX,filter:l.ALL},y=[undefined];e.exports=s;},null);
__d("WebMessengerDetailViewHeaderControl",["WebMessengerAddPeopleToConversationDialog","Autosize","AvailableListConstants","Bootloader","ContextualDialog","CSS","DOM","WebMessengerEditThreadDialog","Event","HovercardLink","HoverFlyout","JSXDOM","LastMobileActiveTimes","LayerFadeOnHide","LayerFadeOnShow","LayerHideOnTransition","MercuryAPIArgsSource","MercuryParticipants","MercuryPresence","ScrollableArea","WebMessengerStateConstants","WebMessengerStateManager","Style","WebMessengerTemplates","Tooltip","WebMessengerConstants","WebMessengerEvents","WebMessengerSubscriptionsHandler","copyProperties","csx","cx","curry","fbt","tx","MercuryThreadInformer","MercuryThreadMetadataRenderer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na){var oa=b('MercuryThreadInformer').get(),pa=b('MercuryThreadMetadataRenderer').get(),qa=b('MercuryThreads').get(),ra=null;function sa(za){"use strict";this._rootElement=za;m.empty(this._rootElement);this._renderHeaderBar();}sa.prototype.hideView=function(){"use strict";l.hide(this._rootElement);};sa.prototype.updateView=function(){"use strict";l.removeClass(this._rootElement,'hasMultiChatThreadActions');l.show(this._rootElement);if(this._listener){oa.unsubscribe(this._listener);this._listener=null;}var za=aa;switch(ba.getCurrentDetailState()){case za.DETAIL.RECENT_MESSAGES:case za.DETAIL.SEARCH_CONTEXT:case za.DETAIL.SEARCH_THREAD_SNIPPET:case za.DETAIL.SHARED_PHOTOS:this.setThreadID(ba.getCurrentStateData().thread_id);break;default:this.setThreadID(null);break;}ga.detailDOMChanged();};sa.prototype.setThreadID=function(za){"use strict";this._threadID=za;if(this._threadID){this._listener=oa.listen(this._threadID,this.updateView.bind(this));ha.addSubscriptions(this._listener);}za&&qa.getThreadMeta(za,function(ab){if(this._threadID==za)l.conditionClass(this._rootElement,'hasMultiChatThreadActions',!ab.is_canonical&&qa.canReply(za));}.bind(this));};sa.prototype._renderHeaderBar=function(){"use strict";this._headerBar=da[':fb:web-messenger:read-view:header'].build();m.appendContent(this._rootElement,this._headerBar.getRoot());var za=this._headerBar.getNode('editThreadName'),ab=this._headerBar.getNode('addPeopleToThread'),bb=new n();this._title_node_wrapper=this._headerBar.getNode('headerName');this._relationship_status=this._headerBar.getNode('relationshipStatus');ha.addSubscriptions(o.listen(this._headerBar.getNode('closeButton'),'click',function(){var cb=ia(ba.getCurrentStateData(),{all_people_query:undefined});ba.updateDetailState(aa.DETAIL.COMPOSE_MAIN,cb);}),o.listen(za,'click',function(event){this._threadID&&bb.toggleShown(this._headerBar.getNode('headerName'),this._threadID);return true;}.bind(this)),o.listen(ab,'click',function(event){this._threadID&&g.show(this._threadID);return true;}.bind(this)),ga.subscribe(ga.DETAIL_DOM_CHANGED,this.updateHeaderBar.bind(this)));};sa.prototype.updateHeaderBar=function(){"use strict";var za=this._headerBar.getNode('headerButtons');this._title_node_wrapper.style.fontSize='';var ab=r.span(null);m.setContent(this._title_node_wrapper,ab);var bb=this._headerBar.getNode('webMessengerRecIndicator');bb&&l.hide(bb);var cb=ba.getCurrentDetailState(),db=cb==aa.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS;l.conditionShow(this._headerBar.getNode('closeButton'),db);l.conditionClass(this._title_node_wrapper,'allPeopleResults',db);l.hide(this._relationship_status);l.removeClass(this._title_node_wrapper,"_50jz");var eb,fb;switch(cb){case aa.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:fb=ba.getCurrentStateData().all_people_query;eb=m.tx._("People matching {query}",{query:m.create('strong',{},fb)});break;case aa.DETAIL.COMPOSE_MAIN:case aa.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:eb="New Message";break;case aa.DETAIL.SEARCH_SNIPPET:fb=ba.getCurrentStateData().message_query;if(fb)eb=na._("Messages with word: {query}",{query:fb});break;}var gb=!eb&&!this._threadID;if(gb)eb="No Selection";l.conditionClass(this._title_node_wrapper,"_3jd",gb);if(eb){m.setContent(ab,eb);ya(this._title_node_wrapper,this._threadID,za,bb);return;}pa.renderAndSeparatedParticipantList(this._threadID,ab,{check_length:false,names_renderer:function(hb){var ib=hb.map(function(kb){var lb=hb.length===1?kb.name:kb.short_name,mb=x.getUserID(kb.id);if(mb&&kb.href){var nb=r.a({href:kb.href},lb);if(hb.length===1)nb.setAttribute('data-hovercard',p.constructEndpoint({id:mb}));return nb;}else return lb;});if(hb.length===1&&hb[0].fbid!==null){var jb=r.span(null);m.setContent(jb,ib[0]);ua(hb[0],jb);ib[0]=jb;}return ib;}.bind(this)});if(bb)qa.getThreadMeta(this._threadID,function(hb){va(hb,bb);});this.renderParticipantListFlyout(ab);this.renderNamedThreadParticipantCount(ab);ya(this._title_node_wrapper,this._threadID,za,bb);new h(this._title_node_wrapper,{min:11,max:16,height:100,width:this._title_node_wrapper.offsetWidth,wrap:false});};sa.prototype.renderNamedThreadParticipantCount=function(za){"use strict";qa.getThreadMeta(this._threadID,function(ab){if(ab.name){var bb=pa.renderParticipantCount(ab.thread_id,{count:ab.participants.length}),cb=m.create('span',{className:"_1us"},na._("({participants})",{participants:bb}));m.appendContent(za,cb);}},w.WEBMESSENGER);};sa.prototype.renderParticipantListFlyout=function(za){"use strict";this._dialog&&this._dialog.destroy();delete this._dialog;this._flyout&&this._flyout.destroy();delete this._flyout;var ab=this._threadID;qa.getThreadMeta(this._threadID,function(bb){var cb=bb.participants;if(!bb.name){cb=cb.filter(function(db){return db!==x.user;});if(cb.length<=1)return;}x.getMulti(cb,function(db){if(this._threadID!=ab)return;var eb=0,fb=da[':fb:web-messenger:flyoutlist'].build();for(var gb in db){var hb=db[gb],ib=da[':fb:web-messenger:flyoutlist-profile-item'].build();ib.getNode('profilePhoto').setAttribute('src',hb.image_src);var jb=ib.getNode('title');if(hb.href){var kb=r.a({href:hb.href});m.setContent(jb,kb);jb=kb;var lb=ib.getNode('profilePhoto'),mb=r.a({href:hb.href});m.replace(lb,mb);m.setContent(mb,lb);}m.setContent(jb,hb.name);ua(hb,ib.getNode('title'));m.setContent(ib.getNode('infoLine'),xa(hb));eb++;m.appendContent(fb.getNode('list'),ib.getRoot());}var nb=fb.getRoot();this._dialog=new k({context:za,position:'below',addedBehaviors:[t,u,v]},nb);this._flyout=new q();this._flyout.init(this._dialog);this._flyout.initNode(za);wa(this._flyout,nb,eb);}.bind(this));}.bind(this),w.WEBMESSENGER);};sa.prototype.destroy=function(){"use strict";};function ta(za,ab,bb){var cb=s.getShortDisplay(bb);if(!cb||za.get(bb)!==i.MOBILE){ea.remove(ab);return;}ea.set(ab,ma._("Last active {time} ago",[ma.param("time",cb)]),'right');}function ua(za,ab){var bb=x.getUserID(za.id);if(!bb)return;var cb=r.span(null);y.updateOnPresenceChanges(bb,cb);if(m.isNode(ab)){j.loadModules(["PresenceStatus","ChatOpenTab"],function(db,eb){o.listen(cb,'mouseenter',la(ta,db,cb,bb));o.listen(cb,'click',eb.openUserTab.bind(null,bb,'web messenger header'));});m.appendContent(ab,cb);}}function va(za,ab){if(ab)x.getMulti(za.participants,function(bb){var cb=true;for(var db in bb)cb=cb&&bb[db].employee;l.conditionShow(ab,cb);});}function wa(za,ab,bb){if(bb<=fa.MAX_VISIBLE_IN_FLYOUT)return;var cb=z.fromNative(ab,{fade:true});ab.style.height=fa.PARTICIPANTS_FLYOUT_HEIGHT+'px';za.subscribe('show',function(){cb.showScrollbar(false);});}function xa(za){var ab=za.social_snippets||{},bb=Object.keys(ab);if(bb.length>0){var cb=bb.slice(0,1).map(function(hb){return ab[hb];});return cb;}var db=za.networks||{},eb=Object.keys(db),fb=eb.length>0,gb=2;if(fb){var cb=eb.slice(0,gb).map(function(hb){return db[hb];});return cb.join(' \u00b7 ');}return '';}function ya(za,ab,bb,cb){var db=bb.offsetWidth;if(cb){ra=ra||cb.offsetWidth;db+=ra;}var eb=m.scry(document.body,"div._2nd");if(eb.length)db+=eb[0].offsetWidth;var fb=za.parentNode.offsetWidth;if(fb>db)ca.set(za,'max-width',(fb-db)+'px');}e.exports=sa;},null);
__d("WebMessengerFlexibleArea",["Event","ArbiterMixin","CSS","cx","DOM","Style","throttle","Vector","createArrayFrom","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=[];function r(){q.forEach(function(w){w.draw();});}g.listen(window,'resize',m(r,50));var s=p(h);for(var t in s)if(s.hasOwnProperty(t))v[t]=s[t];var u=s===null?null:s.prototype;v.prototype=Object.create(u);v.prototype.constructor=v;v.__superConstructor__=s;function v(w){"use strict";this.minFlexAreaHeight=0;this.flexArea=w;this.container=null;this.padding=0;this.sizeToFit=false;q.push(this);}v.prototype.setContainer=function(w){"use strict";this.container=w;return this;};v.prototype.setPadding=function(w){"use strict";this.padding=w;return this;};v.prototype.setMinFlexAreaHeight=function(w){"use strict";this.minFlexAreaHeight=w;return this;};v.prototype.setSizeToFit=function(w){"use strict";this.sizeToFit=w;return this;};v.prototype.draw=function(){"use strict";if(this.flexArea){var w=this._flexHeight;this.inform('predraw',{old_height:w});var x=n.getViewportDimensions().y-this.padding;x-=n.getElementPosition(this.container||this.flexArea).y;if(this.container){o(this.container.childNodes).forEach(function(y){x-=n.getElementDimensions(y).y;});x+=n.getElementDimensions(this.flexArea).y;}if(this.sizeToFit)x=Math.min(x,this._getNaturalHeight());if(x<this.minFlexAreaHeight)x=this.minFlexAreaHeight;if(isNaN(x)||x<0)x=0;if(x!==w){l.set(this.flexArea,'height',x+'px');this._flexHeight=x;this.inform('height_changed',{height:x,old_height:w});}}return this;};v.prototype.destroy=function(){"use strict";var w=q.indexOf(this);w>=0&&q.splice(w,1);r();};v.prototype._getNaturalHeight=function(){"use strict";var w=this.flexArea.cloneNode(true);i.addClass(w,"_2ys");l.set(w,'height','auto');k.insertAfter(this.flexArea,w);var x=n.getElementDimensions(w).y;k.remove(w);return x;};v.prototype._getFlexHeight=function(){"use strict";if(isNaN(this._flexHeight))this._flexHeight=n.getElementDimensions(this.flexArea).y;return this._flexHeight;};e.exports=v;},null);
__d("WebMessengerFlexibleScrollArea",["CSS","DOMQuery","ScrollableArea","Style","WebMessengerFlexibleArea","throttle"],function(a,b,c,d,e,f,g,h,i,j,k,l){for(var m in k)if(k.hasOwnProperty(m))o[m]=k[m];var n=k===null?null:k.prototype;o.prototype=Object.create(n);o.prototype.constructor=o;o.__superConstructor__=k;function o(p,q){"use strict";this._scroll=i.fromNative(p,q);k.call(this,p);this._scrollBody=h.find(this.flexArea,'.uiScrollableAreaBody');var r=h.scry(this.flexArea,'.uiScrollableAreaShadow');this._shadow=r.length?r[0]:null;this._scrollContent=h.find(this.flexArea,'.uiScrollableAreaContent');this._scrollCallbacks=[];this._drawSubscription=this.subscribe('height_changed',this.poke.bind(this));this._scrollSub=this._scroll.subscribe('scroll',l(this._onScroll,50,this));this._nearTop=false;this._nearBottom=false;}o.prototype.showAtTop=function(p){"use strict";if(p){j.set(this._scrollContent,'top','0');j.set(this._scrollContent,'bottom','');}else{j.set(this._scrollContent,'top','');j.set(this._scrollContent,'bottom','0');}};o.prototype.setBottomAligned=function(p){"use strict";var q=p!==false;if(this._bottomEdgeBias===q)return;g.conditionClass(this.flexArea,'uiScrollableAreaBottomAligned',q);this._bottomEdgeBias=q;if(this._bottomEdgeBias){this.scrollToBottom(false);}else this.scrollToTop(false);setTimeout(this.poke.bind(this),0);return this;};o.prototype.setInfiniteScrollHandler=function(p,q){"use strict";if(q){this._infiniteUpwardScrollHandler=p;}else this._infiniteDownScrollHandler=p;return this;};o.prototype.addScrollCallback=function(p){"use strict";this._scrollCallbacks.push(p);return this;};o.prototype.setTabbable=function(p){"use strict";this._scroll._wrap.setAttribute('tabindex',p?'0':'-1');};o.prototype.poke=function(p,q){"use strict";var r=this._scrollHeight,s=this._scroll.getScrollTop();this._scrollHeight=this._getScrollHeight();if(typeof r=='undefined'||(q&&!q.old_height)){this._bottomEdgeBias&&this._setShadowHeight();return;}var t=this._scrollHeight-r;if(this._bottomEdgeBias){var u=q?q.height-q.old_height:0;clearTimeout(this._pollTimer);this._pollTimer=setTimeout(this.poke.bind(this),200);var v,w=t-u;if(this._scrollHeight>this._getFlexHeight()){v=s+w;v=v<0?0:v;}else v=0;w>0&&this._setShadowHeight();if(v!==s)this._scroll.setScrollTop(v,false);w<0&&this._setShadowHeight();}else if(t)this._scroll.setScrollTop(s,false);};o.prototype.setScrollTop=function(p,q){"use strict";this._scroll.setScrollTop(p,q);};o.prototype.getScrollableArea=function(){"use strict";return this._scroll;};o.prototype.isScrolledToBottom=function(){"use strict";return this._scroll.isScrolledToBottom();};o.prototype.scrollToBottom=function(p){"use strict";this._scroll.scrollToBottom(p);if(this._bottomEdgeBias)this._scrollBottom=0;};o.prototype.isScrolledToTop=function(){"use strict";return this._scroll.getScrollTop()===0;};o.prototype.scrollToTop=function(p){"use strict";this._scroll.scrollToTop(p);};o.prototype.scrollIntoView=function(p,q){"use strict";this._scroll.scrollIntoView(p,q);};o.prototype.destroy=function(){"use strict";this._scrollSub&&this._scrollSub.unsubscribe();this.unsubscribe(this._drawSubscription);clearTimeout(this._pollTimer);n.destroy.call(this);this._scroll.destroy();};o.prototype._getScrollHeight=function(){"use strict";if(this._bottomEdgeBias){return this._scrollContent.offsetHeight;}else return this._scroll.getScrollHeight();};o.prototype._setShadowHeight=function(){"use strict";var p=this._shadowHeight;this._shadowHeight=this._scrollHeight-this._getFlexHeight();if(this._shadowHeight<0)this._shadowHeight=0;if(this._shadowHeight!==p)j.set(this._shadow,'height',this._shadowHeight+'px');};o.prototype._onScroll=function(){"use strict";var p=this._scroll.getScrollTop(),q=this._getScrollHeight();if(p<this._getFlexHeight()){if(!this._nearTop){this._nearTop=true;this._infiniteUpwardScrollHandler&&this._infiniteUpwardScrollHandler();}}else this._nearTop=false;if(p+2*this._getFlexHeight()>q){if(!this._nearBottom){this._nearBottom=true;this._infiniteDownScrollHandler&&this._infiniteDownScrollHandler();}}else this._nearBottom=false;this._scrollCallbacks.forEach(function(r){return r(this._scroll);}.bind(this));};e.exports=o;},null);
__d("WebMessengerDeleteThreadDialog",["Dialog","tx","MercuryThreads"],function(a,b,c,d,e,f,g,h){var i=b('MercuryThreads').get(),j={show:function(k){var l=[];l.push({name:'delete_conversation',label:"Delete Conversation",handler:i.deleteThread.bind(i,k)});l.push(g.CANCEL);new g().setTitle("Delete This Entire Conversation?").setBody("Once you delete your copy of this conversation, it cannot be undone.").setButtons(l).show();}};e.exports=j;},null);
__d("ListInputTargetTracker",[],function(a,b,c,d,e,f){function g(){"use strict";this._index=undefined;this._items=[];}g.prototype.getIndex=function(){"use strict";return this._index;};g.prototype.setIndex=function(h){"use strict";this._index=Math.max(0,Math.min(h,this._items.length-1));};g.prototype.getNumItems=function(){"use strict";return this._items.length;};g.prototype.getItem=function(){"use strict";if(this._index!==undefined)return this._items[this._index];};g.prototype.setTargetItem=function(h){"use strict";this.updateIndex(this._items,h);};g.prototype.addItem=function(h){"use strict";this._items.push(h);};g.prototype.removeItemAtIndex=function(h){"use strict";this._items.splice(h,1);};g.prototype.removeItemByValue=function(h){"use strict";var i=this._items.indexOf(h);this.removeItemAtIndex(i);};g.prototype.moveUp=function(){"use strict";if(this._index===undefined||this._index===0){if(this._items.length){this._index=this._items.length-1;return true;}}else if(this._index>0){this._index--;return true;}return false;};g.prototype.moveDown=function(){"use strict";if(this._index===undefined||this._index===this._items.length-1){if(this._items.length){this._index=0;return true;}}else if(this._index<this._items.length-1){this._index++;return true;}return false;};g.prototype.updateIndex=function(h,i){"use strict";this._items=h||[];if(i){var j=this._items.indexOf(i);if(j>=0){this._index=j;}else if(this._index!==undefined)if(this._items.length>0){this._index=Math.min(this._index,this._items.length-1);}else this._index=undefined;}else this._index=undefined;return this._index;};e.exports=g;},null);
__d("WebMessengerShortcuts",["DialogX","DOM","KeyEventController","LayerHideOnEscape","ListInputTargetTracker","MercuryAPIArgsSource","MessagingTag","Parent","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","UserAgent_DEPRECATED","WebMessengerEvents","BanzaiODS","arrayContains","csx","cx","fbt","ge","shield","tx","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){var ba=b('MercuryThreads').get(),ca=null,da=null,ea=null,fa={g:{callback:la,description:"Search conversations",section:'searchAndHelp',uses_meta:true},m:{callback:ka,description:"Start a new message",section:'navigation',uses_meta:true},i:{callback:ta.bind(null,m.INBOX),description:"Go to Inbox",section:'navigation',uses_meta:true},u:{callback:ta.bind(null,m.OTHER),description:"Go to Other",section:'navigation',uses_meta:true},z:{callback:na,description:"Archive\/unarchive conversation",otherKeys:['y'],section:'conversation',uses_meta:true},r:{callback:oa,description:"Mark message as read\/unread",section:'conversation',uses_meta:true},UP:{callback:pa,description:"Select next conversation",section:'navigation',uses_meta:false},DOWN:{callback:qa,description:"Select previous conversation",section:'navigation',uses_meta:false},q:{callback:z(va),description:"Show\/hide keyboard shortcuts",section:'searchAndHelp',uses_meta:true}},ga={registerGeneralShortcuts:function(){da=new k();for(var wa in fa){var xa=fa[wa],ya=[wa];if(xa.otherKeys)ya=xa.otherKeys.concat(ya);for(var za=0;za<ya.length;za++)i.registerKey(ya[za],xa.callback,ja.bind(null,xa.uses_meta));}},updateThreadlistIndex:function(wa,xa,ya){ca=wa;if(da){if(!u(xa,ya))ya=null;da.updateIndex(xa,ya);}},openSearchThread:function(){var wa=sa(),xa=p.getCurrentMasterState();if(wa&&xa==o.MASTER.SEARCH)ca.openSearchThread(wa);},showOrHideShortcuts:va};function ha(){return r.osx()?'CTRL':'ALT';}function ia(wa){function xa(){if(!ea){var ya=h.find(document.body,"._ksg");ea=[];do{ya=ya.parentNode;ea.push(ya);}while(ya&&ya!==document.body);}return ea;}if(!n.byClass(wa,"_ksg"))if(!u(xa(),wa))if(!h.scry(wa,"._5hu2").length)return false;return true;}function ja(wa,event,xa){if(!i.filterEventTypes(event,xa))return false;if(!ia(event.getTarget()))return false;var ya;if(wa)switch(ha()){case 'CTRL':ya='ctrlKey';break;case 'ALT':ya='altKey';break;}var za=['ctrlKey','metaKey','altKey','shiftKey'];for(var ab=0;ab<za.length;ab++)if(za[ab]!==ya&&event[za[ab]])return false;return !wa||event[ya];}function ka(){t.bumpEntityKey('kbshorts_messenger','kbshorts.compose');p.updateDetailState(o.DETAIL.COMPOSE_MAIN,{start:true});return false;}function la(){t.bumpEntityKey('kbshorts_messenger','kbshorts.search');s.focusAndSelectSearch();return false;}function ma(wa){var xa;if(da.getNumItems()>1){var ya=da.getIndex();da.setIndex(ya===0?1:ya-1);xa=sa();}wa();p.updateDetailState(o.DETAIL.RECENT_MESSAGES,{folder:p.getCurrentStateData().folder,thread_id:xa});if(xa)ca._manager.scrollIntoView(y(da.getItem()),false);}function na(){t.bumpEntityKey('kbshorts_messenger','kbshorts.toggle_archive');var wa=sa();if(wa){ba.getThreadMeta(wa,function(xa){if(xa.folder==m.SPAM)return;ma(function(){ba.changeThreadArchivedStatus(xa.thread_id,!xa.is_archived);});},l.WEBMESSENGER);return false;}}function oa(){var wa=sa();t.bumpEntityKey('kbshorts_messenger','kbshorts.toggle_read_status');if(wa){ba.getThreadMeta(wa,function(xa){var ya=!xa.unread_count;ba.changeThreadReadStatus(wa,!ya);},l.WEBMESSENGER);return false;}}function pa(){t.bumpEntityKey('kbshorts_messenger','kbshorts.go_to_next');if(da)if(da.getIndex()===0){switch(p.getCurrentMasterState()){case o.MASTER.SEARCH:da.moveUp();ra();ca._manager.scrollToBottom(false);break;default:ca._manager.scrollToTop(false);s.focusSearch();}}else{if(da.getItem()){da.moveUp();}else da.moveDown();ra();}return false;}function qa(){t.bumpEntityKey('kbshorts_messenger','kbshorts.go_to_previous');var wa=p.getCurrentMasterState();if(da&&(wa!==o.MASTER.RECENT_THREADS||da.getIndex()<da.getNumItems()-1)){da.moveDown();ra();}return false;}function ra(){var wa=sa();if(wa){var xa=p.getCurrentMasterState();if(xa==o.MASTER.SEARCH){ca.updateKeyboardSelection(wa);s.focusSearch();}else p.updateDetailState(o.DETAIL.RECENT_MESSAGES,{thread_id:wa});if(da)if(da.getIndex()===0){ca._manager.scrollToTop(false);}else ca._manager.scrollIntoView(y(da.getItem()),false);}}function sa(){var wa=da&&da.getItem();if(typeof wa==='string'&&wa.indexOf(':')!==-1)return wa.substr(wa.indexOf(':')+1);return null;}function ta(wa){if(wa===m.INBOX){t.bumpEntityKey('kbshorts_messenger','kbshorts.go_to_inbox');}else if(wa===m.OTHER)t.bumpEntityKey('kbshorts_messenger','kbshorts.go_to_other');var xa=p.getCurrentMasterState(),ya=xa==o.MASTER.SEARCH?null:p.getCurrentStateData().thread_id;p.updateMasterState(o.MASTER.RECENT_THREADS,{thread_id:ya,folder:wa});}var ua;function va(wa){t.bumpEntityKey('kbshorts_messenger','kbshorts.show_or_hide_shortcuts');if(!ua){var xa={};for(var ya in fa){var za=fa[ya];if(!za.uses_meta)continue;var ab=q[':fb:web-messenger:shortcuts-dialog:row'].build(),bb=[ya],cb=[];if(za.otherKeys)bb=za.otherKeys.concat(bb);for(var db=0;db<bb.length;db++){var eb=q[':fb:web-messenger:shortcuts-dialog:key'].build();eb.setNodeContent('meta',ha());eb.setNodeContent('key',bb[db]);cb.push(eb.getRoot());}ab.setNodeContent('keys',cb);ab.setNodeContent('description',za.description);if(!xa[za.section])xa[za.section]=[];xa[za.section].push(ab.getRoot());}var fb=q[':fb:web-messenger:shortcuts-dialog'].build();for(var gb in xa)fb.setNodeContent(gb,xa[gb]);var hb=h.scry(fb.getRoot(),"._1yw")[0],ib=null;if(hb)ib=h.getID(hb);ua=new g({modal:true,titleID:ib,width:565},fb.getRoot());ua.enableBehavior(j);}if(ua.isShown()){ua.hide();}else{ua.show();if(typeof wa==='function')ua.subscribeOnce('hide',wa);}return false;}e.exports=ga;},null);
__d("WebMessengerActionsMenuItem",["CSS","MenuItem","WebMessengerStateManager"],function(a,b,c,d,e,f,g,h,i){for(var j in h)if(h.hasOwnProperty(j))l[j]=h[j];var k=h===null?null:h.prototype;l.prototype=Object.create(k);l.prototype.constructor=l;l.__superConstructor__=h;function l(m){"use strict";m.href=m.href||'#';h.call(this,m);this.setOnClickHandler(this.handleMenuItemClick);this.showFn=this._data.should_show_fn;}l.prototype.handleMenuItemClick=function(){"use strict";var m=i.getCurrentStateData().thread_id;m&&this._data.onclick(m);};l.prototype.updateShownState=function(m){"use strict";if(this.showFn){this._isHidden=!this.showFn(m);if(this._root)g.conditionShow(this._root,!this._isHidden);}};l.prototype.isShown=function(m){"use strict";var n=this.showFn?this.showFn(m):true;return n;};l.prototype.render=function(){"use strict";var m=k.render.call(this);if(this._isHidden)g.hide(m);return m;};e.exports=l;},null);
__d("XMessagingLeaveConversationDialogControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){e.exports=b("XControllerURIBuilder").create("\/leave_conversation\/",{__asyncDialog:{type:"Int"}});},null);
__d("WebMessengerDetailViewActionsMenuControl",["WebMessengerAddPeopleToConversationDialog","AsyncDialog","AsyncRequest","CSS","ChatOpenTab","MercuryConfig","ContextualDialogArrow","DOM","WebMessengerDeleteThreadDialog","Dialog","WebMessengerEditThreadDialog","Event","Input","Keys","Menu","MenuSeparator","MercuryAPIArgsSource","MercuryLogMessageType","MercurySourceType","MercuryThreadMuter","MessagingTag","MercuryParticipants","Popover","PopoverMenu","WebMessengerShortcuts","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","Toggler","URI","WebMessengerActionsMenuItem","WebMessengerSubscriptionsHandler","XMessagingLeaveConversationDialogControllerURIBuilder","XUIMenuTheme","copyProperties","emptyFunction","fbt","goURI","tx","MercuryMessages","MercuryServerRequests","MercuryThreadInformer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa){var ta=b('MercuryMessages').get(),ua=b('MercuryServerRequests').get(),va=b('MercuryThreadInformer').get(),wa=b('MercuryThreads').get();function xa(ic,jc){"use strict";this._rootElement=ic;this._headerControl=jc;this._menuTemplate=ha[':fb:web-messenger:actions-menu'].build();this._newMessageButton=this._menuTemplate.getNode('newMessageButton');this._actionsMenu=this._menuTemplate.getNode('menu');this._searchThreadInput=this._menuTemplate.getNode('searchThreadInput');this._searchThreadButton=this._menuTemplate.getNode('searchThreadButton');this._searchCloseButton=this._menuTemplate.getNode('searchCloseButton');var kc=this._menuTemplate.getNode('actionsButton'),lc=function(event){if(!this._searchMode){za(this,true);}else{var mc=s.getValue(this._searchThreadInput);if(mc){var nc=oa({},ga.getCurrentStateData());oa(nc,{message_query:mc});ga.updateDetailState(fa.DETAIL.SEARCH_THREAD_SNIPPET,nc);this._searchThreadInput.focus();}else za(this,false);}event.kill();}.bind(this);la.addSubscriptions(va.subscribe('threads-updated',function(mc,nc){nc[this._threadID]&&this.updateView();}.bind(this)),r.listen(this._menuTemplate.getNode('newMessageButton'),'click',function(){ga.updateDetailState(fa.DETAIL.COMPOSE_MAIN,oa(ga.getCurrentStateData(),{start:true,thread_id:undefined}));}),r.listen(this._actionsMenu,'keydown',function(event){if(event.keyCode===t.ESC){kc.focus();event.preventDefault();}}),r.listen(this._searchThreadButton,'mousedown',lc),r.listen(this._searchThreadButton,'keydown',function(event){if(event.keyCode===t.RETURN||event.keyCode===t.SPACE)lc(event);}),r.listen(this._searchThreadButton,'click',pa.thatReturnsFalse),r.listen(this._searchCloseButton,'keydown',function(event){if(event.keyCode===t.RETURN||event.keyCode===t.SPACE){bb(this);this._menuTemplate.getNode('searchThreadButton').focus();}}.bind(this)),r.listen(this._searchCloseButton,'mousedown',function(event){bb(this);}.bind(this)),r.listen(this._searchThreadInput,'blur',function(event){var mc=s.getValue(this._searchThreadInput);if(!mc)za(this,false);}.bind(this)),r.listen(this._searchThreadInput,'keyup',function(event){var mc=s.getValue(this._searchThreadInput),nc=oa({},ga.getCurrentStateData());oa(nc,{message_query:mc});if(event.keyCode==t.RETURN&&mc)ga.updateDetailState(fa.DETAIL.SEARCH_THREAD_SNIPPET,nc);if(event.keyCode==t.ESC)s.reset(this._searchThreadInput);}.bind(this)));this.initItems();n.setContent(this._rootElement,this._menuTemplate.getRoot());}xa.prototype.initItems=function(){"use strict";var ic=this._menuTemplate.getNode('actionsButton'),jc=this._menuTemplate.getNode('newMessageButton'),kc=function(){ic.focus();},lc=function(){jc.focus();};this.menuItems=[];this.menuItems.push({ctor:ka,label:"Add People...",onclick:tb,should_show_fn:db},{ctor:ka,label:"Edit Conversation Name...",onclick:vb.bind(null,this),should_show_fn:db},{ctor:ka,label:"Edit Conversation Picture...",onclick:vb.bind(null,this),should_show_fn:db},{ctor:ka,label:"Leave Conversation...",onclick:ub,should_show_fn:db},{ctor:v,should_show_fn:db});this.menuItems.push({ctor:ka,label:"Open in Chat",onclick:eb,should_show_fn:k.canOpenTab},{ctor:ka,label:"View Photos in Thread",onclick:rb},{ctor:ka,label:"Mark as Read",onclick:dc.bind(null,kc),should_show_fn:nb},{ctor:ka,label:"Mark as Unread",onclick:cc.bind(null,kc),should_show_fn:kb(nb)});this.menuItems.push({ctor:v},{ctor:ka,label:"Archive",onclick:xb.bind(null,lc),should_show_fn:kb(mb)},{ctor:ka,label:"Unarchive",onclick:yb.bind(null,lc),should_show_fn:mb},{ctor:ka,label:"Mute Conversation...",onclick:z.showMuteChangeDialog,should_show_fn:kb(z.isThreadMuted)},{ctor:ka,label:"Unmute Conversation",onclick:ab.bind(null,kc),should_show_fn:z.isThreadMuted},{ctor:ka,label:"Move to Inbox",onclick:gb.bind(null,lc,aa.INBOX),should_show_fn:fb.bind(null,aa.OTHER)},{ctor:ka,label:"Delete Conversation...",onclick:jb},{ctor:ka,label:"Delete Messages...",onclick:ec});this.menuItems.push({ctor:v},{ctor:ka,label:"Create Group...",onclick:ac,should_show_fn:hb},{ctor:ka,label:"Create Event...",onclick:bc,should_show_fn:ib},{ctor:ka,label:"Report Spam or Abuse...",onclick:pb.bind(null,kc),should_show_fn:kb(lb)},{ctor:ka,label:"Not Spam",onclick:sb.bind(null,lc),should_show_fn:lb},{ctor:ka,label:"Keyboard Shortcuts",onclick:ea.showOrHideShortcuts.bind(ea,kc)},{ctor:ka,label:"Feedback",onclick:ra.bind(null,'/help/?page=134259426717336')});if(cb())this.menuItems.push({ctor:v},{ctor:ka,label:'Enable bug reporting',onclick:fc.bind(null,kc),should_show_fn:kb(ob)},{ctor:ka,label:'Disable bug reporting',onclick:gc.bind(null,kc),should_show_fn:ob});this._menu=new u(this.menuItems,{theme:na});new da(new ca(ic.parentNode,ic,[m],{alignh:'right'}),ic,this._menu);};xa.prototype.hideView=function(){"use strict";j.hide(this._rootElement);};xa.prototype.updateView=function(){"use strict";this.hideView();var ic=ga.getCurrentDetailState(),jc=false,kc=false,lc=false,mc=false,nc=false,oc=false;switch(ic){case fa.DETAIL.COMPOSE_MAIN:case fa.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:case fa.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:ya(this);this._threadID=null;break;case fa.DETAIL.RECENT_MESSAGES:case fa.DETAIL.SEARCH_CONTEXT:if(this._state!==ic)ya(this);var pc=ga.getCurrentStateData().thread_id;jc=true;if(this._searchMode&&this._threadID===pc){mc=true;}else{ya(this);kc=true;lc=true;}this._threadID=pc;if(this._threadID)nc=true;break;case fa.DETAIL.SEARCH_THREAD_SNIPPET:var qc=ga.getCurrentStateData();s.setValue(this._searchThreadInput,qc.message_query);this._threadID=qc.thread_id;jc=true;mc=true;oc=true;break;case fa.DETAIL.SHARED_PHOTOS:var rc=ga.getCurrentStateData();this._threadID=rc.thread_id;jc=true;kc=true;lc=true;nc=true;break;default:ya(this);jc=true;kc=true;this._threadID=null;break;}this._state=ic;j.conditionShow(this._searchThreadInput,mc);j.conditionShow(this._searchThreadButton,nc);j.conditionShow(this._searchCloseButton,oc);j.conditionShow(this._newMessageButton,kc);j.conditionShow(this._rootElement,jc);this._threadSubscription&&wa.unsubscribe(this._threadSubscription);if(lc&&this._threadID){this._threadSubscription=wa.getThreadMeta(this._threadID,function(sc){this._menu.forEachItem(function(tc){return tc.updateShownState&&tc.updateShownState(sc);});j.show(this._menuTemplate.getNode('menu'));j.show(this._rootElement);}.bind(this),w.WEBMESSENGER);}else j.hide(this._menuTemplate.getNode('menu'));};xa.prototype.destroy=function(){"use strict";};function ya(ic){ic._searchMode=false;s.reset(ic._searchThreadInput);}function za(ic,jc){if(jc){ic._searchMode=true;}else ya(ic);j.conditionShow(ic._newMessageButton,!jc);j.conditionShow(ic._actionsMenu,!jc);j.conditionShow(ic._searchThreadInput,jc);if(jc){ic._searchThreadInput.focus();ia.hide(this._actionsMenu);}}function ab(ic,jc){wa.updateThreadMuteSetting(jc,0);ia.hide();ic();}function bb(ic){za(ic,false);j.conditionShow(ic._searchThreadButton,true);j.conditionShow(ic._searchCloseButton,false);var jc=ga.getCurrentDetailState();if(jc!==fa.DETAIL.RECENT_MESSAGES)ga.updateDetailState(fa.DETAIL.RECENT_MESSAGES,{thread_id:ga.getCurrentStateData().thread_id});}function cb(){var ic=ba.getNow(ba.user);return ic&&ic.employee;}function db(ic){return !ic.is_canonical&&ic.is_subscribed&&!ic.has_email_participant&&!ic.read_only;}function eb(ic){k.openThread(ic,'WebMessengerDetailViewActionsMenuControl');}function fb(ic,jc){return !jc.is_archived&&jc.folder==ic;}function gb(ic,jc,kc){wa.changeFolder(kc,jc);hc();ic();}function hb(ic){var jc=zb(ic.participants);return jc.length>2;}function ib(ic){var jc=zb(ic.participants);return jc.length>2&&l.GroupChatEventCreateButton;}function jb(ic){o.show(ic);}function kb(ic){return function(){return !ic.apply(this,arguments);};}function lb(ic){return ic.folder===aa.SPAM;}function mb(ic){return ic.is_archived;}function nb(ic){return ic.unread_count>0;}function ob(){return ga.getCurrentStateData().bug_reporting_enabled;}function pb(ic,jc){var kc=wa.getThreadMetaNow(jc),lc;if(kc&&kc.message_count==1){lc=ha[':fb:web-messenger:report-dialog-single-message'].build();}else lc=ha[':fb:web-messenger:report-dialog'].build();var mc=lc.getRoot(),nc=[p.OK,p.CANCEL];new p().setTitle("Report Spam or Abuse").setBody(mc).setButtons(nc).setHandler(qb.bind(null,jc,mc)).setCancelHandler(ic).show();}function qb(ic,jc){var kc=n.find(jc,'.markSpam'),lc=n.scry(jc,'.markSpamMessages')[0];if(kc.checked){wa.markThreadSpam(ic);hc();}else if(lc&&lc.checked){var mc=oa({},ga.getCurrentStateData());oa(mc,{message_action:fa.MESSAGE_ACTION.REPORT_SPAM});ga.updateDetailState(ga.getCurrentDetailState(),mc);}else{var nc=n.find(jc,'.reportUsers');if(nc.checked){ua.getServerThreadID(ic,function(oc){p.bootstrap('/ajax/messaging/report/',{tid:oc});});}else return false;}}function rb(ic){var jc=oa({},ga.getCurrentStateData());ga.updateDetailState(fa.DETAIL.SHARED_PHOTOS,jc);}function sb(ic,jc){wa.unmarkThreadSpam(jc);hc();ic();}function tb(ic){g.show(ic);}function ub(ic){var jc=new ma().getURI();h.send(new i(jc),function(kc){kc.subscribe('confirm',function(){wb(ic);kc.hide();});});}function vb(ic,jc){var kc=new q();kc.toggleShown(ic._headerControl?ic._headerControl._headerBar.getNode('headerName'):ic._rootElement,jc);}function wb(ic){ta.sendMessage(ta.constructLogMessageObject(y.TITAN_WEB,ic,x.UNSUBSCRIBE,{removed_participants:[ba.user]}),null,w.WEBMESSENGER);return true;}function xb(ic,jc){wa.changeThreadArchivedStatus(jc,true);hc();ic();}function yb(ic,jc){wa.changeThreadArchivedStatus(jc,false);hc();ic();}function zb(ic){var jc=[];for(var kc=0;kc<ic.length;kc++){var lc=ic[kc];if(/^fbid:\d+$/.test(lc))jc.push(lc.substr(5));}return jc;}function ac(ic){wa.getThreadMeta(ic,function(jc){var kc=zb(jc.participants),lc=ja('/ajax/groups/create_get.php').addQueryData({ref:'web_messenger',members:kc,parent_id:'0'});h.send(new i(lc));},w.WEBMESSENGER);}function bc(ic){wa.getThreadMeta(ic,function(jc){var kc=zb(jc.participants),lc=ja('/ajax/plans/create/dialog.php').addQueryData({invite_ids:kc,eventname:jc.name,group_chat:true});h.send(new i(lc));},w.WEBMESSENGER);}function cc(ic,jc){wa.changeThreadReadStatus(jc,false);ia.hide();ic();}function dc(ic,jc){wa.changeThreadReadStatus(jc,true);ia.hide();ic();}function ec(){var ic=oa({},ga.getCurrentStateData());oa(ic,{message_action:fa.MESSAGE_ACTION.DELETE});ga.updateDetailState(ga.getCurrentDetailState(),ic);}function fc(ic){var jc=oa({},ga.getCurrentStateData());jc.bug_reporting_enabled=true;ia.hide();ga.updateDetailState(ga.getCurrentDetailState(),jc);ic();}function gc(ic){var jc=oa({},ga.getCurrentStateData());jc.bug_reporting_enabled=false;ia.hide();ga.updateDetailState(ga.getCurrentDetailState(),jc);ic();}function hc(){ga.updateDetailState(fa.DETAIL.RECENT_MESSAGES,{folder:ga.getCurrentStateData().folder});}e.exports=xa;},null);
__d("ExpandableDataSource",["DataSource"],function(a,b,c,d,e,f,g){for(var h in g)if(g.hasOwnProperty(h))j[h]=g[h];var i=g===null?null:g.prototype;j.prototype=Object.create(i);j.prototype.constructor=j;j.__superConstructor__=g;function j(k,l,m){"use strict";this._initialLimit=l;this._moreResultsLimit=m;this._states={};k=k||{};k.maxResults=this._initialLimit;g.call(this,k);}j.prototype.query=function(k,l,m){"use strict";this.setQueryData({offset:0,limit:this._initialLimit});i.query.call(this,k,l,m);};j.prototype.fetchHandler=function(k,l){"use strict";var m=k.getPayload(),n=l.value;this.getState('is_loading_more_per_query')[n]=false;this.getState('total_results_count_per_query')[n]=m.total_count;i.fetchHandler.call(this,k,l);};j.prototype.loadMore=function(){"use strict";if(this.value&&!this.hasLoadedAllResults()){var k=this.getState('max_results_per_query');if(!k[this.value])k[this.value]=this._initialLimit;this.setQueryData({offset:k[this.value],limit:this._moreResultsLimit});k[this.value]+=this._moreResultsLimit;if(k[this.value]>this._maxResults)this._maxResults=k[this.value];this.getState('is_loading_more_per_query')[this.value]=true;this.fetch(this.queryEndpoint,this.getQueryData(this.value,this.buildUids(this.value)),{value:this.value});}};j.prototype.isLoadingMore=function(){"use strict";return this.getState('is_loading_more_per_query')[this.value];};j.prototype.hasLoadedAllResults=function(){"use strict";var k=this.getState('total_results_count_per_query')[this.value],l=(this.buildQueryResults(this.value)||[]).length;return k&&l>=k;};j.prototype.getStates=function(){"use strict";return this._states;};j.prototype.getState=function(k){"use strict";var l=this.getStates();if(!l[k])l[k]={};return l[k];};j.prototype.getQueryCache=function(){"use strict";return this.getState('query_cache');};e.exports=j;},null);
__d("WebMessengerDetailViewAllPeopleResultsControl",["Event","CSS","DataStore","DOM","ExpandableDataSource","MercuryIDs","Parent","WebMessengerStateConstants","WebMessengerStateManager","Token","WebMessengerEvents","cx","WebMessengerSubscriptionsHandler","copyProperties","WebMessengerTemplates"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){var v=5,w=5;function x(ca){"use strict";this._rootElement=ca;j.empty(this._rootElement);var da=u[':fb:web-messenger:all-people-results'].build();j.setContent(this._rootElement,da.getRoot());this._loadingSpinner=da.getNode('loadingSpinner');this._peopleResults=da.getNode('results');this._loadMoreButton=da.getNode('loadMoreButton');this._loadMoreLink=da.getNode('loadMoreLink');s.addSubscriptions(g.listen(this._loadMoreLink,'click',function(){h.addClass(this._loadMoreButton,'async_saving');this._peopleDataSource&&this._peopleDataSource.loadMore();}.bind(this)));}x.prototype.hideView=function(){"use strict";h.hide(this._rootElement);};x.prototype.updateView=function(){"use strict";var ca=o.getCurrentDetailState();if(ca==n.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS){h.show(this._rootElement);y(this);q.detailDOMChanged();}};x.prototype.destroy=function(){"use strict";};function y(ca){h.show(ca._loadingSpinner);h.hide(ca._peopleResults);h.hide(ca._loadMoreButton);var da=o.getCurrentStateData(),ea=da.all_people_query||'';z(ca);var fa=(da.participants||[]).map(function(ga){return l.tokenize(ga).value;});ca._peopleDataSource.setExclusions(fa);ca._peopleDataSource.query(ea);}function z(ca){if(!ca._peopleDataSource){ca._peopleDataSource=new k({queryEndpoint:'/ajax/mercury/search_people.php'},v,w);ca._peopleDataSource.init();s.addSubscriptions(ca._peopleDataSource.subscribe('respond',aa.bind(null,ca)),g.listen(ca._rootElement,'click',function(event){var da=event.getTarget().parentNode;if(h.hasClass(da,"_4wt"))ba(event.getTarget(),ca._peopleDataSource);}));}}function aa(ca,da,ea){var fa=o.getCurrentDetailState(),ga=o.getCurrentStateData();if(fa==n.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS&&ga.all_people_query==ea.value){j.empty(ca._peopleResults);h.show(ca._peopleResults);ea.results.forEach(function(ha){var ia=j.create('div',{className:'personResult'},ha.detail_markup);i.set(ia,'uid',ha.uid);j.appendContent(ca._peopleResults,ia);});if(ea.results.length){h.hide(ca._loadingSpinner);h.conditionShow(ca._loadMoreButton,!ca._peopleDataSource.hasLoadedAllResults());h.conditionClass(ca._loadMoreButton,'async_saving',ca._peopleDataSource.isLoadingMore());}}}function ba(ca,da){var ea=m.byClass(ca,'personResult'),fa=da.getEntry(i.get(ea,'uid')),ga=t(o.getCurrentStateData(),{new_tokens:[new p(fa)],start:false});o.updateDetailState(n.DETAIL.COMPOSE_MAIN,ga);}e.exports=x;},null);
__d("WebMessengerComposerTypeaheadView",["BucketedTypeaheadView","MercuryConstants","CSS","DataStore","WebMessengerStateConstants","WebMessengerStateManager","copyProperties","cx","fbt","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){for(var q in g)if(g.hasOwnProperty(q))s[q]=g[q];var r=g===null?null:g.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=g;function s(w,x){"use strict";g.call(this,w,x);var y=h.MercuryTypeaheadConstants;this.typeObjects={};this.typeObjects[y.FRIEND_TYPE]={disabled:true,uid:y.FRIEND_TYPE,type:y.HEADER_TYPE};this.typeObjects[y.THREAD_TYPE]={uid:y.THREAD_TYPE,text:"Group Conversations",type:y.HEADER_TYPE,linkText:"Show More",getLinkHandler:v.bind(null,this)};this.typeObjects[y.FB4C_TYPE]={uid:y.THREAD_TYPE,text:"Co-workers",type:y.HEADER_TYPE};this.typeObjects[y.NON_FRIEND_TYPE]={uid:y.NON_FRIEND_TYPE,text:"Other People",type:y.HEADER_TYPE,linkText:"Show All",getLinkHandler:function(){return function(){u(this.value);}.bind(this);}.bind(this)};}s.prototype.setTypeahead=function(w){"use strict";r.setTypeahead.call(this,w);var x=j.get(w,'Typeahead');x.subscribe('loading',function(y,z){var aa=x.getData();if(this._threadHeader)i.conditionClass(this._threadHeader,"_355",aa.isLoadingMore(this.value));}.bind(this));};s.prototype.setNewHeader=function(w,x){"use strict";if(x.uid===h.MercuryTypeaheadConstants.THREAD_TYPE)this._threadHeader=w;};s.prototype.mouseover=function(event){"use strict";if(!t(this,event))r.mouseover.call(this,event);};s.prototype.mouseup=function(event){"use strict";if(!t(this,event))r.mouseup.call(this,event);};s.prototype.clearSelected=function(){"use strict";this.index=-1;this.highlight(-1);};function t(w,event){var x=w.getIndex(event);return x>=0&&x<w.results.length&&w.results[x].type==h.MercuryTypeaheadConstants.HEADER_TYPE;}function u(w){var x=m(l.getCurrentStateData(),{all_people_query:w,start:false});l.updateDetailState(k.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS,x);}function v(w){var x=j.get(w.typeahead,'Typeahead'),y=x.getData();if(y.hasLoadedInitialResults(w.value)&&!y.hasLoadedAllResults(w.value))return y.loadMore.bind(y);}e.exports=s;},null);
__d("MercuryDataSourceHelper",["MercuryPayloadSource","MercuryThreadMetadataRawRenderer","WebMessengerConstants","MercuryServerRequests","MercuryThreadMetadataRenderer"],function(a,b,c,d,e,f,g,h,i){var j=b('MercuryServerRequests').get(),k=b('MercuryThreadMetadataRenderer').get(),l={updateMercuryOnFetchComplete:function(m){m.subscribe('fetchComplete',function(n,o){var p={participants:[],threads:[],pages:[],payload_source:g.SERVER_SEARCH};o.response.getPayload().entries.forEach(function(q){if(q.type==i.THREAD_TYPE){p.threads=p.threads.concat(q.mercury_thread);p.participants=p.participants.concat(q.participants_to_render);}else if(q.type==i.PAGE_TYPE)p.pages=p.pages.concat(q);});if(p.threads.length){j.handleUpdate(p);o.response.getPayload().entries.forEach(function(q){if(q.mercury_thread)q.text=k.renderThreadNameAndParticipantList(q.mercury_thread.thread_id,q.participants_to_render,q.mercury_thread.participants.length,{last_separator_uses_and:false,names_renderer:h.renderShortNames});});}});}};e.exports=l;},null);
__d("WebMessengerTypeaheadRenderer",["MercuryConstants","DOM","MercuryAPIArgsSource","MercuryTypeaheadRenderer","React","SplitImage.react","WebMessengerTemplates","MercuryThreadMetadataRawRenderer","MercuryServerRequests","MercuryThreadMetadataRenderer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=b('MercuryServerRequests').get(),p=b('MercuryThreadMetadataRenderer').get(),q=b('MercuryThreads').get();function r(t,u){var v;switch(t.type){case g.MercuryTypeaheadConstants.HEADER_TYPE:v=m[':fb:web-messenger:typeahead-header'].build();j.renderHeader(v,t);if(this.setNewHeader)this.setNewHeader(v.getRoot(),t);break;case g.MercuryTypeaheadConstants.USER_TYPE:case g.MercuryTypeaheadConstants.PAGE_TYPE:v=m[':fb:web-messenger:threadlist-row'].build();j.renderPersonWithBigPhoto(v,t);break;case g.MercuryTypeaheadConstants.THREAD_TYPE:v=m[':fb:web-messenger:threadlist-row'].build();s(v,t);break;default:return h.create('div');}return v.getRoot();}function s(t,u){var v=o.getClientThreadIDNow(u.uid),w=u.participants_to_render.map(function(z){return z.big_image_src||z.image_src;}),x=k.createElement(l,{srcs:w,border:true,size:50});k.renderComponent(x,t.getNode('image'));var y=p.renderThreadNameAndParticipantList(v,u.participants_to_render,u.mercury_thread.participants.length,{last_separator_uses_and:false,names_renderer:n.renderShortNames});h.setContent(t.getNode('name'),y);t.getRoot().setAttribute('aria-label',y);q.getThreadMeta(v,function(z){p.renderSnippet(z,t.getNode('snippet'));p.renderTimestamp(t.getNode('timestamp'),z.timestamp_absolute,z.timestamp_relative,z.timestamp);},i.WEBMESSENGER);}e.exports=r;},null);
__d("WebMessengerDetailViewComposeTypeaheadControl",["Event","WebMessengerComposerTypeaheadView","MercuryConstants","CSS","WebMessengerDataSources","DOM","MercuryFolders","Keys","MercuryDataSourceHelper","MercuryParticipantTypes","MercuryTypeahead","MercuryParticipants","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerEvents","WebMessengerSubscriptionsHandler","WebMessengerTypeaheadRenderer","copyProperties","tx","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){var aa=b('MercuryThreads').get();function ba(fa,ga){"use strict";this._typeaheadRoot=fa;this._resultsRoot=ga;l.empty(this._typeaheadRoot);l.empty(this._resultsRoot);}ba.prototype.hideView=function(){"use strict";j.hide(this._typeaheadRoot);j.hide(this._resultsRoot);};ba.prototype.updateView=function(){"use strict";var fa=s;switch(t.getCurrentDetailState()){case fa.DETAIL.COMPOSE_MAIN:this.renderComposeTypeahead();j.hide(this._resultsRoot);break;case fa.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:this.renderComposeTypeahead();j.show(this._resultsRoot);break;}v.detailDOMChanged();};ba.prototype.renderComposeTypeahead=function(){"use strict";var fa=t.getCurrentStateData();j.show(this._typeaheadRoot);j.show(this._resultsRoot);if(!this._initiated){var ga=u[':fb:web-messenger:read-view:compose:typeahead'].build();l.setContent(this._typeaheadRoot,ga.getRoot());var ha=u[':fb:web-messenger:read-view:compose:typeahead:results'].build();l.setContent(this._resultsRoot,ha.getRoot());this._initialResultsLoadingSpinner=ha.getNode('initialResultsLoadingSpinner');this._typeaheadFooter=ha.getNode('typeaheadFooter');this._moreResultsLink=ha.getNode('moreResultsLink');this._typeaheadCaption=ha.getNode('caption');this.buildTypeahead(ha.getNode('results'));l.appendContent(ga.getNode('typeahead'),this._typeahead.getElement());this._initiated=true;}if(fa.start){if(!fa.participants)this._typeahead.reset();this._typeahead.focus();var ia=this._typeahead.getTypeahead().getCore();ia.getElement().removeAttribute('disabled');}da(this);if(fa.start)t.updateDetailState(t.getCurrentDetailState(),y({},t.getCurrentStateData(),{start:false,new_tokens:undefined}));};ba.prototype.buildTypeahead=function(fa){"use strict";if(this._typeahead)return;var ga=k.WebMessengerComposerDataSource;o.updateMercuryOnFetchComplete(ga);var ha=new q(ga,h);ha.setPlaceholder("Name");ha.setViewNodeID(fa);ha.setViewOption('renderer',x);w.addSubscriptions(ha.subscribe('tokens-changed',this.onTokensChanged.bind(this)));ha.build();w.addSubscriptions(ha.getTypeahead().subscribe(['respond','focus'],function(){ca(!!ha.getTypeahead().getCore().getValue());}),ha.getTypeahead().subscribe(['reset','blur'],function(){ca(false);}),ha.getTypeahead().subscribe('render',function(ia,ja){ea(this,ja.length);}.bind(this)),ha.getTypeahead().subscribe('reset',function(){ea(this,false);}.bind(this)),ha.getTypeahead().subscribe('query',function(ia,ja){l.setContent(this._moreResultsLink,z._("See more results for {query}",{query:ja.value}));}.bind(this)),g.listen(ha.getElement(),'keydown',function(ia){if(ia.keyCode===n.TAB&&!ia.getModifiers().any){v.focusComposer();return false;}}),g.listen(this._typeaheadFooter,'mousedown',function(){return false;}),g.listen(this._moreResultsLink,'click',function(){var ia=this._typeahead.getTypeahead().getCore().getValue(),ja=y(t.getCurrentStateData(),{all_people_query:ia,start:false});t.updateDetailState(s.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS,ja);}.bind(this)),g.listen(this._typeaheadFooter,'mouseover',function(){this._typeahead.getTypeahead().getView().clearSelected();}.bind(this)));this._typeahead=ha;};ba.prototype.onTokensChanged=function(){"use strict";var fa=t.getCurrentDetailState();if(fa==s.DETAIL.COMPOSE_MAIN||fa==s.DETAIL.COMPOSE_TYPEAHEAD_RESULTS||fa==s.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS){var ga=this._typeahead,ha=ga.getTokens(),ia=ha[ha.length-1];if(ia&&ia.getInfo().mercury_thread){var ja=ia.getInfo().mercury_thread.thread_id,ka=m.getFromMeta(aa.getThreadMetaNow(ja));t.updateDetailState(s.DETAIL.RECENT_MESSAGES,{thread_id:ja,folder:ka,reuse_composer:true});}else{var la=ha.map(function(na){if(na.getInfo().type==i.MercuryTypeaheadConstants.USER_TYPE||na.getInfo().type==i.MercuryTypeaheadConstants.PAGE_TYPE){return 'fbid:'+na.getValue();}else return 'email:'+na.getValue();}),ma=t.getCurrentStateData();if(!ma.start||(la||[]).length)t.updateDetailState(s.DETAIL.COMPOSE_MAIN,y({},ma,{participants:la}));}}};ba.prototype.destroy=function(){"use strict";};function ca(fa){var ga=t.getCurrentDetailState(),ha=s;if(ga!=ha.DETAIL.COMPOSE_MAIN&&ga!=ha.DETAIL.COMPOSE_TYPEAHEAD_RESULTS)return;var ia;if(fa){ia=ha.DETAIL.COMPOSE_TYPEAHEAD_RESULTS;}else if(ga==ha.DETAIL.COMPOSE_TYPEAHEAD_RESULTS){ia=ha.DETAIL.COMPOSE_MAIN;}else ia=ga;if(ia!=ga){var ja=y(t.getCurrentStateData(),{start:false,new_tokens:undefined});t.updateDetailState(ia,ja);}}function da(fa){var ga=t.getCurrentStateData();if(ga.new_tokens){var ha=fa._typeahead.getTypeahead().getCore();ha.reset();ga.new_tokens.forEach(function(ka){fa._typeahead.getTokenizer().addToken(ka);});if(ga.new_tokens.length==1){var ia=ga.new_tokens[0],ja=r.getNow('fbid:'+ia.getValue());if(ja&&ja.type==p.PAGE)ha.getElement().setAttribute('disabled','disabled');}}}function ea(fa,ga){var ha=fa._typeahead.getTypeahead(),ia=ha.getCore().getValue(),ja=ha.getData().hasLoadedInitialResults(ia);j.conditionShow(fa._initialResultsLoadingSpinner,!ja);j.conditionShow(fa._moreResultsLink,ja&&ga);if(!ga&&ja){l.setContent(fa._typeaheadCaption,"No results found");}else l.setContent(fa._typeaheadCaption,"Displaying top results");}e.exports=ba;},null);
__d("WebMessengerUnseenMessageNoticeRenderer",["JSXDOM","ContextualLayer","LayerFadeOnHide","cx","tx","Event"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m={renderNoticeTooltip:function(o,p){var q=g.div({className:"_40p"},n(o),g.i({className:"_40q"})),r=new h(p||{},q).enableBehavior(i);return r;}};function n(o){var p=g.div({className:"_40r"},"You have new messages");l.listen(p,'click',o);return p;}e.exports=m;},null);
__d("WebMessengerDetailViewUnreadMessagesNotice",["WebMessengerStateManager","throttle","UserActivity","WebMessengerMessagesNotice","WebMessengerConstants","WebMessengerSubscriptionsHandler","MercuryThreadInformer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=b('MercuryThreadInformer').get(),n=b('MercuryThreads').get(),o=k.MESSAGE_NOTICE_INACTIVITY_THRESHOLD;for(var p in j)if(j.hasOwnProperty(p))r[p]=j[p];var q=j===null?null:j.prototype;r.prototype=Object.create(q);r.prototype.constructor=r;r.__superConstructor__=j;function r(s){"use strict";j.call(this);this._manager=s;l.addSubscriptions(m.subscribe('thread-read-changed',this._updateReadStatus.bind(this)));this._manager.addScrollCallback(h.withBlocking(function(t){if(this._shouldMarkAsRead(t)){this.removeMessageNotice();if(i.isActive(5000)){var u=g.getCurrentStateData().thread_id;n.changeThreadReadStatus(u,true);}else i.subscribeOnce(function(){if(this._shouldMarkAsRead(t)){var v=g.getCurrentStateData().thread_id;n.changeThreadReadStatus(v,true);}}.bind(this));}}.bind(this),100,null));}r.prototype.updateOnMessagesReceived=function(s,t,u,v){"use strict";var w=!i.isActive(o);if(!q.getActive.call(this))return;if(w||q.onlyReceivedFromSelf.call(this,v)){this.removeMessageNotice();this._manager.scrollToBottom(true);}else if(!this._manager.isScrolledToBottom()){var x=u-(t-s);this._manager.setScrollTop(x,false);this.showMessageNotice();}};r.prototype.showMessageNotice=function(){"use strict";var s=function(){this._manager.scrollToBottom();}.bind(this);q.showMessageNotice.call(this,s,'above');};r.prototype._shouldMarkAsRead=function(s){"use strict";var t=g.getCurrentStateData().thread_id;return t&&q.getActive.call(this)&&s.isScrolledToBottom();};r.prototype._updateReadStatus=function(s,t){"use strict";var u=g.getCurrentStateData().thread_id;if(u&&t[u]&&t[u].mark_as_read)this.removeMessageNotice();};e.exports=r;},null);
__d("MercuryListUpdateRenderer",["DOM","ge"],function(a,b,c,d,e,f,g,h){var i={updateList:function(j,k,l,m,n){var o=[];for(var p=0;p<k.length;p++){if(n){var q=n(p);q&&o.push(q);}var r=h(k[p]);if(r&&l(p)){o.push(r);}else o.push(m(p));}g.setContent(j,o);}};e.exports=i;},null);
__d("WebMessengerMessageIDFinder",["DataStore","DOM","csx"],function(a,b,c,d,e,f,g,h,i){var j={findAll:function(k){var l=h.scry(k,"._53"),m=[];if(l.length){var n=l[0];for(var o=0;o<n.childNodes.length;o++)m.push(g.get(n.childNodes[o],'MessageRenderer:messageID'));}return m;}};e.exports=j;},null);
__d("WebMessengerMessagesSelection",["CSS","csx","DOM","getObjectValues","WebMessengerMessageIDFinder"],function(a,b,c,d,e,f,g,h,i,j,k){var l={};function m(p,q){var r=p,s=q;if(r==s)return 0;while(true){r=r.nextSibling;s=s.nextSibling;if(!r||s==p){return 1;}else if(!s||r==q)return -1;}}function n(p,q){var r=p.id,s=i.scry(p,"._yh input")[0];if(q){l[r]=p;g.addClass(p,'selected');s.checked=true;}else{delete l[r];g.removeClass(p,'selected');s.checked=false;}}var o={clear:function(){for(var p in l)n(l[p],false);},selectClick:function(p){n(p,!(p.id in l));},getSelectedMessageIDs:function(){var p=j(l);p.sort(m);var q=[];p.forEach(function(r){q=q.concat(k.findAll(r));});return q;}};e.exports=o;},null);
__d("MessagingConst",["copyProperties"],function(a,b,c,d,e,f,g){var h={APP_ID:313785040330,XD_MESSAGE:{SANDBOX_READY:'sandbox_ready',SET_CONTENT:'set_content',HTML_SIZE:'html_size',REFRESH_SIZE:'refresh_size'},SHINGLE_SCROLL_TRIGGER:5,EVENTS:{MESSAGE_SENT:'messaging/message_sent'},initConstants:function(i){g(h,i);}};e.exports=h;},null);
__d("MessagingXD",["Event","DOM","MercuryConstants","MessagingConst","URI","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l){function m(n){this._listeners=[g.listen(window,'message',this._onPostMessage.bind(this))];this._iframes={};this._contentWindows={};this._messageHandler=n;}l(m.prototype,{unload:function(){this._listeners.forEach(function(n){n.remove();});},createIframe:function(n,o,p){var q=new k(p);this._iframes[o]=h.create('iframe',{name:o,frameBorder:0,src:q.toString()});h.appendContent(n,this._iframes[o]);this._contentWindows[o]=this._iframes[o].contentWindow;return this._iframes[o];},sendMessage:function(n,o){var p=Array.prototype.slice.apply(arguments);p[0]=j.APP_ID;var q=this._iframes[n].contentWindow||this._contentWindows[n];q.postMessage(p.join(','),i.Sandbox.ORIGIN);},_onPostMessage:function(event){if(event.origin!==i.Sandbox.ORIGIN||!event.data.split)return;var n=event.data.split(','),o=unescape(n[1]);this._contentWindows[o]=event.source;this._messageHandler(o,n);}});e.exports=m;},null);
__d("HTMLEmailRenderer",["CSS","MessagingConst","MessagingXD","copyProperties","emptyFunction","tx","MercuryConstants"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(o,p){this._resizeContent=o.resizeContent||k;this._richMap={};this._useFBStyle=p;this._xdc=new i(this.onXDMessage.bind(this));this._maxWidth=0;}j(n.prototype,{onXDMessage:function(o,p){if(p[0]!=h.APP_ID.toString())return;if(this._richMap&&this._richMap[o])if(p[2]==h.XD_MESSAGE.SANDBOX_READY){return this.setIframeContent(o);}else if(p[2]==h.XD_MESSAGE.HTML_SIZE)return this._resizeContent(o,parseInt(p[3],10),parseInt(p[4],10),p[5]=='true',p[6]=='true');},setIframeContent:function(o,p){this._xdc.sendMessage(o,h.XD_MESSAGE.SET_CONTENT,escape(this._richMap[o]),this._useFBStyle?'useFBStyle':'',p?'forceDialogOnWide':'',escape("Show Hidden Text"),escape("Hide"),this._maxWidth);},makeRich:function(o,p,q,r){var s=this._xdc.createIframe(p,o,m.Sandbox.PAGE_URL);g.addClass(s,'xdIframe');this._richMap[o]=q;this._maxWidth=r||0;},updateRichMap:function(o,p){this._richMap[o]=p;},unload:function(){this._xdc.unload();}});e.exports=n;},null);
__d("WebMessengerThreadMessagesRenderer",["Event","AsyncRequest","MercuryAttachment","MercuryAttachmentRenderer","CSS","DOM","DataStore","HTMLEmailRenderer","HovercardLink","Image.react","ImmutableObject","LinkController","MercuryLogMessageRenderer","MercuryActionTypeConstants","MercuryAttachmentType","MercuryErrorInfo","MercuryMessageError.react","MercuryThreadlistConstants","MercuryTimePassed","MercuryMessageRenderer","WebMessengerMessagesSelection","Parent","MercuryParticipants","MercuryParticipantsConstants","React","WebMessengerStateManager","MercuryStatusTemplates","Style","WebMessengerTemplates","Vector","WebMessengerConstants","WebMessengerEvents","WebMessengerSubscriptionsHandler","csx","cx","formatDate","ge","isRTL","tx","MercuryMessages","MercuryThreadMetadataRenderer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa){'use strict';var ta=b('MercuryMessages').get(),ua=b('MercuryThreadMetadataRenderer').get(),va={updateSelection:function(ya){var za=fa.getCurrentStateData().message_action;k.conditionClass(ya,'selectionEnabled',za);},setupSelectionListener:function(ya){r.registerHandler(function(za){var ab=fa.getCurrentStateData().message_action;if(ab&&ba.byClass(za,'webMessengerMessageGroup'))return false;});ma.addSubscriptions(g.listen(ya,'click',function(event){var za=fa.getCurrentStateData().message_action;if(za){var ab=null;for(var bb=event.getTarget();bb;bb=bb.parentNode)if(k.hasClass(bb,'webMessengerMessageGroup'))ab=bb;ab&&aa.selectClick(ab);}}));},renderForwardedMessages:function(ya,za){var ab=va.calculateMessageGroups(za),bb=null;ab.forEach(function(cb){var db=va.renderMessageGroupArray(cb,true);l.appendContent(ya,db.getRoot());bb=cb[cb.length-1];});},calculateMessageGroups:function(ya){var za=[],ab=null,bb=null;for(var cb=0,db=ya.length;cb<db;cb++){var eb=ya[cb],fb=va.canAppendMessageToLastGroup(bb,eb);if(!fb){ab=[];za.push(ab);}ab.push(eb);bb=eb;}return za;},canAppendMessageToLastGroup:function(ya,za){var ab=x.GROUPING_THRESHOLD;if(!ya||wa(ya)||wa(za)||ya.author!=za.author||ya.timestamp<za.timestamp-ab||ya.is_spoof_warning!==za.is_spoof_warning)return false;return true;},renderMessageGroupArray:function(ya,za,ab){var bb=va.renderMessageGroup(ya[0],za,ab);for(var cb=1;cb<ya.length;cb++)va.appendMessageToGroup(bb,ya[cb]);return bb;},renderMessageGroup:function(ya,za,ab){var bb=ya.action_type==t.LOG_MESSAGE,cb=bb?ia[':fb:web-messenger:read-view:log-message'].build():ia[':fb:web-messenger:read-view:message-group'].build();cb.getRoot().setAttribute('id',(ab||'wm:')+ya.message_id);if(bb){va.renderSingleLogMessage(cb,ya);}else ca.get(ya.author,function(db){va.renderSingleMessage(cb,ya,db,za);});return cb;},appendMessageToGroup:function(ya,za){var ab=ia[':fb:web-messenger:read-view:message'].build();if(za.is_filtered_content){var bb=ga[':fb:mercury:filtered-message'].build();ab.setNodeContent('message',bb.getRoot());}else ab.setNodeContent('message',z.formatMessageBody(za.body,null,true));ea.renderComponent(ea.createElement(w,{message:new q(za)}),ab.getNode('status'));var cb=ab.getRoot();m.set(cb,'MessageRenderer:messageID',za.message_id);k.addClass(ab.getNode('message'),ra(za.body)?'direction_rtl':'direction_ltr');l.appendContent(ya.getNode('bodyDiv'),cb);ca.get(ca.user,function(db){if(db.employee)l.setContent(ab.getNode('bugReporting'),ia[':fb:web-messenger:bug-reporting'].render());});},renderSingleLogMessage:function(ya,za){var ab=ya.getNode('attachment');s.renderLegacy(ya.getNode('icon'),ya.getNode('message'),ab,za);va.renderStatus(ya,za);if(za.log_message_data.image)k.addClass(ab.firstChild,"_1_vi");ua.renderTimestamp(ya.getNode('timestamp'),za.timestamp_absolute,za.timestamp_relative,za.timestamp);},renderMessageSeparator:function(ya){var za=ia[':fb:mercury:timestamp'].render();za.removeAttribute('title');var ab=ya.timestamp_absolute;if(!ab)ab=pa(new Date(ya.timestamp),{withinWeek:'l',withinYear:'F jS',older:'F jS, Y'});if(ta.isFirstMessage(ya))if(ya.timestamp_time_passed===y.TODAY){ab="Conversation started today";}else ab=sa._("Conversation started {timestamp}",{timestamp:ab});l.setContent(za,ab);k.show(za);return l.create('li',{className:"_2n3"},za);},renderMessageSeparatorForIndex:function(ya,za){var ab=ya[za][0];if(za){var bb=ab.timestamp,cb=ya[za-1],db=cb[cb.length-1].timestamp,eb=ka.READ_VIEW_SEPARATOR_TIME_LIMIT;if(bb-db<eb)return false;}return va.renderMessageSeparator(ab);},renderRawAttachments:function(ya,za){var ab=i.convertRaw(za.raw_attachments||[]),bb=(za.photo_fbids?za.photo_fbids.length:0)+(za.image_ids?za.image_ids.length:0);for(var cb=0;cb<bb;cb++)ab.push({preview_loading:true,attach_type:u.PHOTO,preview_width:206,preview_height:206});va.renderAttachments(ya,ab,za);},renderAttachments:function(ya,za,ab){za.sort(j.booleanLexicographicComparator([j.isPhotoAttachment,j.isShareAttachment,j.isFileAttachment,j.isErrorAttachment]));var bb=j.renderPhotoAttachments(za.filter(j.isPhotoAttachment),ab,468,16);if(bb)l.appendContent(ya,bb);for(var cb=0;cb<za.length;cb++){if(j.isPhotoAttachment(za[cb]))continue;var db=j.renderAttachment(false,za[cb],ab,null,null,la.stickerClicked.bind(la));db.error&&l.appendContent(ya,db.error);db.content&&l.appendContent(ya,db.content);}},renderStatus:function(ya,za){if(v.hasErrorStatus(za)){var ab=ea.createElement(w,{message:new q(za)}),bb=ya.getNode('statusContainer');if(bb&&ab){ea.renderComponent(ab,bb);k.show(bb);}}},renderSingleMessage:function(ya,za,ab,bb){ya.setNodeProperty('bodyDiv','id',za.message_id);if(za.html_body){var cb=ya.getNode('fbml');g.listen(cb,'click',function(){new h().setURI('/ajax/messaging/async.php').setReadOnly(true).setMethod('GET').setData({action:'htmlDialog',mid:za.message_id}).send();return false;});k.show(cb);var db=ya.getNode('bodyDiv'),eb=l.create('div',{className:"_5xl"}),fb=l.create('div',{className:"_5xm"},eb);l.setContent(db,fb);m.set(fb,'MessageRenderer:messageID',za.message_id);var gb=new n({resizeContent:xa}),hb=function(){gb.makeRich(za.message_id,eb,za.html_body);};setTimeout(hb,0);va.renderStatus(ya,za);}else va.appendMessageToGroup(ya,za);var ib;if(ab.href){ib=l.create('a',{href:ab.href},ab.name);var jb=ca.getUserID(ab.id);if(jb)ib.setAttribute('data-hovercard',o.constructEndpoint({id:jb}));}else ib=ab.name;ya.setNodeContent('authorName',ib);var kb=ya.getNode('image');k.removeClass(kb,'MercuryThreadImage');var lb=ea.createElement(p,{alt:ab.name,width:da.IMAGE_SIZE,height:da.IMAGE_SIZE,src:ab.image_src,className:"_50dv"});if(ab.href)lb=ea.createElement(ea.DOM.a,{href:ab.href},lb);lb=ea.renderComponent(lb,kb);var mb;if(za.timestamp_time_passed===y.TODAY){mb='g:ia';}else mb='n/j, g:ia';var nb=pa(new Date(za.timestamp),mb);ua.renderTimestamp(ya.getNode('timestamp'),za.timestamp_absolute,nb,za.timestamp);ya.getNode('mapHovercard').removeAttribute('href');if(za.coordinates){k.hide(ya.getNode('tooltipForSource'));ua.renderMessageLocation(ya.getNode('mapHovercard'),ya.getNode('locationIcon'),za.coordinates);}else{ya.getNode('mapHovercard').removeAttribute('data-hovercard');ua.renderMessageSourceTags(ya.getNode('tooltipForSource'),ya.getNode('sourceIcon'),za.source_tags||[],za.author_email);ua.renderSpoofWarning(ya.getNode('spoofWarning'),za.is_spoof_warning,ab);}if(za.subject)ya.setNodeContent('subject',za.subject);if(za.has_attachment){var ob=ya.getNode('attachments');if(za.attachments&&za.attachments.length===0){va.renderRawAttachments(ob,za);}else if(za.attachments!==null&&za.attachments.length>0){va.renderAttachments(ob,za.attachments,za);}else if(za.raw_attachments!=null&&za.raw_attachments.length>0)va.renderRawAttachments(ob,za.raw_attachments);}var pb=ya.getNode('forwards'),qb=za.forward_count&&ta.getMessagesFromIDs(za.forward_message_ids);if(qb)va.renderForwardedMessages(pb,qb);k.conditionShow(pb,qb);}};function wa(ya){return ya.action_type==t.LOG_MESSAGE||ya.has_attachment||ya.forward_count||ya.html_body||(ya.body&&ya.body.length>x.MAX_CHARS_BEFORE_BREAK);}function xa(ya,za,ab){var bb=qa(ya),cb=l.find(bb,'iframe'),db=l.find(cb,"^._5xm"),eb=db.firstChild;ha.set(cb,'width',za+'px');ha.set(cb,'height',(ab+1)+'px');cb.setAttribute('scrolling','no');var fb=bb&&ja.getElementDimensions(bb).x/za;if(fb&&fb<1){ha.set(db,'height',Math.round(fb*(ab+1))+'px');var gb=cb.style,hb=['transform','WebkitTransform','msTransform','MozTransform','OTransform'],ib;while(ib=hb.shift())if(typeof gb[ib]!=='undefined'){ha.set(cb,ib,'scale('+fb+','+fb+')');return;}ha.set(eb,'zoom',fb);}}e.exports=va;},null);
__d("WebMessengerInfoBoxRenderer",["Event","cx","DOM","WebMessengerSubscriptionsHandler"],function(a,b,c,d,e,f,g,h,i,j){var k={render:function(l,m){var n=i.create('div',{className:"_4rk"},l),o=i.create('div',{}),p=true;m.forEach(function(q){if(!p){var r=i.create('span',{className:"_4rl"},'\u00b7');i.appendContent(o,r);}p=false;var s=i.create('a',{},q.text);if(q.handler)j.addSubscriptions(g.listen(s,'click',q.handler));i.appendContent(o,s);});return i.create('div',{className:"_4rh"},[n,o]);}};e.exports=k;},null);
__d("WebMessengerDetailViewRecentMessagesControl",["Event","Animation","CSS","WebMessengerDetailViewUnreadMessagesNotice","DOM","Arbiter","MercuryLastMessageIndicator.react","MercuryListUpdateRenderer","MercuryAPIArgsSource","MercuryParticipants","MercuryThreadlistConstants","WebMessengerMessagesSelection","MessagingTag","React","WebMessengerStateConstants","WebMessengerStateManager","Style","WebMessengerTemplates","WebMessengerThreadMessagesRenderer","UserActivity","WebMessengerConstants","WebMessengerInfoBoxRenderer","WebMessengerMessageIDFinder","WebMessengerSubscriptionsHandler","copyProperties","cx","debounce","formatDate","ge","tx","MercuryMessages","MercuryThreadInformer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja){var ka=b('MercuryMessages').get(),la=b('MercuryThreadInformer').get(),ma=b('MercuryThreads').get();function na(fb,gb,hb,ib,jb,kb,lb){"use strict";this._manager=fb;this._rootElement=gb;this._loadingSpinner=hb;this._noSelectedConversation=ib;this._newMessageLink=jb;this._showUnreadLink=kb;k.empty(this._rootElement);this._pagerExponent=-1;var mb=x[':fb:web-messenger:read-view:recent-messages'].build();k.setContent(this._rootElement,mb.getRoot());this._selectedConversationView=mb.getRoot();this._messageList=mb.getNode('messagelist');this._loadMoreButton=mb.getNode('loadMoreButton');this._loadMoreLink=mb.getNode('loadMoreLink');this._loadMoreCount=mb.getNode('loadMoreCount');this._loadingMoreCount=mb.getNode('loadingMoreCount');this._indicatorNode=mb.getNode('lastMessageIndicator');this._unseenMessagesNotice=new j(this._manager);this._unseenMessagesNotice.setNoticeContextNode(lb);this._active=false;this._state=null;this._threadID=null;this._bugReportingEnabled=false;this._currentCountMap={};this._olderMessageID={};this._loadMessagesInFlight={};y.setupSelectionListener(this._messageList);this._manager.addScrollCallback(ga(eb.bind(null,this),500));da.addSubscriptions(g.listen(this._loadMoreLink,'click',xa.bind(null,this)),la.subscribe('messages-reordered',function(nb,ob){var pb=this._threadID&&ob[this._threadID];if(pb)ta(this);}.bind(this)),la.subscribe('messages-updated',function(nb,ob){var pb=this._threadID&&ob[this._threadID];if(pb)var qb=Object.keys(pb),rb=qb.length&&pb[qb[0]];if(pb&&rb)ta(this,ob[this._threadID]);}.bind(this)),la.subscribe('messages-updated',eb.bind(null,this)),la.subscribe('messages-received',function(nb,ob){if(this._threadID&&ob[this._threadID])wa(this,ob);}.bind(this)),la.subscribe('thread-read-changed',function(nb,ob){if(ob[this._threadID])bb(this,ob[this._threadID]);}.bind(this)),this._manager.subscribe('scrolledNearTop',function(){this._active&&xa(this);}.bind(this)));}na.prototype.hideView=function(){"use strict";this._active=false;i.hide(this._rootElement);i.hide(this._loadingSpinner);i.hide(this._noSelectedConversation);this._unseenMessagesNotice.hideView();this._manager._flexArea.setBottomAligned(false);};na.prototype.updateView=function(){"use strict";this._unseenMessagesNotice.updateView();this._active=true;this._manager._flexArea.setBottomAligned(true);i.show(this._rootElement);var fb=pa(this);qa(this);r.clear();if(fb){ra(this);}else za(this);};na.prototype.destroy=function(){"use strict";oa(this);this._unseenMessagesNotice.destroy();t.unmountComponentAtNode(this._indicatorNode);};function oa(fb){fb._messagesSubscription&&ka.unsubscribe(fb._messagesSubscription.subscriber_id,fb._messagesSubscription.thread_id);fb._messagesSubscription=null;}function pa(fb){var gb=v.getCurrentStateData();if(!fb._threadID||fb._threadID!=gb.thread_id)return true;return false;}function qa(fb){var gb=v.getCurrentStateData();fb._state=v.getCurrentDetailState();fb._threadID=gb.thread_id;fb._selectionEnabled=!!gb.message_action;fb._bugReportingEnabled=gb.bug_reporting_enabled;y.updateSelection(fb._messageList);i.conditionClass(fb._messageList,'bugReportingEnabled',fb._bugReportingEnabled);}function ra(fb){k.scry(fb._rootElement,'.stickerContainer').forEach(function(gb){return t.unmountComponentAtNode(gb);});k.empty(fb._messageList);i.show(fb._loadingSpinner);i.hide(fb._loadMoreButton);oa(fb);fb._pagerExponent=-1;t.unmountComponentAtNode(fb._indicatorNode);delete fb._lastMessageIndicator;if(fb._threadID){i.show(fb._selectedConversationView);i.hide(fb._noSelectedConversation);fb._manager._flexArea.showAtTop(false);if(!fb._olderMessageID[fb._threadID]){sa(fb);}else ta(fb);fb._manager.scrollToBottom(false);}else{db(fb);i.hide(fb._selectedConversationView);i.show(fb._noSelectedConversation);i.hide(fb._loadingSpinner);fb._manager._flexArea.showAtTop(true);}}function sa(fb){fb._loadMessagesInFlight[fb._threadID]=true;fb._currentCountMap[fb._threadID]=aa.INITIAL_MESSAGES_LIMIT+1;i.hide(fb._loadMoreButton);var gb=ka.getThreadMessagesRange(fb._threadID,0,fb._currentCountMap[fb._threadID],ua.bind(null,fb),null,o.WEBMESSENGER);if(gb){fb._messagesSubscription={subscriber_id:gb,thread_id:fb._threadID};}else ta(fb);}function ta(fb,gb){if(!fb._threadID||!fb._olderMessageID[fb._threadID])return;var hb=ka.getThreadMessagesSinceTimestamp(fb._threadID,cb(fb._olderMessageID[fb._threadID]));if(hb.length>fb._currentCountMap[fb._threadID])fb._currentCountMap[fb._threadID]=hb.length;va(fb,hb,gb);}function ua(fb,gb){fb._loadMessagesInFlight[fb._threadID]=false;if(gb&&gb.length){var hb=gb[0].timestamp,ib=fb._olderMessageID[fb._threadID]?cb(fb._olderMessageID[fb._threadID]):null;if(!ib||hb<ib)fb._olderMessageID[fb._threadID]=gb[0].message_id;}}function va(fb,gb,hb){i.hide(fb._loadingSpinner);i.conditionShow(fb._loadMoreButton,!ka.hasLoadedAllMessages(fb._threadID));var ib=ma.getThreadMetaNow(fb._threadID);if(ib){var jb=ib.message_count-gb.length;jb=(jb<0)?0:jb;k.setContent(fb._loadMoreCount,jb);k.setContent(fb._loadingMoreCount,jb);}var kb=function(sb){var tb,ub=ia('wm:'+sb);if(ub)tb=ca.findAll(ub);return tb||[];},lb=[],mb=y.calculateMessageGroups(gb),nb={},ob=[];mb.forEach(function(sb){var tb=sb[0].message_id,ub=false;if(hb){ub=sb.some(function(wb){return wb.message_id in hb;});if(!ub){lb=kb(tb);ub=lb.some(function(wb){return wb in hb;});}}if(!ub){lb=kb(tb);if(sb.length==lb.length){for(var vb=0;vb<sb.length;vb++)if(sb[vb].message_id!=lb[vb]){ub=true;break;}}else ub=true;}if(ub)nb[tb]=1;ob.push('wm:'+tb);});var pb=function(sb){return !nb[mb[sb][0].message_id];},qb=function(sb){var tb=mb[sb],ub=y.renderMessageGroupArray(tb);if(sb==ob.length-1)fb._messageGroup=ub;return ub.getRoot();},rb=function(sb){return y.renderMessageSeparatorForIndex(mb,sb);};n.updateList(fb._messageList,ob,pb,qb,rb);fb._lastMessage=gb[gb.length-1];ya(fb).setLastMessage(fb._lastMessage);za(fb);fb._manager.poke();}function wa(fb,gb){var hb=gb[fb._threadID],ib=fb._manager._flexArea.getScrollableArea(),jb=ib.getScrollHeight();hb.forEach(function(mb){mb.timestamp_relative=ha(new Date(mb.timestamp),'g:ia');var nb=y.canAppendMessageToLastGroup(fb._lastMessage,mb);if(!nb){fb._messageGroup=y.renderMessageGroup(mb);var ob=mb.timestamp,pb=fb._lastMessage?fb._lastMessage.timestamp:0,qb=aa.READ_VIEW_SEPARATOR_TIME_LIMIT;if(!pb||ob-pb>=qb){var rb=y.renderMessageSeparator(mb);k.appendContent(fb._messageList,rb);}k.appendContent(fb._messageList,fb._messageGroup.getRoot());}else y.appendMessageToGroup(fb._messageGroup,mb);if(mb.author!=p.user)i.addClass(fb._messageGroup.getRoot(),'unreadHighlight');fb._lastMessage=mb;});fb._manager._flexArea.poke();var kb=ib.getScrollHeight(),lb=ib.getScrollTop();fb._unseenMessagesNotice.updateOnMessagesReceived(jb,kb,lb,gb);ya(fb).setLastMessage(fb._lastMessage);if(fb._manager.isScrolledToBottom())za(fb);}function xa(fb){i.addClass(fb._loadMoreButton,'async_saving');if(fb._loadMessagesInFlight[fb._threadID])return;fb._loadMessagesInFlight[fb._threadID]=true;fb._pagerExponent=Math.min(fb._pagerExponent+1,aa.EXPONENTIAL_PAGER_MAX_CYCLES);var gb=Math.pow(2,fb._pagerExponent),hb=fb._currentCountMap[fb._threadID]+(gb*q.WEBMESSENGER_MORE_MESSAGES_COUNT);oa(fb);var ib=ka.getThreadMessagesRange(fb._threadID,0,hb,function(jb){i.removeClass(fb._loadMoreButton,'async_saving');fb._currentCountMap[fb._threadID]=hb;ua(fb,jb);fb._loadMessagesInFlight[fb._threadID]=false;},null,o.WEBMESSENGER);if(ib){fb._messagesSubscription={subscriber_id:ib,thread_id:fb._threadID};}else ta(fb);}function ya(fb){if(!fb._lastMessageIndicator){var gb;fb._lastMessageIndicator=t.renderComponent(t.createElement(m,{threadID:fb._threadID,className:"_510o",indicatorWillShow:function(){return gb=fb._manager.isScrolledToBottom();},indicatorDidShow:function(){return gb&&fb._manager.scrollToBottom(true);}}),fb._indicatorNode);}return fb._lastMessageIndicator;}function za(fb){if(z.isActive(5000)){ab(fb);}else z.subscribeOnce(ab.bind(null,fb));}function ab(fb){if(!fb._threadID||!fb._active)return;ma.changeThreadReadStatus(fb._threadID,true);var gb=k.scry(fb._messageList,'.unreadHighlight');gb.forEach(function(hb){i.removeClass(hb,'unreadHighlight');i.addClass(hb,'unreadFading');new h(hb).from('background','#eceff5').to('background','#fff').from('borderColor','#d6d6d6').to('borderColor','#fff').ease(h.ease.both).duration(1500).ondone(function(){i.removeClass(hb,'unreadFading');w.set(hb,'background','');w.set(hb,'borderColor','');}).go();});}function bb(fb,gb){if(!gb.mark_as_read)return;var hb=k.scry(fb._messageList,'.unreadHighlight');for(var ib=0;ib<hb.length;ib++){var jb=hb[ib],kb=ca.findAll(jb),lb=ka.getMessagesFromIDs(kb);if(lb[lb.length-1].timestamp<gb.timestamp)i.removeClass(jb,'unreadHighlight');}}function cb(fb){var gb=ka.getMessagesFromIDs([fb])[0];return gb?gb.timestamp:0;}function db(fb){if(fb._builtNoSelectionBox)return;var gb=function(){var ib=v.getCurrentStateData(),jb=ea({},ib);v.updateDetailState(u.DETAIL.COMPOSE_MAIN,ea(jb,{start:true,thread_id:undefined}));},hb=function(){var ib=v.getCurrentStateData(),jb=ea({},ib);v.updateMasterState(u.MASTER.RECENT_THREADS,ea(jb,{folder:s.INBOX,filter:s.UNREAD}));};k.setContent(fb._noSelectedConversation,ba.render("No Conversation Selected",[{text:"New Message",handler:gb},{text:"Show Unread",handler:hb}]));fb._builtNoSelectionBox=true;}function eb(fb){var gb=fb._manager._flexArea.getScrollableArea(),hb=fb._manager.getFlexAreaBoundingClientRect();l.inform('messengerScrolled/'+fb._threadID,{scrollTop:gb.getScrollTop(),top:hb.y,viewHeight:hb.height});}e.exports=na;},null);
__d("MercurySearchContextResults",["KeyedCallbackManager","MercuryAPIArgsSource","MercuryConfig","MercuryThreadlistConstants","RangedCallbackManager","MercuryServerDispatcher","WebMessengerConstants","MercuryServerRequests"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=b('MercuryServerRequests').get(),o=new g(),p=j.WEBMESSENGER_SEARCH_SNIPPET_COUNT,q=m.MORE_SEARCH_CONTEXT_COUNT,r={getSearchContext:function(v,w,x){if(v){var y=o.executeOrEnqueue(v,function(da){var ea=t(da,v);x(ea);}),z=o.getUnavailableResources(y);if(z.length){var aa={message_id:v,limit:p+1},ba=n.getServerThreadIDNow(w);if(i.MercuryFBIDGK){var ca=n.tokenizeThreadID(w);if(ca.type=='user'){aa.other_user_fbid=ba;}else aa.thread_fbid=ba;}else aa.thread_id=ba;u(aa);}return y;}},getMoreSearchContext:function(v,w,x,y){if(v){var z=o.getResource(v);if(z){var aa=x==m.MORE_SEARCH_CONTEXT_UP?z.up_message_ids:z.down_message_ids,ba=aa.getCurrentArraySize()+q,ca=aa.executeOrEnqueue(0,ba,function(){var ha=t(z,v);y(ha);}),da=aa.getUnavailableResources(ca);if(da.length){var ea={message_id:v,limit:ba,direction:x},fa=n.getServerThreadIDNow(w);if(i.MercuryFBIDGK){var ga=n.tokenizeThreadID(w);if(ga.type=='user'){ea.other_user_fbid=fa;}else ea.thread_fbid=fa;}else ea.thread_id=fa;u(ea);}return ca;}}},handleUpdate:function(v){if(v.mercury_payload)n.handleUpdate(v.mercury_payload);var w=v.search_context||{};for(var x in w){var y=w[x],z;if(i.MercuryFBIDGK){z=y.other_user_fbid||y.thread_fbid;}else z=y.thread_id;var aa=n.getClientThreadIDNow(z),ba=!o.getResource(x),ca=ba?{thread_id:aa,up_message_ids:new k(),down_message_ids:new k()}:o.getResource(x),da=ba?p+1:q;if(y.up_message_ids&&(ca.up_message_ids.getCurrentArraySize()===0||y.up_message_ids.length>=ca.up_message_ids.getCurrentArraySize()))s(ca.up_message_ids,y.up_message_ids,da);if(y.down_message_ids&&(ca.down_message_ids.getCurrentArraySize()===0||y.down_message_ids.length>=ca.down_message_ids.getCurrentArraySize()))s(ca.down_message_ids,y.down_message_ids,da);if(ba)o.setResource(x,ca);}},unsubscribe:function(v,w,x){if(w){var y=o.getResource(w);if(y){if(x==m.MORE_SEARCH_CONTEXT_UP){y.up_message_ids.unsubscribe(v);}else y.down_message_ids.unsubscribe(v);}else o.unsubscribe(v);}}};function s(v,w,x){var y=v.getCurrentArraySize(),z=w.length<y+x;if(w.length){v.removeAllResources();v.addResourcesWithoutSorting(w,0);}if(z)v.setReachedEndOfArray();}function t(v,w){var x=v.up_message_ids.hasReachedEndOfArray(),y=v.up_message_ids.getAllResources();if(!x)y.shift();var z=v.down_message_ids.hasReachedEndOfArray(),aa=v.down_message_ids.getAllResources();if(!z)aa.pop();return {thread_id:v.thread_id,message_id:w,up_message_ids:y,up_exhausted:x,down_message_ids:aa,down_exhausted:z};}function u(v){v.client=h.WEBMESSENGER;l.trySend('/ajax/mercury/search_context.php',v);}l.registerEndpoints({'/ajax/mercury/search_context.php':{mode:l.IMMEDIATE,handler:r.handleUpdate}});e.exports=r;},null);
__d("MercurySearchSnippetResults",["MercuryAPIArgsSource","MercuryConfig","MercuryThreadlistConstants","RangedCallbackManager","MercuryServerDispatcher","MercuryServerRequests"],function(a,b,c,d,e,f,g,h,i,j,k){var l=b('MercuryServerRequests').get(),m={},n={},o=null,p=i.WEBMESSENGER_SEARCH_SNIPPET_COUNT,q=i.WEBMESSENGER_SEARCH_SNIPPET_LIMIT,r=i.WEBMESSENGER_SEARCH_SNIPPET_MORE,s={getAllThreadSearchResults:function(ca,da){if(ca)t(ca,q,0,da);},getAllThreadSearchMoreResults:function(ca,da){if(ca){var ea=m[ca];if(ea){var fa=ea.getCurrentArraySize();t(ca,r,fa,da);}}},getSingleThreadSearchResults:function(ca,da,ea){if(!ca||!da)return;u(ca,da,p,0,ea);},getSingleThreadSearchMoreResults:function(ca,da,ea){if(!ca||!da)return;if(!n[da])return;var fa=n[da][ca];if(fa){var ga=fa.num_total_snippets,ha=fa.snippets_cbm.getCurrentArraySize(),ia=ga-ha;if(ia>0){var ja=ia>r?r:ia;u(ca,da,ja,ha,ea);}}},countSnippetsMatchingQueryInThread:function(ca,da){var ea=n[da][ca];if(ea)return ea.num_total_snippets;},findIndexOfSnippet:function(ca,da,ea,fa){var ga=aa(ca,da),ha=ga.getAllResources();for(var ia=0;ia<ha.length;ia++)if(ea===ha[ia].message_id)return ia;},findSnippetAtIndex:function(ca,da,ea,fa){x(ca,da,ea);y(ca,da,ea,fa);},handleUpdate:function(ca){if(ca.mercury_payload)l.handleUpdate(ca.mercury_payload);var da=ca.search_snippets||{};Object.keys(da).filter(function(sa){return !!da[sa];}).forEach(function(sa){Object.keys(da[sa]).forEach(function(ta){da[sa][ta].snippets.forEach(function(ua){ua.matched_keywords=v(ua.matched_keywords);});});});var ea=ca.offset,fa=[];for(var ga in da){var ha=da[ga];for(var ia in ha){var ja=ha[ia],ka=h.MercuryFBIDGK?ca.other_user_fbid||ca.thread_fbid:ca.thread_id,la=l.getClientThreadIDNow(ia),ma=ja.snippets,na=aa(ga,la),oa=na.getCurrentArraySize();if(!ka){fa.push(la);if(oa)continue;}else if(ea!=oa)continue;var pa=n[la][ga];pa.num_total_snippets=ja.num_total_snippets;na.addResourcesWithoutSorting(ma,oa);if(!ka||ca.limit>ma.length)if(na.getCurrentArraySize()==pa.num_total_snippets)na.setReachedEndOfArray();}if(!ka){var qa=z(ga),ra=qa.getCurrentArraySize();if(ea==ra){qa.addResourcesWithoutSorting(fa,ra);if(ca.limit>fa.length)qa.setReachedEndOfArray();}}}}};function t(ca,da,ea,fa){w();var ga=z(ca),ha=ea+da,ia=ga.executeOrEnqueue(0,ha,function(la){var ma={};for(var na=0;na<la.length;na++){var oa=la[na],pa=n[oa][ca];ma[oa]={num_total_snippets:pa.num_total_snippets,snippets:pa.snippets_cbm.getAllResources()};}var qa=ga.hasReachedEndOfArray();fa(ma,qa);}),ja=ga.getUnavailableResources(ia);if(ja.length){o={query:ca,thread_id:null,subscriber_id:ia};var ka={query:ca,offset:ea,limit:da+1,snippetLimit:p};if(h.MercuryFBIDGK)ka.identifier='thread_fbid';ba(ka);}}function u(ca,da,ea,fa,ga){w();var ha=aa(ca,da),ia=fa+ea,ja=ha.executeOrEnqueue(0,ia,function(){var oa=ha.getAllResources(),pa=n[da][ca].num_total_snippets;ga(oa,pa);}),ka=ha.getUnavailableResources(ja);if(ka.length){o={query:ca,thread_id:da,subscriber_id:ja};var la={query:ca,snippetOffset:fa,snippetLimit:ea},ma=l.getServerThreadIDNow(da);if(h.MercuryFBIDGK){var na=l.tokenizeThreadID(da);if(na.type=='user'){la.other_user_fbid=ma;}else la.thread_fbid=ma;la.identifier='thread_fbid';}else la.thread_id=ma;ba(la);}}function v(ca){if(ca instanceof Array){var da={};for(var ea=0;ea<ca.length;ea++)da[ea.toString()]=ca[ea];return da;}else return ca;}function w(){if(o){if(o.thread_id){var ca=aa(o.query,o.thread_id);ca.unsubscribe(o.subscriber_id);}else{var da=z(o.query);da.unsubscribe(o.subscriber_id);}o=null;}}function x(ca,da,ea){}function y(ca,da,ea,fa){var ga=n[da][ca],ha=ga.snippets_cbm.getAllResources(),ia=ga.num_total_snippets,ja=ha.length;if(ea<ja){fa(ha[ea].message_id);return;}var ka=ia-ja,la=ka>r?r:ka;u(ca,da,la,ja,function(ma,na){y(ca,da,ea,fa);});}function z(ca){if(!m[ca])m[ca]=new j();return m[ca];}function aa(ca,da){if(!n[da])n[da]={};var ea=n[da][ca];if(!ea){ea={num_total_snippets:-1,snippets_cbm:new j()};n[da][ca]=ea;}return ea.snippets_cbm;}function ba(ca){ca.client=g.WEBMESSENGER;k.trySend('/ajax/mercury/search_snippets.php',ca);}k.registerEndpoints({'/ajax/mercury/search_snippets.php':{mode:k.IMMEDIATE,handler:s.handleUpdate}});e.exports=s;},null);
__d("WebMessengerDetailViewSearchContextControl",["Event","CSS","DOM","WebMessengerMessagesSelection","MercurySearchContextResults","MercurySearchSnippetResults","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerThreadMessagesRenderer","WebMessengerConstants","WebMessengerSubscriptionsHandler","MercuryMessages"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=b('MercuryMessages').get();function t(da,ea,fa){"use strict";this._manager=da;this._rootElement=ea;this._paginationBox=fa;i.empty(this._rootElement);var ga=o[':fb:web-messenger:read-view:search-context'].build(),ha=o[':fb:web-messenger:read-view:search-pagination-box'].build();i.setContent(this._rootElement,ga.getRoot());i.setContent(this._paginationBox,ha.getRoot());this._messagelistRoot=ga.getRoot();this._loadingSpinner=ga.getNode('loadingSpinner');this._messageList=ga.getNode('messagelist');this._loadMoreButton=ga.getNode('loadMoreButton');this._loadMoreLink=ga.getNode('loadMoreLink');this._downMoreButton=ga.getNode('downMoreButton');this._downMoreLink=ga.getNode('downMoreLink');this._nextSnippet=ha.getNode('nextSnippet');this._previousSnippet=ha.getNode('previousSnippet');this._backToSnippetsButton=ha.getNode('backToSnippetsButton');this._snippetCountDescription=ha.getNode('snippetCountDescription');this._paginationBoxCloseButton=ha.getNode('paginationBoxCloseButton');this._state=null;this._threadID=null;this._messageID=null;p.setupSelectionListener(this._messageList);r.addSubscriptions(g.listen(this._loadMoreLink,'click',function(){h.addClass(this._loadMoreButton,'async_saving');ba(this,q.MORE_SEARCH_CONTEXT_UP);}.bind(this)),g.listen(this._downMoreLink,'click',function(){h.addClass(this._downMoreButton,'async_saving');ba(this,q.MORE_SEARCH_CONTEXT_DOWN);}.bind(this)),g.listen(this._nextSnippet,'click',u.bind(null,this,1)),g.listen(this._previousSnippet,'click',u.bind(null,this,-1)),g.listen(this._backToSnippetsButton,'click',function(){var ia=n.getCurrentStateData(),ja=ia.single_thread_search?m.DETAIL.SEARCH_THREAD_SNIPPET:m.DETAIL.SEARCH_SNIPPET,ka={folder:ia.folder,message_query:ia.message_query,query:ia.query};if(ia.single_thread_search)ka.thread_id=ia.thread_id;n.updateDetailState(ja,ka);}),g.listen(this._paginationBoxCloseButton,'click',function(){n.updateDetailState(m.DETAIL.RECENT_MESSAGES,{thread_id:n.getCurrentStateData().thread_id});}.bind(this)));}t.prototype.hideView=function(){"use strict";h.hide(this._rootElement);h.hide(this._paginationBox);};t.prototype.updateView=function(){"use strict";h.show(this._rootElement);h.show(this._paginationBox);var da=x(this);y(this);j.clear();if(da)aa(this);};t.prototype.destroy=function(){"use strict";w(this);};function u(da,ea){var fa=n.getCurrentStateData(),ga=l.findIndexOfSnippet(da._messageQuery,fa.thread_id,fa.message_id),ha=ga+ea;h.hide(da._messageList);h.hide(da._loadMoreButton);h.hide(da._downMoreButton);h.show(da._loadingSpinner);l.findSnippetAtIndex(da._messageQuery,fa.thread_id,ha,function(ia){h.show(da._messageList);v(fa,ia);});}function v(da,ea){var fa={folder:da.folder,message_id:ea,message_query:da.message_query,query:da.query,single_thread_search:da.single_thread_search,thread_id:da.thread_id};n.updateDetailState(n.getCurrentDetailState(),fa);}function w(da){da._searchContextSubscription&&k.unsubscribe(da._searchContextSubscription.subscriber_id,da._searchContextSubscription.message_id,da._searchContextSubscription.direction);da._searchThreadsSubscription=null;}function x(da){var ea=n.getCurrentStateData();if(da._threadID!=ea.thread_id)return true;if(da._messageQuery!=ea.message_query)return true;if(da._messageID!=ea.message_id)return true;return false;}function y(da){var ea=n.getCurrentStateData();da._state=n.getCurrentDetailState();da._threadID=ea.thread_id;da._messageQuery=ea.message_query;da._messageID=ea.message_id;da._selectionEnabled=!!ea.message_action;p.updateSelection(da._messageList);h.conditionClass(da._messageList,'bugReportingEnabled',ea.bug_reporting_enabled);}function z(da,ea){i.setAttributes(da,{disabled:ea});var fa=i.find(da,'^label');h.conditionClass(fa,'uiButtonDisabled',ea);}function aa(da){var ea=i.create('strong',{},da._messageQuery),fa=l.countSnippetsMatchingQueryInThread(da._messageQuery,da._threadID),ga=l.findIndexOfSnippet(da._messageQuery,da._threadID,da._messageID),ha=ga+1,ia=i.tx._("{index} of {count} results for {query}",{index:ha,count:fa,query:ea});i.setContent(da._snippetCountDescription,ia);z(da._previousSnippet,ga===0);z(da._nextSnippet,ga===fa-1);i.empty(da._messageList);h.show(da._loadingSpinner);h.hide(da._loadMoreButton);h.hide(da._downMoreButton);w(da);if(da._threadID&&da._messageID){var ja=k.getSearchContext(da._messageID,da._threadID,function(ka){h.hide(da._loadingSpinner);ca(da,ka);});if(ja)da._searchContextSubscription={subscriber_id:ja,message_id:da._messageID};}}function ba(da,ea){w(da);if(da._threadID&&da._messageID){var fa=k.getMoreSearchContext(da._messageID,da._threadID,ea,function(ga){if(ea==q.MORE_SEARCH_CONTEXT_UP){h.removeClass(da._loadMoreButton,'async_saving');}else h.removeClass(da._downMoreButton,'async_saving');ca(da,ga);});if(fa)da._searchContextSubscription={subscriber_id:fa,message_id:da._messageID,direction:ea};}}function ca(da,ea){h.conditionShow(da._loadMoreButton,!ea.up_exhausted);h.conditionShow(da._downMoreButton,!ea.down_exhausted);var fa=ea.up_message_ids.concat([ea.message_id],ea.down_message_ids),ga=s.getMessagesFromIDs(fa);i.empty(da._messageList);var ha=p.calculateMessageGroups(ga);ha.forEach(function(ia,ja){var ka=p.renderMessageSeparatorForIndex(ha,ja);if(ka)i.appendContent(da._messageList,ka);var la=p.renderMessageGroupArray(ia,false,'context:').getRoot(),ma=ia.some(function(na){return na.message_id==ea.message_id;});if(ma)h.addClass(la,'selectedHighlight');i.appendContent(da._messageList,la);});}e.exports=t;},null);
__d("WebMessengerSearchSnippetsRenderer",["Event","CSS","DOM","Image.react","MercuryMessageRenderer","MercuryParticipants","MercuryParticipantsConstants","React","MercurySearchSnippetResults","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","cx","tx","MercuryThreadMetadataRenderer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){var u=b('MercuryThreadMetadataRenderer').get(),v={renderMultipleSnippetBlocks:function(ba,ca,da){da=da||{};var ea=true;for(var fa in da){ea=false;var ga=r[':fb:web-messenger:read-view:search-snippets-block'].build();i.appendContent(ba,ga.getRoot());v.renderSingleSnippetBlock(ga,ca,fa,da[fa]);}if(ea)aa(ba);},renderThreadSnippetBlock:function(ba,ca,da,ea,fa){if(!ea||!ea.length){aa(ba);return;}var ga=r[':fb:web-messenger:read-view:search-snippets-block'].build();i.appendContent(ba,ga.getRoot());h.hide(ga.getNode('searchThreadName'));w(ga,ca,da,ea,fa);},renderSingleSnippetBlock:function(ba,ca,da,ea){var fa=ba.getNode('searchThreadName'),ga=i.create('h3');i.setContent(fa,ga);u.renderAndSeparatedParticipantList(da,ga);w(ba,ca,da,ea.snippets,ea.num_total_snippets);},renderMultipleSnippets:function(ba,ca,da,ea){(ea||[]).forEach(function(fa){var ga=r[':fb:web-messenger:read-view:search-snippet'].build();i.appendContent(ba,ga.getRoot());l.get(fa.author,function(ha){v.renderSingleSnippet(ga,ca,da,fa,ha);});});},renderSingleSnippet:function(ba,ca,da,ea,fa){ba.setNodeProperty('bodyDiv','id','snippet:'+ea.message_id);var ga=ea.matched_keywords||undefined,ha=k.formatMessageBody(ea.body,ga);ba.setNodeContent('body',ha);var ia=ba.getNode('image');h.removeClass(ia,'MercuryThreadImage');h.addClass(ia,'MercuryMediumThreadImage');var ja=n.createElement(j,{width:m.IMAGE_SIZE,height:m.IMAGE_SIZE,src:fa.image_src});if(fa.href)ja=n.createElement(n.DOM.a,{href:fa.href},ja);n.renderComponent(ja,ia);var ka=fa.short_name;ba.setNodeContent('shortName',i.tx._("{name}: ",{name:ka}));u.renderTimestamp(ba.getNode('timestamp'),ea.timestamp_absolute,ea.timestamp_relative,ea.timestamp);var la=ba.getNode('seeContext');g.listen(la,'click',function(){var ma=q.getCurrentStateData(),na={message_query:ca,query:ma.query,thread_id:da,message_id:ea.message_id},oa=q.getCurrentDetailState();if(oa===p.DETAIL.SEARCH_THREAD_SNIPPET)na.single_thread_search=true;q.updateDetailState(p.DETAIL.SEARCH_CONTEXT,na);return false;});}};function w(ba,ca,da,ea,fa){var ga=ba.getNode('snippetList');v.renderMultipleSnippets(ga,ca,da,ea);var ha=fa-ea.length;x(ba,ca,da,fa,ha);}function x(ba,ca,da,ea,fa){var ga=ba.getNode('totalSnippetsCount'),ha=ba.getNode('moreSnippetsLink');h.conditionShow(ha,fa>0);if(fa>0){var ia=z(fa);i.setContent(ha,ia);}i.setContent(ga,y(ea));if(fa>0)g.listen(ha,'click',function(){o.getSingleThreadSearchMoreResults(ca,da,function(ja){i.empty(ba.getNode('snippetList'));w(ba,ca,da,ja,ea);});});}function y(ba){if(ba==1){return "1 result in total";}else return t._("{count} results in total",{count:ba});}function z(ba){if(ba==1){return "Show 1 more result";}else return t._("Show {count} more results",{count:ba});}function aa(ba){var ca="No results",da=i.create('div',{className:"_2n4"},ca);i.setContent(ba,da);}e.exports=v;},null);
__d("WebMessengerDetailViewSearchSnippetsControl",["JSXDOM","Event","CSS","DOM","MercurySearchSnippetResults","WebMessengerSearchSnippetsRenderer","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerPermalinks","WebMessengerSubscriptionsHandler","cx","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){function t(y,z){"use strict";this._manager=y;this._rootElement=z;j.empty(this._rootElement);var aa=o[':fb:web-messenger:read-view:search-snippets'].build();j.setContent(this._rootElement,aa.getRoot());this._loadingSpinner=aa.getNode('loadingSpinner');this._messageList=aa.getNode('messagelist');this._downMoreButton=aa.getNode('downMoreButton');this._downMoreLink=aa.getNode('downMoreLink');this._state=null;this._messageQuery=null;this._threadID=null;i.hide(this._downMoreButton);q.addSubscriptions(h.listen(this._downMoreLink,'click',function(){i.addClass(this._downMoreButton,'async_saving');x(this);}.bind(this)));}t.prototype.hideView=function(){"use strict";i.hide(this._rootElement);};t.prototype.updateView=function(){"use strict";i.show(this._rootElement);var y=u(this);v(this);if(y)w(this);};t.prototype.destroy=function(){"use strict";};function u(y){var z=n.getCurrentDetailState();if(y._state!=z)return true;var aa=n.getCurrentStateData();if(y._messageQuery!=aa.message_query)return true;if(z==m.DETAIL.SEARCH_THREAD_SNIPPET)if(y._threadID!=aa.thread_id)return true;return false;}function v(y){y._state=n.getCurrentDetailState();var z=n.getCurrentStateData();y._threadID=z.thread_id;y._messageQuery=z.message_query;}function w(y){i.hide(y._downMoreButton);j.empty(y._messageList);if(y._messageQuery){i.show(y._loadingSpinner);if(y._state===m.DETAIL.SEARCH_THREAD_SNIPPET&&y._threadID){k.getSingleThreadSearchResults(y._messageQuery,y._threadID,function(z,aa){i.hide(y._loadingSpinner);l.renderThreadSnippetBlock(y._messageList,y._messageQuery,y._threadID,z,aa);var ba=g.a({className:"_4-ii"},s._("Search all conversations for \"{query}\"",{query:y._messageQuery})),ca=p.getURI(m.MASTER.SEARCH,m.DETAIL.SEARCH_SNIPPET,{query:y._messageQuery,message_query:y._messageQuery});ba.setAttribute('href',ca);j.prependContent(y._messageList,g.div({className:"_4-ij"},ba));});}else k.getAllThreadSearchResults(y._messageQuery,function(z,aa){i.hide(y._loadingSpinner);l.renderMultipleSnippetBlocks(y._messageList,y._messageQuery,z);i.conditionShow(y._downMoreButton,!aa);});}}function x(y){if(y._messageQuery)k.getAllThreadSearchMoreResults(y._messageQuery,function(z,aa){i.removeClass(y._downMoreButton,'async_saving');j.empty(y._messageList);l.renderMultipleSnippetBlocks(y._messageList,y._messageQuery,z);i.conditionShow(y._downMoreButton,!aa);});}e.exports=t;},null);
__d("Ellipsizer",["CSS","Style","UserAgent_DEPRECATED","cx","getElementText"],function(a,b,c,d,e,f,g,h,i,j,k){var l=1.3;function m(n){this.elements=[];n.forEach(function(o){g.addClass(o,"_6qy");this.elements.push({node:o});}.bind(this));return this;}m.prototype._analyzeElements=function(){var n;this.elements.forEach(function(o){n=o.node;while(n.children.length===1)n=n.children[0];if(n===o.node)h.set(n,'width','');i.ie()&&h.set(n,'position','absolute');o.width=n.offsetWidth;i.ie()&&h.set(n,'position','');});this.elements.sort(function(o,p){return o.width-p.width;});};m.prototype.confineWithin=function(n){this._analyzeElements();var o=n;this.elements.forEach(function(p,q){var r=Math.floor(o/(this.elements.length-q));if(p.width<=r||p.width<=0||r<=0||(p.width<=r*l&&o>=r*l)){g.removeClass(p.node,"_6s5");h.set(p.node,'width','');o-=p.width;if(p.titleSet){p.node.setAttribute('title','');p.titleSet=false;}}else{g.addClass(p.node,"_6s5");h.set(p.node,'width',r+'px');o-=r;if(!p.titleSet&&!p.node.getAttribute('title')){p.node.setAttribute('title',k(p.node));p.titleSet=true;}}}.bind(this));};e.exports=m;},null);
__d("TabIndexDelegator",["CSS","DOM","Event","Focus","JSXDOM"],function(a,b,c,d,e,f,g,h,i,j,k){function l(m,n){"use strict";this._placeholder=n||k.button(null);this._placeholder.setAttribute('aria-describedby',h.getID(m));g.addClass(this._placeholder,'accessible_elem');this._listener=i.listen(this._placeholder,'click',function(){m.click();});j.relocate(this._placeholder,m);this.enable();}l.prototype.enable=function(){"use strict";g.show(this._placeholder);};l.prototype.disable=function(){"use strict";g.hide(this._placeholder);};l.prototype.getPlaceholder=function(){"use strict";return this._placeholder;};l.prototype.destroy=function(){"use strict";this._listener.remove();h.remove(this._placeholder);};e.exports=l;},null);
__d("UnsentMessageDialog",["Dialog","WebMessengerEvents","fbt"],function(a,b,c,d,e,f,g,h,i){var j={get:function(){var k=[{label:"Don't Send",name:g.OK.name},{label:"Stay on Message",name:g.CANCEL.name,className:g.CANCEL.className}];return new g().setTitle("Don't Send Message?").setBody("If you leave this page, your message won't be sent.").setButtons(k).setCloseHandler(h.inform.bind(h,h.FOCUS_COMPOSER)).setModal(true);}};e.exports=j;},null);
__d("XMessagingSetPreferencesControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){e.exports=b("XControllerURIBuilder").create("\/messaging\/preferences\/",{send_on_enter:{type:"Bool"}});},null);
__d("WebMessengerDetailViewBottomShelfControl",["ARIA","Arbiter","AsyncDialog","AsyncRequest","BanzaiLogger","Button","CSS","MercuryConstants","DOM","Ellipsizer","Event","Focus","MercuryFolders","Input","Keys","Locale","MercuryAPIArgsSource","MercuryConfig","MercuryFileUploader","MercuryPhotoUploader","MercuryReadOnlyReason","MercuryShareLinkUploader","MercurySourceType","MessagesEmoticonView","PUWMethods","PhotosUploadWaterfall","WebMessengerPreferences","React","Run","WebMessengerStateConstants","WebMessengerStateManager","StickerActions","StickersFlyout.react","StickerState","StickerStoreController","Style","TabIndexDelegator","WebMessengerTemplates","TextAreaControl","Toggler","UnsentMessageDialog","URI","UserAgent_DEPRECATED","VaultBoxURI","Vector","WebMessengerEvents","WebMessengerSubscriptionsHandler","XMessagingSetPreferencesControllerURIBuilder","arrayContains","copyProperties","csx","csx","fbt","isWebMessengerURI","tx","MercuryDraftsController","MercuryServerRequests","MercuryMessages","MercuryThreadInformer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,ab,bb,cb,db,eb,fb,gb,hb,ib){var jb=b('MercuryDraftsController').get(),kb=b('MercuryServerRequests').get(),lb=b('MercuryMessages').get(),mb=b('MercuryThreadInformer').get(),nb=b('MercuryThreads').get(),ob="_1rh";function pb(tc,uc){"use strict";this._manager=tc;this._rootElement=uc;this._sendOnEnterDefault=ga.sendOnEnter;o.empty(this._rootElement);var vc=ra[':fb:web-messenger:read-view:bottom-shelf'].build();o.setContent(this._rootElement,vc.getRoot());this._bottomShelfToolbar=vc.getNode('toolbar');this._bottomShelfComposer=vc.getNode('composer');this._bottomShelfButtons=vc.getNode('buttons');this._autogrowContainer=vc.getNode('autogrowContainer');this._composerBox=vc.getNode('composerTextarea');this._composerGrid=vc.getNode('composerGrid');this._sendContainer=vc.getNode('sendContainer');this._replyButton=vc.getNode('replyButton');this._uploadingWarning=vc.getNode('uploadingWarning');this._replyButtonLabel=o.find(this._sendContainer,"._1ri");this._sendOnEnterButton=vc.getNode('sendOnEnterButton');this._loadingIndicator=vc.getNode('loadingIndicator');this._cannotReplyAlert=vc.getNode('noReplyMessage');this._ariaOwns=this._composerBox.getAttribute('aria-owns');ab.addSubscriptions(q.listen(this._autogrowContainer,'click',this.focusComposer.bind(this)),za.subscribe(za.UPDATE_SELECTION,sc.bind(null,this)),za.subscribe(za.FOCUS_COMPOSER,this.focusComposer.bind(this)));this._emoteWrapper=vc.getNode('emoteWrapper');this._stickersFlyoutToggler=vc.getNode('emoticons');this._emoticonsPanel=new da(this._stickersFlyoutToggler,this._composerBox);var wc=vc.getNode('stickers');if(wc){this._stickersFlyout=ha.renderComponent(ha.createElement(ma,{onStickerSelect:function(zc){ec(this,zc);}.bind(this)}),wc);ab.addSubscriptions(za.subscribe(za.STICKER_CLICKED,this._onStickerClick.bind(this)));ab.addSubscriptions(na.addListener(na.PACK_SELECTED,function(zc){if(this._stickersFlyout&&this._stickersFlyout.isMounted())this._stickersFlyout.setProps({packID:zc});}.bind(this)));}this._messageSent=false;this._fileUploader=new y(vc.getNode('attachmentShelf'),vc.getNode('attachButtonForm'),vc.getNode('fileInput'),vc.getNode('attachID'));this._shareLinkUploader=new ba(vc.getNode('shareStage'),vc.getNode('shareStageContent'),vc.getNode('shareStageLoadingIndicator'),vc.getNode('shareStageCloseButton'),this._composerBox);r.relocate(this._replyButton,this._replyButtonLabel);this._delegator=new qa(this._replyButtonLabel);o.prependContent(this._bottomShelfToolbar,this._delegator.getPlaceholder());d(['TypingDetectorController'],function(zc){this._typingDetector=new zc(null,this._composerBox,'web-messenger',null,null);rc(this);}.bind(this));this._photoUploader=new z(this._composerGrid,vc.getNode('photoButton'),ab,vc.getNode('composer'));var xc=false;ab.addSubscriptions(this._photoUploader.subscribe('dom-updated',za.detailDOMChanged.bind(za)),this._photoUploader.subscribe('menu-show',function(zc,ad){if(!xc){this.waterfallStep(fa.BEGIN,ad);xc=true;}}.bind(this)),this._photoUploader.subscribe('selection-start',function(zc,ad){this.waterfallStep(fa.SELECT_START,ad);}.bind(this)),this._photoUploader.subscribe('upload-started',function(zc,ad){this.waterfallStep(fa.IMAGES_SELECTED,{method:ad.method||this._photoUploader.getCurrentMethod()});this.waterfallStep(fa.UPLOAD_START,{count:ad.imageCount});}.bind(this)),this._photoUploader.subscribe('upload-completed',function(zc,ad){var bd=this._photoUploader.getCurrentMethod();if(bd!==ea.FILE_SELECTOR)this.waterfallStep(fa.IMAGES_SELECTED,{method:bd});for(var cd=0;cd<ad.fbids.length;++cd)this.waterfallStep(fa.ONE_UPLOAD_DONE);this._composerBox.focus();var dd="A photo has been attached to your message.";g.notify(dd);}.bind(this)),this._photoUploader.subscribe('all-uploads-completed',function(zc,ad){if(this._blockedOnUpload){hc(this,false);fc(this);}this.waterfallStep(fa.ALL_UPLOADS_DONE,ad);}.bind(this)));var yc=o.scry(this._bottomShelfToolbar,"._6q-");yc.push(vc.getNode('sendOnEnterButtonLabel'));this._ellipsizer=new p(yc);ab.addSubscriptions(this._fileUploader.subscribe('all-uploads-completed',function(){if(this._blockedOnUpload){hc(this,false);fc(this);}}.bind(this)),this._fileUploader.subscribe('upload-canceled',hc.bind(null,this,false)),this._fileUploader.subscribe('dom-updated',za.detailDOMChanged.bind(za)));this._confirmationSubscription=ka.registerConfirmationBeforeStateUpdate(function(zc,ad,bd){if(!jb.canSaveDrafts(this._threadID)&&nc(this)&&qb(this,ad,bd))return ua.get();return false;}.bind(this));oc(this);ab.addSubscriptions(h.subscribe('page_transition',function(zc,ad){if(hb(ad.uri))oc(this);}.bind(this)),this._shareLinkUploader.subscribe('link-detected',za.detailDOMChanged.bind(za)),this._shareLinkUploader.subscribe('closed',this.focusComposer.bind(this)));sa.getInstance(this._composerBox).subscribe('resize',function(){za.detailDOMChanged();}.bind(this));qc(this);ab.addSubscriptions(q.listen(this._replyButtonLabel,'click',fc.bind(null,this)),q.listen(this._replyButton,'keydown',tb.bind(null,this)),q.listen(this._composerBox,'keydown',tb.bind(null,this)),q.listen(this._composerBox,'paste',ub.bind(null,this)),q.listen(this._sendOnEnterButton,'click',wb.bind(null,this)),q.listen(vc.getNode('cancelButton'),'click',ic),q.listen(vc.getNode('deleteButton'),'click',jc.bind(null,this)),q.listen(vc.getNode('reportSpamButton'),'click',lc.bind(null,this)),za.subscribe(za.DETAIL_DOM_CHANGED,vb.bind(null,this)));ab.addSubscriptions(mb.subscribe('threads-updated',function(zc,ad){ad[this._threadID]&&this.updateView();}.bind(this)));}pb.prototype._onStickerClick=function(tc,uc){"use strict";if(!uc||!uc.packID)return;var vc=uc.packID,wc=uc.stickerID;k.log('StickersLoggerConfig',{event:'click_sticker',packid:vc,stickerid:wc});na.onTrayDataReady(function(){if(cb(na.getPackIDsInTray(),vc)){var xc=na.getPack(vc);if(xc&&xc.isPromoted)la.addPack(vc);var yc=this._stickersFlyout,zc=this._stickersFlyoutToggler;if(!zc||!yc||!yc.isMounted())return;la.selectPack(vc);ta.show(zc);}else oa.showStore(vc);}.bind(this));};pb.prototype.waterfallStep=function(tc,uc){"use strict";var vc=this._photoUploader.getWaterfallID();if(!vc)return;fa.sendSignal(db({qn:vc,step:tc,uploader:fa.APP_MESSENGER},uc||{}));};pb.prototype.hideView=function(){"use strict";m.hide(this._rootElement);};pb.prototype.updateView=function(){"use strict";var tc=ka.getCurrentDetailState();m.show(this._rootElement);var uc=ka.getCurrentStateData();qb(this,tc,uc)&&gc(this);m.hide(this._bottomShelfComposer);m.removeClass(this._bottomShelfComposer,'invisible_elem');m.hide(this._bottomShelfButtons);m.show(this._sendOnEnterButton);m.hide(this._cannotReplyAlert);yb(this,this._sendOnEnterDefault);switch(tc){case ja.DETAIL.RECENT_MESSAGES:case ja.DETAIL.SEARCH_CONTEXT:this._threadID=uc.thread_id;if(uc.message_action==ja.MESSAGE_ACTION.DELETE||uc.message_action==ja.MESSAGE_ACTION.REPORT_SPAM){pc(this,uc.message_action);}else if(this._threadID)nb.getThreadMeta(this._threadID,function(vc){if(nb.canReply(this._threadID)){m.show(this._bottomShelfComposer);qc(this);jb.loadDraft(this._threadID,this._composerBox,this._fileUploader,this._shareLinkUploader,this._photoUploader);this._shareLinkUploader.check();}else{ha.renderComponent(ha.createElement(ha.DOM.span,null,aa.getReason(vc)),this._cannotReplyAlert);m.show(this._cannotReplyAlert);}sb(this,vc);}.bind(this));break;case ja.DETAIL.COMPOSE_MAIN:this._threadID=null;m.show(this._bottomShelfComposer);qc(this);sb(this,null);break;default:this._threadID=null;break;}rb(this,tc,uc);rc(this);za.detailDOMChanged();this._state=tc;};pb.prototype.focusComposer=function(){"use strict";this._composerBox.focus();};pb.prototype.submitReply=function(){"use strict";fc(this);};pb.prototype.destroy=function(){"use strict";this._emoticonsPanel&&this._emoticonsPanel.destroy();this._fileUploader.destroy();ka.unregisterConfirmationBeforeStateUpdate(this._confirmationSubscription);};pb.prototype.getStickersFlyoutToggler=function(){"use strict";return this._stickersFlyoutToggler;};function qb(tc,uc,vc){switch(uc){case ja.DETAIL.RECENT_MESSAGES:case ja.DETAIL.SEARCH_CONTEXT:return !vc.reuse_composer&&(tc._threadID!=vc.thread_id||tc._state!=uc);case ja.DETAIL.COMPOSE_MAIN:return vc.start;case ja.DETAIL.SEARCH_SNIPPET:case ja.DETAIL.SEARCH_THREAD_SNIPPET:case ja.DETAIL.SHARED_PHOTOS:return true;}return false;}function rb(tc,uc,vc){var wc=vc.participants&&vc.participants.length>0;m.conditionClass(tc._replyButtonLabel,'uiButtonDisabled',uc==ja.DETAIL.COMPOSE_MAIN&&!wc);}function sb(tc,uc){var vc,wc;if(!uc){vc="Send";wc="Write a message...";}else if(uc.participants&&uc.participants.length<=2){vc="Reply";wc="Write a reply...";}else{vc="Reply All";wc="Write a reply...";}if(tc._composerBox.getAttribute('placeholder')!=wc)t.setPlaceholder(tc._composerBox,wc);l.setLabel(tc._replyButton,vc);bc(tc);}function tb(tc,event){var uc=event.getModifiers();if(uc.any&&event.keyCode!==u.RETURN)return;var vc=false;switch(event.keyCode){case u.ESC:var wc=tc.getStickersFlyoutToggler();ta.hide(wc);return;case u.SPACE:vc=event.getTarget()===tc._replyButton;break;case u.RETURN:var xc=!m.hasClass(tc._bottomShelfComposer,ob),yc=event.getTarget()===tc._replyButton,zc=false;if(!xc){if(wa.windows()){zc=uc.control;}else if(wa.osx()){zc=uc.meta;}else zc=uc.control||uc.meta;}else if(event.getModifiers().any)return;vc=yc||xc||zc;break;case u.UP:case u.DOWN:var ad=ka.getCurrentDetailState();if(tc._composerBox.value||ad!=ja.DETAIL.RECENT_MESSAGES)event.stop();break;}if(vc){fc(tc);tc.focusComposer();return false;}}function ub(tc,event){if(wa.chrome()){var uc=event.clipboardData||event.originalEvent.clipboardData;if(!uc||!uc.items||uc.items.length<1)return;var vc=uc.items[0].type;if(vc!=='image/png')return;if(uc.items[0].getAsFile){var wc=uc.items[0].getAsFile();tc._photoUploader.uploadPastedFile(wc);}}}function vb(tc){qc(tc);zb(tc);}function wb(tc){xb(tc);var uc=!tc._sendOnEnterDefault;tc.focusComposer();tc._sendOnEnterDefault=uc;ga.sendOnEnter=uc;var vc=new bb().setBool('send_on_enter',uc).getURI();new j(vc).send();}function xb(tc){m.toggleClass(tc._bottomShelfComposer,ob);if(m.hasClass(tc._bottomShelfComposer,ob)){tc._sendOnEnterButton.setAttribute('aria-checked','false');}else tc._sendOnEnterButton.setAttribute('aria-checked','true');bc(tc,true);za.detailDOMChanged();}function yb(tc,uc){if(uc==m.hasClass(tc._bottomShelfComposer,ob))xb(tc);}function zb(tc){var uc;if(m.hasClass(tc._bottomShelfComposer,ob)){uc=ac(tc);}else uc=0;var vc=ya.getElementDimensions(tc._bottomShelfToolbar).x;tc._ellipsizer.confineWithin(vc-uc-120);}function ac(tc){return ya.getElementDimensions(tc._replyButtonLabel).x+20;}function bc(tc,uc){var vc='',wc='';if(!m.hasClass(tc._bottomShelfComposer,ob)){wc=ac(tc)+'px';vc='-1';tc._delegator.disable();}else tc._delegator.enable();m.conditionClass(tc._sendContainer,'transition',uc);tc._replyButton.setAttribute('tabindex',vc);pa.set(tc._sendContainer,v.isRTL()?'right':'left',wc);}function cc(tc){var uc=ka.getCurrentStateData(),vc=lb.constructUserGeneratedMessageObject(t.getValue(tc._composerBox),ca.TITAN_WEB,uc.thread_id,uc.participants),wc=tc._fileUploader.getAttachments();if(wc&&wc.length){vc.has_attachment=true;vc.raw_attachments=wc;}var xc=tc._photoUploader.getSelectedFBIDs();if(xc.length>0){vc.has_attachment=true;vc.photo_fbids=xc;}var yc=tc._fileUploader.getImageFiles();if(yc.length>0){vc.has_attachment=true;vc.image_ids=yc;}var zc=tc._fileUploader.getVideoFiles();if(zc.length>0){vc.has_attachment=true;vc.video_ids=zc;}var ad=tc._fileUploader.getAudioFiles();if(ad.length>0){vc.has_attachment=true;vc.audio_ids=ad;}var bd=tc._fileUploader.getFiles();if(bd.length>0){vc.has_attachment=true;vc.file_ids=bd;}if(tc._shareLinkUploader.getAttachData()){vc.has_attachment=true;vc.content_attachment=tc._shareLinkUploader.getAttachData();}vc.force_sms=true;vc.ui_push_phase=n.UIPushPhase;return vc;}function dc(tc,uc,vc){tc.waterfallStep(fa.SESSION_POSTED);tc._sendSubscription=lb.sendMessage(uc,function(wc){tc.waterfallStep(fa.POST_PUBLISHED);if(!vc){jb.clearDraft(wc);gc(tc);}tc._messageSent=true;var xc=tc.getStickersFlyoutToggler(),yc=false;if(xc)yc=ta.isShown(xc);var zc=s.getFromMeta(nb.getThreadMetaNow(wc)),ad=ja.DETAIL.RECENT_MESSAGES;if(ka.getCurrentDetailState()!==ad)ka.updateDetailState(ad,{thread_id:wc,folder:zc,reuse_composer:vc});tc._messageSent=false;if(xc&&yc)ta.show(xc);},w.WEBMESSENGER);tc.focusComposer();}function ec(tc,uc){var vc=ka.getCurrentStateData(),wc=lb.constructUserGeneratedMessageObject('',ca.TITAN_WEB,vc.thread_id,vc.participants);if(!wc.thread_id&&!wc.specific_to_list.length)return;wc.has_attachment=true;wc.sticker_id=uc;dc(tc,wc,true);}function fc(tc){if(tc._fileUploader.isUploading()||tc._photoUploader.isUploading()){hc(tc,true);return;}var uc=cc(tc),vc=t.isEmpty(tc._composerBox);if((vc&&!uc.has_attachment)||(!uc.thread_id&&!uc.specific_to_list.length))return;if(m.hasClass(tc._bottomShelfComposer,ob)){m.show(tc._loadingIndicator);m.hide(tc._replyButtonLabel);tc._composerBox.setAttribute('disabled','disabled');}dc(tc,uc);}function gc(tc){t.reset(tc._composerBox);qc(tc);tc._typingDetector&&tc._typingDetector.resetState();tc._fileUploader.removeAttachments();tc._shareLinkUploader.clear();if(tc._photoUploader.getSelectedFBIDs().length>0)tc._photoUploader.clear();m.hide(tc._loadingIndicator);m.show(tc._replyButtonLabel);tc._composerBox.removeAttribute('disabled');if(tc._sendSubscription){lb.unsubscribeSend(tc._sendSubscription);tc._sendSubscription=null;}hc(tc,false);}function hc(tc,uc){m.conditionShow(tc._uploadingWarning,uc);tc._blockedOnUpload=uc;}function ic(){var tc=ka.getCurrentDetailState(),uc=ka.getCurrentStateData();delete uc.message_action;ka.updateDetailState(tc,uc);}function jc(tc){var uc=tc._manager.getSelectedMessageIDs().length;i.send(new j('/ajax/mercury/delete_messages_dialog.php').setData({count:uc}),function(vc){vc.subscribe('confirm',kc.bind(null,tc,vc));});}function kc(tc,uc){var vc=tc._manager.getSelectedMessageIDs();lb.deleteMessages(tc._threadID,vc);uc.hide();var wc=ka.getCurrentStateData();if(wc.message_action){var xc=db({},wc);delete xc.message_action;ka.updateDetailState(ka.getCurrentDetailState(),xc);}}function lc(tc){var uc=tc._manager.getSelectedMessageIDs().length;i.send(new j('/ajax/mercury/mark_spam_messages_dialog.php').setData({count:uc}),function(vc){vc.subscribe('confirm',mc.bind(null,tc,vc));});}function mc(tc,uc){var vc=tc._manager.getSelectedMessageIDs();lb.markMessagesSpam(tc._threadID,vc);uc.hide();var wc=ka.getCurrentStateData();if(wc.message_action){var xc=db({},wc);delete xc.message_action;ka.updateDetailState(ka.getCurrentDetailState(),xc);}}function nc(tc){if(tc._messageSent)return false;if(!t.isEmpty(tc._composerBox))return true;var uc=tc._fileUploader.getAttachments();if((uc&&uc.length)||tc._fileUploader.getImageFiles().length>0||tc._fileUploader.getVideoFiles().length>0||tc._shareLinkUploader.getAttachData()||tc._photoUploader.getSelectedFBIDs().length>0)return true;var vc=ka.getCurrentStateData(),wc=ka.getCurrentDetailState(),xc=wc==ja.DETAIL.COMPOSE_MAIN||wc==ja.DETAIL.COMPOSE_TYPEAHEAD_RESULTS||wc==ja.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS;if(xc&&!vc.start&&(vc.participants||[]).length)return true;return false;}function oc(tc){ia.onBeforeUnload(function(){var uc=va.getNextURI();if(!uc.getQueryData().hasOwnProperty('theater')&&!xa.isVaultBoxURI(uc))jb.saveDraft(tc._threadID,tc._composerBox,tc._fileUploader,tc._shareLinkUploader,tc._photoUploader);if(!hb(uc)&&!uc.getQueryData().hasOwnProperty('theater')&&!xa.isVaultBoxURI(uc)&&nc(tc))return "You haven't sent your message.";},true);ia.onBeforeUnload(function(){if(hb(va.getNextURI())&&nc(tc))return "You haven't sent your message.";},false);ia.onUnload(function(){jb.saveDraft(tc._threadID,tc._composerBox,tc._fileUploader,tc._shareLinkUploader,tc._photoUploader);});}function pc(tc,uc){m.show(tc._bottomShelfComposer);m.addClass(tc._bottomShelfComposer,'invisible_elem');m.conditionClass(tc._bottomShelfButtons,'delete',uc==ja.MESSAGE_ACTION.DELETE);m.conditionClass(tc._bottomShelfButtons,'report_spam',uc==ja.MESSAGE_ACTION.REPORT_SPAM);m.show(tc._bottomShelfButtons);}function qc(tc){pa.set(tc._emoteWrapper,v.isRTL()?'right':'left',(tc._composerBox.clientWidth+22)+'px');}function rc(tc){if(tc._typingDetector){var uc=tc._threadID,vc=null;if(uc){vc=nb.getCanonicalUserInThread(uc);var wc=nb.getThreadMetaNow(uc);if((!wc||wc.is_canonical)&&!vc)uc=null;}if(!uc){tc._typingDetector.setUserAndThread(vc,uc);return;}kb.getServerThreadID(uc,function(xc){tc._typingDetector.setUserAndThread(vc,xc);});}}function sc(tc,uc,vc){if(o.contains(tc._ariaOwns,vc))tc._composerBox.setAttribute('aria-activedescendant',vc);}e.exports=pb;},null);
__d("WebMessengerSharedPhotos.react",["AsyncRequest","Bootloader","cx","copyProperties","fbt","glyph","Grid.react","LoadingIndicator.react","Pixelz.react","React","Image.react","ReactPropTypes","WebMessengerStateConstants","WebMessengerStateManager","URI","XUIButton.react"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){var w=m.GridItem,x="Return to Conversation",y=42,z=p.createClass({displayName:'WebMessengerSharedPhotos',propTypes:{threadID:r.string.isRequired,totalWidth:r.number.isRequired},getInitialState:function(){return {isLoadingMore:true,moreImages:true,imagesData:{}};},componentDidMount:function(){this.requestImages();},componentDidUpdate:function(){if(!this.isVisible())this.requestImages();},componentWillReceiveProps:function(aa){if(aa.threadID&&aa.threadID!==this.props.threadID)this.setState({isLoadingMore:true,moreImages:true,imagesData:{}});},isVisible:function(){return !(this.state.isLoadingMore&&this.state.moreImages&&Object.keys(this.state.imagesData).length===0);},loadMoreImages:function(){if(this.state.moreImages&&!this.state.isLoadingMore){this.setState({isLoadingMore:true});this.requestImages();}},renderImages:function(){var aa=Math.floor((this.props.totalWidth-y)/3),ba=Object.keys(this.state.imagesData).map(function(ca){return (p.createElement(w,null,p.createElement(p.DOM.div,{className:"_5dq3",onClick:this.viewFullImage.bind(null,ca)},p.createElement(o,{upscale:true,width:aa,height:aa,resizeMode:'cover',src:this.state.imagesData[ca].URI,borderRadius:1,insetBorderColor:"rgba(0, 0, 0, 0.1)"}))));}.bind(this));return ba;},viewFullImage:function(aa){var ba=u('/ajax/messaging/attachments/sharedphotos.php').setQueryData({thread_id:this.props.threadID,image_id:aa});h.loadModules(["MessagesViewer","MessagesViewerSetID"],function(ca,da){ca.bootstrapWithConfig({fbid:aa,dimensions:this.state.imagesData[aa].dim,src:this.state.imagesData[aa].URI,disablePaging:Object.keys(this.state.imagesData).length===1,endpoint:ba,setID:da.MESSAGES_VIEW_ALL_IN_THREAD});}.bind(this));},requestImages:function(){new g().setURI('/ajax/messaging/attachments/sharedphotos.php').setMethod("POST").setData({thread_id:this.props.threadID,offset:Object.keys(this.state.imagesData).length,limit:30}).setHandler(function(aa){this.setState({isLoadingMore:false,moreImages:aa.payload.moreImagesToLoad,imagesData:j({},this.state.imagesData,aa.payload.imagesData)});}.bind(this)).send();},returnToThread:function(){var aa=j({},t.getCurrentStateData());t.updateDetailState(s.DETAIL.RECENT_MESSAGES,aa);},render:function(){var aa=(p.createElement(p.DOM.div,{className:((this.isVisible()?"_5dq2":'')+(!this.isVisible()?' '+"_5dq1":'')+(!this.isVisible()?' '+"_5dpz":''))},p.createElement(n,{color:"white",size:"large"})));if(!this.isVisible()){return aa;}else if(!this.state.isLoadingMore)aa=null;return (p.createElement(p.DOM.div,{className:"_5dpz"},p.createElement(p.DOM.div,{className:"_5dp-"},p.createElement(v,{image:p.createElement(q,{src:l('back')}),label:x,size:"medium",onClick:this.returnToThread})),p.createElement(p.DOM.div,{className:"_5dq0"},p.createElement(m,{cols:3,fixed:false},this.renderImages()),aa)));}});e.exports=z;},null);
__d("WebMessengerDetailViewSharedPhotosControl",["CSS","DOM","React","WebMessengerSharedPhotos.react","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerEvents","WebMessengerSubscriptionsHandler","MercuryServerRequests"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=b('MercuryServerRequests').get();function p(q,r){"use strict";this.manager=q;this.rootElement=r;this.component=null;this.serverID=null;this.state=null;this.threadID=null;h.empty(this.rootElement);n.addSubscriptions(this.manager.subscribe('scrolledNearBottom',this.notifyImageRequest.bind(this)),m.subscribe(m.DETAIL_DOM_CHANGED,this.render.bind(this)));}p.prototype.hideView=function(){"use strict";g.hide(this.rootElement);};p.prototype.updateView=function(){"use strict";g.show(this.rootElement);this.updateStateAndData();this.render();};p.prototype.destroy=function(){"use strict";n.release();};p.prototype.updateStateAndData=function(){"use strict";this.state=l.getCurrentDetailState();var q=l.getCurrentStateData();this.threadID=q.thread_id;};p.prototype.render=function(){"use strict";this.serverID=o.getServerThreadIDNow(this.threadID);if(!this.serverID)return;if(!this.component){this.component=i.createElement(j,{threadID:this.serverID,totalWidth:this.rootElement.clientWidth});this.component=i.renderComponent(this.component,this.rootElement);}else this.component.setProps({threadID:this.serverID,totalWidth:this.rootElement.clientWidth});};p.prototype.notifyImageRequest=function(){"use strict";var q=l.getCurrentDetailState();if(q===k.DETAIL.SHARED_PHOTOS&&this.manager.isScrolledToBottom()&&this.component)this.component.loadMoreImages();};e.exports=p;},null);
__d("WebMessengerThreadIsMutedTabSheet",["Event","ArbiterMixin","DOM","WebMessengerTemplates","mixin"],function(a,b,c,d,e,f,g,h,i,j,k){var l=k(h);for(var m in l)if(l.hasOwnProperty(m))o[m]=l[m];var n=l===null?null:l.prototype;o.prototype=Object.create(n);o.prototype.constructor=o;o.__superConstructor__=l;function o(p,q){"use strict";this._rootElement=p;this._sheetView=q;}o.prototype.render=function(){"use strict";var p=j[':fb:web-messenger:read-view:message-mute-sheet'].build();i.setContent(p.getNode('text'),i.tx._("This conversation is muted. Chat tabs will not pop up for it and push notifications are off."));i.setContent(this._rootElement,p.getRoot());g.listen(p.getNode('unmuteButton'),'click',function(){this.inform('clicked',null);}.bind(this));};o.prototype.isPermanent=function(){"use strict";return false;};o.prototype.getType=function(){"use strict";return 'wb-thread-is-muted';};o.prototype.open=function(){"use strict";this._sheetView.open(this);};o.prototype.close=function(){"use strict";this._sheetView.close(this);};e.exports=o;},null);
__d("WebMessengerDetailViewSheetControl",["DOM","ArbiterMixin","WebMessengerStateManager","MercurySheetView","WebMessengerTemplates","MercuryThreadMuter","WebMessengerThreadIsMutedTabSheet","WebMessengerSubscriptionsHandler","mixin","MercuryThreadInformer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=b('MercuryThreadInformer').get(),q=b('MercuryThreads').get(),r=o(h);for(var s in r)if(r.hasOwnProperty(s))u[s]=r[s];var t=r===null?null:r.prototype;u.prototype=Object.create(t);u.prototype.constructor=u;u.__superConstructor__=r;function u(v){"use strict";this._template=k[':fb:web-messenger:tab-sheet-container'].build();this._rootElement=this._template.getNode('sheet');this._threadID=i.getCurrentStateData().thread_id;this._sheetView=new j(this._threadID,this._rootElement,v);this._threadIsMutedTabSheet=new m(this._rootElement,this._sheetView);this._muteSetting=undefined;g.setContent(v,this._template.getRoot());this._threadIsMutedClickSub=this._threadIsMutedTabSheet.subscribe('clicked',function(){q.updateThreadMuteSetting(this._threadID,0);}.bind(this));n.addSubscriptions(this._sheetView.subscribe('resize',this.inform.bind(this,'resize')),p.subscribe('threads-updated',function(w,x){if(this._threadID&&x[this._threadID])this.updateTabSheet(false);}.bind(this)));this.updateTabSheet(true);}u.prototype.updateView=function(){"use strict";var v=i.getCurrentStateData().thread_id;if(this._threadID!=v){this._threadID=v;this.updateTabSheet(true);}};u.prototype.updateTabSheet=function(v){"use strict";if(!this._threadID)return;q.getThreadMeta(this._threadID,function(w){var x=l.getThreadMuteSettingForUser(w);if(x!=this._muteSetting||v){if(x){this._threadIsMutedTabSheet.open();}else this._threadIsMutedTabSheet.close();this._muteSetting=x;}}.bind(this));};u.prototype.destroy=function(){"use strict";this._threadIsMutedClickSub&&this._threadIsMutedClickSub.unsubscribe();};e.exports=u;},null);
__d("WebMessengerDetailViewControlManager",["Event","ArbiterMixin","CSS","WebMessengerDetailViewHeaderControl","DOM","WebMessengerFlexibleScrollArea","WebMessengerDetailViewActionsMenuControl","WebMessengerDetailViewAllPeopleResultsControl","WebMessengerDetailViewComposeTypeaheadControl","WebMessengerDetailViewRecentMessagesControl","WebMessengerDetailViewSearchContextControl","WebMessengerDetailViewSearchSnippetsControl","WebMessengerDetailViewBottomShelfControl","WebMessengerDetailViewSharedPhotosControl","WebMessengerMessagesSelection","Parent","WebMessengerDetailViewSheetControl","WebMessengerStateManager","WebMessengerStateConstants","Style","UserAgent_DEPRECATED","WebMessengerEvents","WebMessengerSubscriptionsHandler","WebMessengerTemplates","mixin","getElementPosition"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa){var ga=ea(h);for(var ha in ga)if(ga.hasOwnProperty(ha))ja[ha]=ga[ha];var ia=ga===null?null:ga.prototype;ja.prototype=Object.create(ia);ja.prototype.constructor=ja;ja.__superConstructor__=ga;function ja(ka){"use strict";this._rootElement=ka;k.empty(this._rootElement);var la=da[':fb:web-messenger:read-view'].build();k.setContent(this._rootElement,la.getRoot());this._readContainer=la.getNode('readContainer');this._headerControl=new j(la.getNode('detailViewHeader'));this._actionsMenuControl=new m(la.getNode('detailViewActionsMenu'),this._headerControl);this._allPeopleResultsControl=new n(la.getNode('detailViewAllPeopleResults'));this._composeTypeaheadControl=new o(la.getNode('detailViewComposeTypeahead'),la.getNode('detailViewComposeTypeaheadResults'));this._searchContextControl=new q(this,la.getNode('detailViewSearchContext'),la.getNode('snippetPaginationControlBox'));this._searchSnippetsControl=new r(this,la.getNode('detailViewSearchSnippets'));this._sharedPhotosControl=new t(this,la.getNode('detailViewSharedPhotos'));this._sheetControl=new w(la.getNode('detailViewSheetTab'));var ma=la.getNode('detailViewBottomShelf');this._bottomShelfControl=new s(this,ma);this._detailViewScroller=la.getNode('readMessagesScroller');ca.addSubscriptions(g.listen(this._detailViewScroller,'click',function(oa){if(v.byTag(oa.getTarget(),'a')||k.getSelection())return;this._bottomShelfControl.focusComposer();}.bind(this)));var na={fade:!!aa.osx(),persistent:true};this._flexArea=new l(this._detailViewScroller,na).setBottomAligned(false).setInfiniteScrollHandler(this.inform.bind(this,'scrolledNearTop'),true).setInfiniteScrollHandler(this.inform.bind(this,'scrolledNearBottom')).setContainer(this._rootElement).setMinFlexAreaHeight(200).draw();ca.addSubscriptions(ba.subscribe(ba.DETAIL_DOM_CHANGED,this._flexArea.draw.bind(this._flexArea)),ba.subscribe(ba.SUBMIT_REPLY,this._bottomShelfControl.submitReply.bind(this._bottomShelfControl)),x.subscribe(y.STATE_CHANGE_EVENT,this.updateOnStateChange.bind(this)));ca.addSubscriptions(this._sheetControl.subscribe('resize',this._flexArea.draw.bind(this._flexArea)));this._recentMessagesControl=new p(this,la.getNode('detailViewRecentMessages'),la.getNode('loadingSpinner'),la.getNode('noSelectedConversation'),la.getNode('newMessageLink'),la.getNode('showUnreadLink'),ma);this._stateData={};this._resizeNodes=[this._rootElement,this._detailViewScroller,k.find(this._detailViewScroller,'div.uiScrollableAreaBody')];}ja.prototype.updateOnStateChange=function(){"use strict";var ka=x.getCurrentDetailState(),la=this._stateData;this._stateData=x.getCurrentStateData();this._flexArea.setTabbable(ka!==y.DETAIL.COMPOSE_MAIN);this._allPeopleResultsControl.hideView();this._composeTypeaheadControl.hideView();this._recentMessagesControl.hideView();this._searchContextControl.hideView();this._searchSnippetsControl.hideView();this._sharedPhotosControl.hideView();i.removeClass(this._readContainer,'blankComposeState');i.conditionClass(this._readContainer,'blankComposeState',ka===y.DETAIL.COMPOSE_MAIN);this._bottomShelfControl.updateView();this._actionsMenuControl.updateView();this._headerControl.updateView();switch(ka){case y.DETAIL.RECENT_MESSAGES:this._recentMessagesControl.updateView();this._sheetControl.updateView();break;case y.DETAIL.COMPOSE_ALL_PEOPLE_RESULTS:this._allPeopleResultsControl.updateView();case y.DETAIL.COMPOSE_MAIN:case y.DETAIL.COMPOSE_TYPEAHEAD_RESULTS:this._composeTypeaheadControl.updateView();break;case y.DETAIL.SHARED_PHOTOS:this._sharedPhotosControl.updateView();break;case y.DETAIL.SEARCH_SNIPPET:case y.DETAIL.SEARCH_THREAD_SNIPPET:this._searchSnippetsControl.updateView();break;case y.DETAIL.SEARCH_CONTEXT:this._searchContextControl.updateView();break;}switch(ka){case y.DETAIL.RECENT_MESSAGES:case y.DETAIL.SEARCH_CONTEXT:if(la.thread_id!=this._stateData.thread_id)this._bottomShelfControl.focusComposer();break;}};ja.prototype.openUserJoinStatusSheet=function(ka){"use strict";this._sheetControl.openUserJoinStatusSheet(ka);};ja.prototype.hideAll=function(){"use strict";this._headerControl.hideView();this._actionsMenuControl.hideView();this._allPeopleResultsControl.hideView();this._composeTypeaheadControl.hideView();this._recentMessagesControl.hideView();this._searchContextControl.hideView();this._searchSnippetsControl.hideView();this._sharedPhotosControl.hideView();this._bottomShelfControl.hideView();};ja.prototype.getSelectedMessageIDs=function(){"use strict";var ka=x.getCurrentDetailState();switch(ka){case y.DETAIL.RECENT_MESSAGES:case y.DETAIL.SEARCH_CONTEXT:return u.getSelectedMessageIDs();}return [];};ja.prototype.scrollIntoView=function(ka){"use strict";this._flexArea&&this._flexArea.scrollIntoView(ka);};ja.prototype.setScrollTop=function(ka,la){"use strict";this._flexArea&&this._flexArea.setScrollTop(ka,la);};ja.prototype.isScrolledToBottom=function(){"use strict";return this._flexArea&&this._flexArea.isScrolledToBottom();};ja.prototype.scrollToBottom=function(ka){"use strict";this._flexArea&&this._flexArea.scrollToBottom(ka);};ja.prototype.draw=function(){"use strict";this._flexArea&&this._flexArea.draw();};ja.prototype.poke=function(){"use strict";this._flexArea&&this._flexArea.poke();};ja.prototype.addScrollCallback=function(ka){"use strict";this._flexArea&&this._flexArea.addScrollCallback(ka);};ja.prototype.getFlexAreaBoundingClientRect=function(){"use strict";return fa(this._flexArea.flexArea);};ja.prototype.resizeTo=function(ka){"use strict";this._resizeNodes.forEach(function(la){z.set(la,'width',ka+'px');});ba.detailDOMChanged();};ja.prototype.destroy=function(){"use strict";this._headerControl.destroy();this._actionsMenuControl.destroy();this._allPeopleResultsControl.destroy();this._composeTypeaheadControl.destroy();this._recentMessagesControl.destroy();this._searchContextControl.destroy();this._searchSnippetsControl.destroy();this._bottomShelfControl.destroy();this._sharedPhotosControl.destroy();this._flexArea.destroy();this._sheetControl.destroy();};e.exports=ja;},null);
__d("WebMessengerAuxMenu",["SelectableMenu","MenuSelectableItem","MenuTheme","PopoverMenuOverlappingBorder","Popover","PopoverMenu"],function(a,b,c,d,e,f,g,h,i,j,k,l){function m(n,o){"use strict";this._menu=new g([],{className:o,theme:i});var p=new k(n.parentNode,n,null,{alignh:'right'});new l(p,n,this._menu,[j]);}m.prototype.addOption=function(n,o){"use strict";var p=new h({markup:n,title:''});p.setOnClickHandler(o);this._menu.addItem(p);return p;};m.prototype.destroy=function(){"use strict";};e.exports=m;},null);
__d("WebMessengerMenuFolderControl",["WebMessengerAuxMenu","CSS","Parent","WebMessengerTemplates","Toggler","cx","WebMessengerSubscriptionsHandler"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n,o;function p(r){return i.byClass(r,"_282");}function q(r,s,t){"use strict";var u=!n||n!=s;n=s;this._template=j[':fb:web-messenger:master-view:tab-bar:menu-option'].build();this._template.setNodeContent('folderLabel',r);if(!o||u){o=new g(n,"_1j");h.show(p(n));m.addSubscriptions(k.subscribe(['show','hide'],function(v,w){var x=w.getActive(),y=x&&i.byClass(x,"_282");if(y)h.conditionClass(y,"_50p_",v==='show');}));}this._menuItem=o.addOption(this._template.getRoot(),t);this._menuItem.getRoot();}q.prototype.getCountBadge=function(){"use strict";return this._template.getNode('count');};q.prototype.setSelected=function(r){"use strict";h.conditionClass(p(n),'selectedFolder',r);if(r){this._menuItem.select();}else this._menuItem.deselect();};q.prototype.destroy=function(){"use strict";o&&o.destroy();};e.exports=q;},null);
__d("MessagingFilteringNux",["Arbiter","AsyncRequest","LayerDestroyOnHide","LayerHideOnTransition","MercuryConfig","isWebMessengerURI"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=null,n,o={ACCEPTED_EVENT:'filtering/accepted',DIALOG_REGISTERED_EVENT:'filtering/dialog-registered',tryShow:function(p){g.subscribe(o.DIALOG_REGISTERED_EVENT,function(){if(!m)return;m.setContext(p);m.show();m=null;},g.SUBSCRIBE_ALL);},registerDialog:function(p){m=p.disableBehavior(i).disableBehavior(j);n=g.subscribe('page_transition',function(q,r){if(!l(r.uri)){p&&p.destroy();n.unsubscribe();}},g.SUBSCRIBE_NEW);if(p)p.subscribe('confirm',function(){k.filtering_active=true;new h('/ajax/web_messenger/dismiss_filtering_nux.php').send();p.hide();g.inform(o.ACCEPTED_EVENT,{});});g.inform(o.DIALOG_REGISTERED_EVENT,{},g.BEHAVIOR_PERSISTENT);}};e.exports=o;},null);
__d("WebMessengerTabbedFolderControl",["Event","CSS","WebMessengerTemplates"],function(a,b,c,d,e,f,g,h,i){function j(k,l,m,n){"use strict";this._template=i[':fb:web-messenger:master-view:tab-bar:folder'].build();this._template.setNodeContent('folderLabel',k);this._listener=g.listen(this._template.getNode('link'),'click',m);if(n)this._countListener=g.listen(this._template.getNode('count'),'click',n);l.push(this._template.getRoot());}j.prototype.getCountBadge=function(){"use strict";return this._template.getNode('count');};j.prototype.setSelected=function(k){"use strict";h.conditionClass(this._template.getRoot(),'selectedFolder',k);};j.prototype.getElement=function(){"use strict";this._template.getRoot();};j.prototype.destroy=function(){"use strict";this._listener.remove();this._countListener&&this._countListener.remove();};e.exports=j;},null);
__d("WebMessengerEditFilteringSettingDialog",["AsyncDialog","AsyncRequest","MercuryConstants","DOM","csx"],function(a,b,c,d,e,f,g,h,i,j,k){var l='/ajax/mercury/edit_filtering_type.php',m='/ajax/mercury/change_filtering_type.php',n={show:function(){var o=function(q){var r=q.getRoot(),s=j.find(r,"._cq6").checked,t=j.find(r,"._cq7").checked,u='';if(s){u=i.MessagingFilteringType.MODERATE;}else if(t)u=i.MessagingFilteringType.STRICT;new h(m).setData({filtering_type:u}).send();q.hide();},p=function(q){q.subscribe('confirm',o.bind(null,q));q.show();};g.send(new h(l),p);}};e.exports=n;},null);
__d("WebMessengerMercury",["MercuryMessages","MercuryOrderedThreadlist","MercuryServerRequests","WebMessengerStateManager","MercuryThreadInformer","MercuryThreads","MercuryUnreadState","MercuryUnseenState"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o={getMessages:function(){return g.getForFBID(p());},getOrderedThreadlist:function(){return h.getForFBID(p());},getServerRequests:function(){return i.getForFBID(p());},getThreadInformer:function(){return k.getForFBID(p());},getThreads:function(){return l.getForFBID(p());},getUnreadState:function(){return m.getForFBID(p());},getUnseenState:function(){return n.getForFBID(p());}};function p(){return j.getCurrentUserID();}e.exports=o;},null);
__d("WebMessengerMasterViewTabBarControl",["JSXDOM","Arbiter","CSS","DOM","Event","Ellipsizer","WebMessengerMenuFolderControl","MercuryConfig","MercuryFilters","MercuryFolders","MercuryThreadlistConstants","MessagingFilteringNux","MessagingTag","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTabbedFolderControl","WebMessengerTemplates","WebMessengerEditFilteringSettingDialog","WebMessengerEvents","WebMessengerSubscriptionsHandler","WebMessengerMercury","copyProperties","csx","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da){function ea(la,ma,na){"use strict";this._manager=la;this._rootElement=ma;this._rootTopContentElement=na;this._threadInformer=aa.getThreadInformer();this._unreadState=aa.getUnreadState();j.empty(this._rootElement);var oa=w[':fb:web-messenger:master-view:tab-bar'].build(),pa=w[':fb:web-messenger:master-view:top-content'].build();j.setContent(this._rootElement,oa.getRoot());j.setContent(this._rootTopContentElement,pa.getRoot());this._tabList=oa.getRoot();this._moreMenu=oa.getNode('moreMenu');this._topContentCont=pa.getRoot();this._topContent=pa.getNode('masterViewTopContentHolder');this._closeButton=pa.getNode('masterViewTopContentCloseButton');this._closeButtonCont=pa.getNode('masterViewTopContentCloseCont');this._state=null;this._folder=null;this._filter=null;this._query=null;this._threadID=null;this._folders=p.getSupportedFolders();this._foldersToHeader={};this._filters=o.getSupportedFilters();this._filtersToHeader={};this._otherMarkAllRead=g.a({href:"#"},"Mark All as Read");this._unreadMarkAllRead=g.a({href:"#"},"Mark All as Read");this._otherEditSettings=g.a({href:"#"},"Edit Preferences");var qa=[];this._filters.forEach(function(ta){var ua=ja.bind(null,this,s.INBOX,ta);switch(ta){case s.UNREAD:this._filtersToHeader[ta]=this._filtersToHeader[ta]||new m("Unread",this._moreMenu,ua);break;}}.bind(this));this._folders.forEach(function(ta){var ua=ja.bind(null,this,ta,o.ALL),va=ja.bind(null,this,ta,s.UNREAD);switch(ta){case s.INBOX:this._foldersToHeader[ta]=this._foldersToHeader[ta]||new v("Inbox",qa,ua,va);break;case s.OTHER:this._foldersToHeader[ta]=this._foldersToHeader[ta]||new v("Other",qa,ua);break;case s.ACTION_ARCHIVED:this._foldersToHeader[ta]=this._foldersToHeader[ta]||new m("Archived",this._moreMenu,ua);break;case s.SPAM:this._foldersToHeader[ta]=this._foldersToHeader[ta]||new m("Spam",this._moreMenu,ua);break;}}.bind(this));j.prependContent(this._tabList,qa);var ra=j.scry(this._tabList,"._6xt");ra.push(oa.getNode('moreMenuLabel'));this._ellipsizer=new l(ra);fa(this);var sa=ja.bind(null,this,s.INBOX,o.ALL);h.subscribe(r.ACCEPTED_EVENT,ia.bind(null,this));z.addSubscriptions(this._threadInformer.subscribe('unread-updated',ka.bind(null,this)),k.listen(this._otherMarkAllRead,'click',function(){this._unreadState.markFolderAsRead(s.OTHER);}.bind(this)),k.listen(this._unreadMarkAllRead,'click',function(){this._unreadState.markFolderAsRead(s.INBOX);}.bind(this)),k.listen(this._otherEditSettings,'click',function(){x.show();}),k.listen(this._closeButton,'click',sa));}ea.prototype.updateView=function(){"use strict";var la=ha(this);ga(this);if(la)ia(this);fa(this);};ea.prototype.getOtherFolderLabel=function(){"use strict";var la=s.OTHER,ma=this._foldersToHeader[la];if(!ma||!ma._template)return null;return ma._template.getNode('folderLabel');};ea.prototype.destroy=function(){"use strict";for(var la in this._foldersToHeader)this._foldersToHeader[la]&&this._foldersToHeader[la].destroy();for(var ma in this._filtersToHeader)this._filtersToHeader[ma]&&this._filtersToHeader[ma].destroy();};function fa(la){var ma=85;j.scry(la._tabList,"._1r").forEach(function(na){ma+=na.offsetWidth;});la._ellipsizer.confineWithin(la._rootElement.offsetWidth-ma);}function ga(la){var ma=u.getCurrentStateData();la._state=u.getCurrentMasterState();la._folder=ma.folder;la._filter=ma.filter;la._query=ma.query;}function ha(la){if(!la._state||!la._folder)return true;var ma=u.getCurrentStateData();if(la._folder!=ma.folder)return true;if(la._filter!=ma.filter)return true;return false;}function ia(la){var ma=false,na;la._folders.forEach(function(oa){var pa=la._filter==s.UNREAD,qa=oa==la._folder&&(la._filter==o.ALL||pa),ra,sa;switch(oa){case s.INBOX:if(pa){var ta=g.strong(null,"Unread"),ua=g.strong(null,"Inbox"),va=da._("{unread} messages in {inbox}",{unread:ta,inbox:ua});ra=g.div(null,va,' \u00b7 ',la._unreadMarkAllRead);sa=true;}break;case s.OTHER:var wa='';if(n.filtering_active)wa=g.span(null,la._otherEditSettings,' \u00b7 ');ra=g.div(null,g.p(null,g.strong(null,"Tip:"+' ')," See a message from someone you know? Just reply or click Move to Inbox. "),wa,la._otherMarkAllRead);r.tryShow(la.getOtherFolderLabel());break;}if(qa){na=oa;i.conditionShow(la._closeButtonCont,sa);}else la._foldersToHeader[oa].setSelected(false);if(qa&&ra){ma=true;j.setContent(la._topContent,ra);}});la._filters.forEach(function(oa){var pa=la._folder==s.INBOX&&oa==la._filter;la._filtersToHeader[oa].setSelected(pa);});na&&la._foldersToHeader[na].setSelected(true);i.conditionShow(la._topContentCont,ma);ka(la);la._manager.draw();}function ja(la,ma,na){var oa=la._state==t.MASTER.SEARCH;if(oa||la._folder!=ma||la._filter!=na){var pa=ba({},u.getCurrentStateData()),qa=u.getCurrentDetailState();if(qa!==t.DETAIL.SEARCH_SNIPPET&&qa!==t.DETAIL.SEARCH_CONTEXT)delete pa.query;u.updateMasterState(t.MASTER.RECENT_THREADS,ba(pa,{folder:ma,filter:na}));}y.focusComposer();return false;}function ka(la){for(var ma in la._foldersToHeader){if(ma==s.ACTION_ARCHIVED)continue;var na=la._unreadState.exceedsMaxCount(ma)?q.MAX_UNREAD_COUNT+'+':la._unreadState.getUnreadCount(ma),oa=[la._foldersToHeader[ma].getCountBadge()];if(ma==s.INBOX)la._filters.forEach(function(pa){oa.push(la._filtersToHeader[pa].getCountBadge());});oa.forEach(function(pa){if(na)j.setContent(pa,j.tx._("({unread_count})",{unread_count:na}));i.conditionShow(pa,na);});}fa(la);}e.exports=ea;},null);
__d("MercuryLocalThreadResults",["CurrentUser","MercuryFolders","MercuryIDs","MercuryParticipants","MercuryThreadSearchUtils","MercuryOrderedThreadlist","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k){var l=b('MercuryOrderedThreadlist').get(),m=b('MercuryThreads').get(),n={findMatchingThreadsFromIds:function(q,r){return r.filter(function(s){var t=m.getThreadMetaNow(s);return o(t,q);});},findMatchingThreads:function(q){var r=[];h.getSupportedFolders().forEach(function(s){r=r.concat(l.getThreadlistUntilTimestamp(0,s));}.bind(this));return this.findMatchingThreadsFromIds(q,r);}};function o(q,r){var s=p(q.participants),t=k.wordsInString(r),u=null;j.getMulti(s,function(v){u=s.map(function(w){return v[w];});});if(!u)return false;return k.allMatchPredicate(t,function(v){var w=k.anyMatchPredicate(u,function(y){return y&&y.name&&k.queryWordMatchesAnyNameWord(v,k.wordsInString(y.name));}),x=q.name&&k.queryWordMatchesAnyNameWord(v,k.wordsInString(q.name));return w||x;});}function p(q){if(q.length===1&&i.tokenize(q[0]).value===g.getID())return q;return q.filter(function(r){var s=i.tokenize(r).value;return s!==g.getID();});}e.exports=n;},null);
__d("MercurySearchThreadResults",["KeyedCallbackManager","MercuryAPIArgsSource","MercuryConfig","MercuryThreadlistConstants","RangedCallbackManager","MercuryServerDispatcher","MercuryServerRequests"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=b('MercuryServerRequests').get(),n=new g(),o=j.WEBMESSENGER_THREAD_COUNT,p=j.WEBMESSENGER_MORE_COUNT,q={getThreadlist:function(t,u){if(t){var v=n.executeOrEnqueue(t,function(y){var z=y.getAllResources(),aa=y.hasReachedEndOfArray();u(z,aa);}),w=n.getUnavailableResources(v),x=h.WEBMESSENGER;if(w.length)s({client:x,query:t,offset:0,limit:o+1});return v;}},isExhausted:function(t){var u=n.getResource(t);return u?u.hasReachedEndOfArray():false;},getCachedThreadlist:function(t){var u=n.getResource(t);return u?u.getAllResources():null;},cacheThreadlist:function(t,u){n.getResource(t);var v=new k();v.addResourcesWithoutSorting(u,0);v.setReachedEndOfArray();n.setResource(t,v);},getMoreThreadlist:function(t,u){if(t){var v=n.getResource(t);if(v){var w=v.getCurrentArraySize(),x=p,y=v.executeOrEnqueue(0,w+x,function(){var aa=v.getAllResources(),ba=v.hasReachedEndOfArray();u(aa,ba);}),z=v.getUnavailableResources(y);if(z.length)s({query:t,offset:w,limit:x+1});return y;}}},handleUpdate:function(t){if(t.mercury_payload)m.handleUpdate(t.mercury_payload);var u=t.search_threads||{};for(var v in u){var w=u[v]||[],x=w.map(m.getClientThreadIDNow.bind(m)),y=n.getResource(v);if(y){r(y,x,p+1);}else{y=new k();r(y,x,o+1);n.setResource(v,y);}}},unsubscribe:function(t,u){if(u){var v=n.getResource(u);if(v){v.unsubscribe(t);}else n.unsubscribe(t);}},setInitialCount:function(t){o=t;}};function r(t,u,v){var w=t.getCurrentArraySize(),x=u.length<v;if(!x)u.pop();t.addResourcesWithoutSorting(u,w);if(x)t.setReachedEndOfArray();}function s(t){t.client=h.WEBMESSENGER;if(i.MercuryFBIDGK)t.index='fbid';l.trySend('/ajax/mercury/search_threads.php',t);}l.registerEndpoints({'/ajax/mercury/search_threads.php':{mode:l.IMMEDIATE,handler:q.handleUpdate}});e.exports=q;},null);
__d("MercurySearchThreadsStrategy",["WebMessengerConstants","MercuryLocalThreadResults","MercurySearchThreadResults","copyProperties","createObjectFrom"],function(a,b,c,d,e,f,g,h,i,j,k){var l=null,m=null,n=g.SEARCH_THREAD_DELAY,o={clearTimer:function(){l=null;clearTimeout(m);m=null;},search:function(r,s,t,u){if(r!=l){l=r;clearTimeout(m);m=null;}var v=h.findMatchingThreads(r),w=i.getCachedThreadlist(r);if(w){var x=q(v,w);s(x);t([],i.isExhausted(r));u(null,r);return;}var y=p(r),z=q(v,y.thread_ids);if(y.from_exhausted_remote_results){i.cacheThreadlist(r,z);s(z);t([],true);u(null,r);return;}s(z);m=setTimeout(function(){var aa=i.getThreadlist(r,t);u(aa,r);},n);}};function p(r){var s='',t=[];for(var u=r.length-1;u>0;u--){var v=r.slice(0,u),w=i.getCachedThreadlist(v);if(!w)continue;if(i.isExhausted(v)){return {from_exhausted_remote_results:true,thread_ids:h.findMatchingThreadsFromIds(r,w)};}else if(s.length===0){s=v;t=h.findMatchingThreadsFromIds(r,w);}}return {from_exhausted_remote_results:false,thread_ids:t};}function q(r,s){return Object.keys(j(k(r),k(s)));}e.exports=o;},null);
__d("WebMessengerMasterViewSearchInputControl",["Event","CSS","DOM","Input","Keys","MercurySearchThreadsStrategy","WebMessengerShortcuts","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerSubscriptionsHandler","WebMessengerEvents","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){function t(ba,ca){"use strict";this._manager=ba;this._rootElement=ca;i.empty(this._rootElement);var da=p[':fb:web-messenger:master-view:search-input'].build();i.replace(this._rootElement,da.getRoot());this._searchBox=da.getRoot();this._searchInput=da.getNode('searchInput');this._searchClear=da.getNode('searchClear');this._searchButton=i.find(this._searchBox,'button');this._state=null;this._query=null;this._folder=null;this._threadID=null;this._ariaOwns=this._searchInput.getAttribute('aria-owns');q.addSubscriptions(r.subscribe(r.UPDATE_SELECTION,aa.bind(null,this)),g.listen(this._searchButton,'click',function(){var ea=j.getValue(this._searchInput);if(ea)y(this,ea);}.bind(this)),g.listen(this._searchClear,'click',x.bind(null,this)),g.listen(this._searchInput,'keyup',function(event){var ea=j.getValue(this._searchInput);if(event.keyCode==k.ESC){x(this);}else if(event.keyCode==k.RETURN&&ea){m.openSearchThread();}else if(ea){z(this,ea);}else if(ea!==o.getCurrentStateData().query){x(this);this.focus();}return false;}.bind(this)),g.listen(this._searchInput,'focus',function(ea){this._focused=true;}.bind(this)),g.listen(this._searchInput,'blur',function(ea){this._focused=false;}.bind(this)));}t.prototype.updateView=function(){"use strict";var ba=v(this);u(this);if(ba)w(this);};t.prototype.focusAndSelectSearch=function(){"use strict";y(this,j.getValue(this._searchInput));this._manager.scrollToTop(false);this.focus();this._searchInput.select();};t.prototype.focus=function(){"use strict";setTimeout((function(){if(!this._focused){this._searchInput.focus();this._searchInput.value=this._searchInput.value;}}).bind(this),0);};t.prototype.destroy=function(){"use strict";};function u(ba){var ca=o.getCurrentStateData();ba._state=o.getCurrentMasterState();ba._folder=ca.folder;if(ba._state!=n.MASTER.SEARCH){ba._query=null;}else ba._query=ca.query;}function v(ba){if(!ba._state||!ba._folder)return true;var ca=o.getCurrentMasterState(),da=o.getCurrentStateData();if(ba._folder!=da.folder)return true;if(ca!=ba._state)return true;if(ca==n.MASTER.SEARCH&&ba._query!=da.query)return true;return false;}function w(ba){if(ba._state==n.MASTER.SEARCH){var ca=ba._query||'';if(j.getValue(ba._searchInput)!=ca)j.setValue(ba._searchInput,ca);ba.focus();}else{j.reset(ba._searchInput);ba._searchInput.blur();}h.conditionClass(ba._searchBox,"_47",!j.isEmpty(ba._searchInput));}function x(ba){l.clearTimer();var ca=o.getCurrentStateData();ca.no_uri=true;delete ca.query;o.updateMasterState(n.MASTER.RECENT_THREADS,ca);}function y(ba,ca){var da=o.getCurrentMasterState();if(da!=n.MASTER.SEARCH)ba._threadID=o.getCurrentStateData().thread_id;if(ca)o.updateDetailState(n.DETAIL.SEARCH_SNIPPET,{query:ca,message_query:ca});}function z(ba,ca){var da=o.getCurrentStateData();if(ca!==da.query){var ea=o.getCurrentMasterState();if(ea!=n.MASTER.SEARCH)ba._threadID=da.thread_id;if(ca)o.updateMasterState(n.MASTER.SEARCH,{all_people_query:da.all_people_query,message_query:da.message_query,message_id:da.message_id,query:ca,thread_id:da.thread_id});}}function aa(ba,ca,da){if(i.contains(ba._ariaOwns,da))ba._searchInput.setAttribute('aria-activedescendant',da);}e.exports=t;},null);
__d("MercuryLogger",["JSLogger","MercuryConfig","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f,g,h){var i=b('MercuryServerRequests').get(),j=b('MercuryThreads').get(),k=g.create('messaging_impressions');function l(event,p){k.log(event,p);}function m(p,q){var r=j.getThreadMetaNow(p);if(r){var s=i.getServerThreadIDNow(p);if(s){var event=q?'thread_search':'thread',t={is_single_thread:r.is_canonical_user,is_subscribed:r.is_subscribed,query:q||null};if(h.MercuryFBIDGK){t.thread_fbid=s;}else t.thread_id=s;l(event,t);}k.bump('opened_thread_'+r.folder);}}function n(p,q){var r={};q.forEach(function(s){var t=i.getServerThreadIDNow(s),u=j.getThreadMetaNow(s);if(u&&t){var v={is_single_thread:u.is_canonical_user,folder:u.folder,participants:u.participants,canonical_fbid:u.canonical_fbid};if(h.MercuryFBIDGK){v.thread_fbid=t;}else v.thread_id=t;r[t]=v;}});l('threadlist',{folder:p,threads:r});k.bump('opened_threadlist_'+p);}var o={logThread:function(p){m(p);},logThreadlist:function(p,q){n(p,q);},logThreadFromSearch:function(p,q){m(q,p);},logThreadlistFromSearch:function(p,q){l('threadlist_search',{folder:q,query:p});}};e.exports=o;},null);
__d("WebMessengerThreadlistRenderer",["CSS","DOM","Event","Focus","MercuryListUpdateRenderer","MercuryAPIArgsSource","MessagingTag","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","MercuryThreadMetadataRawRenderer","MercuryThreadMetadataRenderer","Tooltip","WebMessengerMercury","WebMessengerPermalinks","WebMessengerDeleteThreadDialog","cx","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){var y={renderThreadsFromIDs:function(aa,ba,ca,da,ea,fa){da=da||function(ga){return ga;};ea=ea||{};k.updateList(aa,ba.map(da),function(ga){return !ea[ba[ga]]&&ba[ga]!=ca;},function(ga){var ha=ba[ga],ia=p[':fb:web-messenger:threadlist-row'].build();ia.getRoot().setAttribute('id',da(ha));var ja=ia.getNode('threadLink');j.listen(ja,function(ka){g.conditionClass(ia.getRoot(),"_5fes",ka);});i.listen(ja,'click',function(ka){if(ka.getModifiers().any)return true;var la=o.getCurrentMasterState(),ma={thread_id:ha};if(la===n.MASTER.SEARCH)ma.query=o.getCurrentStateData().query;o.updateDetailState(n.DETAIL.RECENT_MESSAGES,ma);return false;});if(ha==ca)g.addClass(ia.getRoot(),"_kv");t.getThreads().getThreadMeta(ha,function(ka){var la=r.getForFBID(o.getCurrentUserID());la.renderCoreThreadlist(ka,ia,z.bind(null,fa),{names_renderer:q.renderShortNames,show_unread_count:false},true);},l.WEBMESSENGER);return ia.getRoot();});}};function z(aa,ba,ca){var da=ba.getNode('readToggler'),ea=ba.getNode('archiveButton'),fa=ba.getNode('deleteButton');ba.getNode('threadLink').setAttribute('href',u.getURI(aa,n.DETAIL.RECENT_MESSAGES,{thread_id:ca.thread_id}).toString());if(ca.unread_count>0){g.addClass(ba.getRoot(),"_kx");h.setContent(ba.getNode('newCount'),h.tx._("{num} new",{num:ca.unread_count}));g.addClass(da,"_ky");s.set(da,"Mark as Read",'above','right');}else{g.addClass(da,"_kz");s.set(da,"Mark as Unread",'above','right');}i.listen(da,'click',function(event){t.getThreads().changeThreadReadStatus(ca.thread_id,g.hasClass(da,"_ky"));return false;});var ga=o.getCurrentStateData().folder;if(ga==m.SPAM){s.set(fa,"Delete Conversation",'above','right');g.addClass(fa,"_4_3q");i.listen(fa,'click',function(event){v.show(ca.thread_id);});g.hide(ea);}else{g.hide(fa);var ha=true;if(ga==m.ACTION_ARCHIVED){ha=false;s.set(ea,"Unarchive",'above','right');g.addClass(ea,"_2s2");}else{s.set(ea,"Archive",'above','right');g.addClass(ea,"_l9");}i.listen(ea,'click',function(event){t.getThreads().changeThreadArchivedStatus(ca.thread_id,ha);var ia=o.getCurrentStateData();if(ia.thread_id==ca.thread_id)o.updateDetailState(n.DETAIL.RECENT_MESSAGES,{folder:ia.folder});return false;});}}e.exports=y;},null);
__d("WebMessengerMasterViewUnseenMessagesNotice",["MessagingTag","WebMessengerStateManager","UserActivity","WebMessengerSubscriptionsHandler","WebMessengerMessagesNotice","WebMessengerConstants","WebMessengerMercury","throttle"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=l.THREADLIST_SCROLLTOP_OFFSET,p=l.MESSAGE_NOTICE_INACTIVITY_THRESHOLD;for(var q in k)if(k.hasOwnProperty(q))s[q]=k[q];var r=k===null?null:k.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=k;function s(x){"use strict";k.call(this);this._manager=x;this._threadInformer=m.getThreadInformer();this._unseenState=m.getUnseenState();j.addSubscriptions(this._threadInformer.subscribe('messages-received',function(y,z){var aa=!i.isActive(p),ba=!this.isScrolledWithinTopThreshold();if(!r.getActive.call(this)||v(z)||!u(z))return;if(r.onlyReceivedFromSelf.call(this,z))return;if(aa){this.removeMessageNotice();this._manager.scrollToTop();}else if(ba)this.showMessageNotice();}.bind(this)),this._threadInformer.subscribe('unseen-updated',t.bind(null,this)));this._manager.addScrollCallback(n.withBlocking(function(y){if(r.getActive.call(this)&&y.getScrollTop()<=l.THREADLIST_TOP_OFFSET&&i.isActive(p)&&w()){this.removeMessageNotice();this._unseenState.markAsSeen();}}.bind(this),100,null));}s.prototype.isScrolledWithinTopThreshold=function(){"use strict";return this._manager.getScrollTop()<=o;};s.prototype.showMessageNotice=function(){"use strict";if(!w())return;var x=function(){this._manager.scrollToTop();}.bind(this);r.showMessageNotice.call(this,x,'below');};function t(x){if(x._unseenState.getUnseenCount()===0)x.removeMessageNotice();}function u(x){for(var y in x)for(var z=0;z<x[y].length;z++)if(x[y][z].folder==g.INBOX)return true;return false;}function v(x){var y=h.getCurrentStateData().thread_id,z=true;for(var aa in x)if(x.hasOwnProperty(aa))if(aa!==y){z=false;break;}return w()&&z;}function w(){var x=h.getCurrentStateData().folder;return x===g.INBOX;}e.exports=s;},null);
__d("WebMessengerMasterViewRecentThreadsControl",["CSS","DOM","Event","MercuryLogger","MercuryAPIArgsSource","MercuryConfig","MercuryFilters","MercuryFolders","MercuryThreadlistConstants","MessagingTag","WebMessengerShortcuts","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerThreadlistRenderer","UserActivity","WebMessengerConstants","WebMessengerEvents","WebMessengerInfoBoxRenderer","WebMessengerSubscriptionsHandler","WebMessengerMasterViewUnseenMessagesNotice","WebMessengerMercury","createObjectFrom","cx","ge","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa){var ga='recent:';function ha(za,ab,bb,cb){"use strict";this._manager=za;this._rootElement=ab;this._infoBox=bb;this._orderedThreadlist=ba.getOrderedThreadlist();this._serverRequests=ba.getServerRequests();this._threadInformer=ba.getThreadInformer();this._threads=ba.getThreads();this._unseenState=ba.getUnseenState();h.empty(this._rootElement);this._pagerExponent=-1;var db=t[':fb:web-messenger:threadlist'].build();h.setContent(this._rootElement,db.getRoot());this._loadingSpinner=db.getNode('loadingSpinner');this._threadlistRows=db.getNode('threadlistRows');this._loadMoreButton=db.getNode('loadMoreButton');this._loadMoreLink=db.getNode('loadMoreLink');this._active=false;this._state=null;this._folder=null;this._filter=null;this._selection=null;this._threadIDs=[];this._unreadThreadIDs=[];this._folders=n.getSupportedFolders();this._filters=m.getSupportedFilters();this._olderTimestamp={};this._currentCountMap={};this._folders.forEach(function(eb){this._currentCountMap[eb]={};this._filters.concat([m.ALL]).forEach(function(fb){this._currentCountMap[eb][fb]=o.WEBMESSENGER_THREAD_COUNT+1;}.bind(this));}.bind(this));this._unseenMessagesNotice=new aa(this._manager);this._unseenMessagesNotice.setNoticeContextNode(cb);z.addSubscriptions(this._threadInformer.subscribe('threadlist-updated',function(eb,fb){ua(this,ca(fb));}.bind(this)),i.listen(this._loadMoreLink,'click',function(){ta(this);}.bind(this)),this._manager.subscribe('scrolledNearBottom',function(){this._active&&ta(this);}.bind(this)));}ha.prototype.updateView=function(){"use strict";this._active=true;this._unseenMessagesNotice.updateView();g.show(this._rootElement);var za=ja(this),ab=ka(this),bb=this._folder,cb=this._selection;la(this);if(ab)ma(this,cb);if(za){sa(this);}else na(this);if(bb!=this._folder)j.logThreadlist(this._folder,this._threadIDs);if(this._selection&&cb!=this._selection)j.logThread(this._selection);};ha.prototype.hideView=function(){"use strict";this._active=false;this._unseenMessagesNotice.hideView();g.hide(this._rootElement);};ha.prototype.destroy=function(){"use strict";ia(this);this._unseenMessagesNotice.destroy();};function ia(za){za._threadlistSubscription&&za._orderedThreadlist.unsubscribe(za._threadlistSubscription.subscriber_id,za._threadlistSubscription.folder,za._threadlistSubscription.filter);za._threadlistSubscription=null;}function ja(za){var ab=s.getCurrentStateData();if((za._folder!=ab.folder)||(za._filter!=ab.filter))return true;return false;}function ka(za){var ab=s.getCurrentStateData();if(za._selection!=ab.thread_id)return true;return false;}function la(za){var ab=s.getCurrentStateData();za._state=s.getCurrentMasterState();if((za._folder!=ab.folder)||(za._filter!=ab.filter))za._pageExponent=-1;za._folder=ab.folder;za._filter=ab.filter;za._selection=ab.thread_id;}function ma(za,ab){var bb=ea(ya(ab));if(bb){g.removeClass(bb,"_kv");bb.removeAttribute('aria-selected');}var cb=ea(ya(za._selection));if(cb){g.addClass(cb,"_kv");cb.setAttribute('aria-selected','true');}x.updateSelection(cb&&cb.id);}function na(za){if(za._active)q.updateThreadlistIndex(za,za._threadIDs.map(ya),ya(za._selection));}function oa(za){g.addClass(za._manager.getFlexAreaElement(),"_3j6");g.addClass(za._manager.getFlexAreaElement(),"_3j7");}function pa(za){g.removeClass(za._manager.getFlexAreaElement(),"_3j6");g.removeClass(za._manager.getFlexAreaElement(),"_3j7");}function qa(za){g.hide(za._threadlistRows);pa(za);}function ra(za){if(za._threadIDs.length){g.show(za._threadlistRows);pa(za);}else{g.hide(za._threadlistRows);oa(za);}}function sa(za){g.show(za._loadingSpinner);g.hide(za._infoBox);qa(za);g.hide(za._loadMoreButton);ia(za);var ab=za._orderedThreadlist.getFilteredThreadlist(o.RECENT_THREAD_OFFSET,za._currentCountMap[za._folder][za._filter],za._folder,za._filter,function(bb,cb){g.hide(za._loadingSpinner);va(za,bb,cb);ra(za);na(za);za._manager.poke();za._manager.forceFireScrollCallbacks();},null,k.WEBMESSENGER);if(ab)za._threadlistSubscription={subscriber_id:ab,folder:za._folder,filter:za._filter};}function ta(za){if(za._requestInFlight||g.hasClass(za._loadMoreButton,'hidden_elem'))return;za._requestInFlight=true;g.addClass(za._loadMoreButton,'async_saving');za._pagerExponent=Math.min(za._pagerExponent+1,w.EXPONENTIAL_PAGER_MAX_CYCLES);var ab=Math.pow(2,za._pagerExponent),bb=za._currentCountMap[za._folder][za._filter]+ab*(o.WEBMESSENGER_MORE_COUNT);ia(za);var cb=za._orderedThreadlist.getFilteredThreadlist(o.RECENT_THREAD_OFFSET,bb,za._folder,za._filter,function(db,eb){g.removeClass(za._loadMoreButton,'async_saving');za._currentCountMap[za._folder][za._filter]=bb;va(za,db,eb);na(za);za._manager.poke();za._requestInFlight=false;},null,k.WEBMESSENGER);if(cb)za._threadlistSubscription={subscriber_id:cb,folder:za._folder,filter:za._filter};}function ua(za,ab){if(!za._folder||!za._olderTimestamp[za._folder])return;var bb=za._orderedThreadlist.getThreadlistUntilTimestamp(za._olderTimestamp[za._folder],za._folder,za._filter);if(za._filter==p.UNREAD){bb=xa(za,bb);}else za._unreadThreadIDs=[];if(bb.length>za._currentCountMap[za._folder][za._filter])za._currentCountMap[za._folder][za._filter]=bb.length;za._threadIDs=bb;ra(za);u.renderThreadsFromIDs(za._threadlistRows,bb,za._selection,ya,ab,r.MASTER.RECENT_THREADS);na(za);za._manager.poke();}function va(za,ab,bb){var cb=(ab.length==za._currentCountMap[za._folder][za._filter]);if(cb)ab.pop();if(ab.length){var db=ab[ab.length-1];za._threads.getThreadMeta(db,function(eb){za._olderTimestamp[za._folder]=eb.timestamp;},k.WEBMESSENGER);}if(za._filter==p.UNREAD){za._unreadThreadIDs=ab;}else za.unreadThreadIDs=[];g.conditionShow(za._loadMoreButton,cb);za._threadIDs=ab;u.renderThreadsFromIDs(za._threadlistRows,ab,za._selection,ya,null,r.MASTER.RECENT_THREADS);bb=bb&&ab.length===0;bb&&wa(za);g.conditionShow(za._infoBox,bb);}function wa(za){if(za._builtErrorMessage)return;h.setContent(za._infoBox,y.render("Could Not Load Conversations",[{text:"Try Again",handler:sa.bind(null,za)}]));za._builtErrorMessage=true;}function xa(za,ab){ab.forEach(function(bb){if(za._unreadThreadIDs.indexOf(bb)<0)za._unreadThreadIDs.push(bb);});za._unreadThreadIDs.sort(function(bb,cb){var db=za._threads.getThreadMetaNow(bb).timestamp,eb=za._threads.getThreadMetaNow(cb).timestamp;return eb-db;});za._unreadThreadIDs=za._unreadThreadIDs.filter(function(bb){var cb=za._threads.getThreadMetaNow(bb);return n.getFromMeta(cb)==za._folder;});return za._unreadThreadIDs;}function ya(za){if(za)return ga+za;return null;}e.exports=ha;},null);
__d("MercurySearchThreadResultOrderer",["MessagingTag","createObjectFrom","MercuryThreads"],function(a,b,c,d,e,f,g,h){var i=b('MercuryThreads').get(),j={separateCanonicalThreadsInFolder:function(p,q){var r=[],s=[];p.forEach(function(t){var u=i.getThreadMetaNow(t);if(u.folder===q&&u.is_canonical){r.push(t);}else s.push(t);});return {canonical_in_folder:r.sort(l),remaining:s};},orderResults:function(p,q,r,s){var t=o(q,r),u=t.sort(k.bind(null,s));return o(p,u);}};function k(p,q,r){var s=i.getThreadMetaNow(q),t=i.getThreadMetaNow(r),u=m(s),v=m(t);if(u!==v)return n(u,p)>n(v,p)?-1:1;if(s.is_canonical!==t.is_canonical)return s.is_canonical?-1:1;return l(q,r);}function l(p,q){var r=i.getThreadMetaNow(p),s=i.getThreadMetaNow(q);return r.timestamp>s.timestamp?-1:1;}function m(p){return p.is_archived?g.ACTION_ARCHIVED:p.folder;}function n(p,q){if(p===q)return 5;var r={};r[g.INBOX]=4;r[g.ACTION_ARCHIVED]=3;r[g.OTHER]=2;r[g.SPAM]=1;return r[p];}function o(p,q){var r=h(p),s=q.filter(function(t){return !(t in r);});return p.concat(s);}e.exports=j;},null);
__d("WebMessengerMasterViewSearchThreadsControl",["Event","CSS","DOM","MercuryFolders","MercuryLogger","MercurySearchThreadResultOrderer","MercurySearchThreadResults","MercurySearchThreadsStrategy","WebMessengerShortcuts","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerTemplates","WebMessengerThreadlistRenderer","WebMessengerEvents","WebMessengerMercury","WebMessengerSubscriptionsHandler","createObjectFrom","csx","cx","ge","getElementText"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){var ba='search:',ca='search-indicator';function da(za,ab,bb,cb){"use strict";this._manager=za;this._rootElement=ab;this._noMessagesIndicator=cb;this._orderedThreadlist=u.getOrderedThreadlist();this._threadInformer=u.getThreadInformer();this._threads=u.getThreads();i.empty(this._rootElement);var db=r[':fb:web-messenger:thread-search'].build();i.setContent(this._rootElement,db.getRoot());this._loadingSpinner=db.getNode('loadingSpinner');this._threadlistRows=db.getNode('threadlistRows');this._loadMoreButton=db.getNode('loadMoreButton');this._loadMoreLink=db.getNode('loadMoreLink');var eb=r[':fb:web-messenger:master-view-snippets-link'].build();this._threadSearchResultDescription=eb.getNode('threadSearchResultDescription');this._searchMessagesIndicator=eb.getRoot();this._searchMessagesIndicator.setAttribute('id',ba+ca);i.replace(bb,this._searchMessagesIndicator);this._snippetSearchLink=eb.getNode('snippetSearchLink');this._snippetSearchLinkText=eb.getNode('snippetSearchLinkText');this._active=false;this._detailState=null;this._query=null;this._folder=null;this._selection=null;this._keyboardSelection=null;this._threadIDs=[];this._oldestTimestamps=fa(this);this._namesChangedSinceLastRedraw=false;this._remoteResultsCompleted=true;v.addSubscriptions(this._threadInformer.subscribe('threadlist-updated',function(fb,gb){ra(this,w(gb));}.bind(this)),this._threadInformer.subscribe('messages-received',function(){this._namesChangedSinceLastRedraw=true;}.bind(this)),g.listen(this._loadMoreLink,'click',function(){qa(this);}.bind(this)),g.listen(this._snippetSearchLink,'click',function(){this.updateKeyboardSelection(ca);ya(this);}.bind(this)));}da.prototype.updateView=function(){"use strict";this._active=true;h.show(this._rootElement);h.hide(this._loadingSpinner);var za=ga(this),ab=ha(this),bb=this._folder,cb=this._query,db=this._selection;ia(this);if(ab||za){var eb=this._keyboardSelection;switch(this._detailState){case p.DETAIL.RECENT_MESSAGES:this._keyboardSelection=this._selection;break;case p.DETAIL.SEARCH_SNIPPET:case p.DETAIL.SEARCH_CONTEXT:this._keyboardSelection=ca;}ja(this,eb);}if(za){oa(this);}else{ka(this,false);pa(this);}if(cb!=this._query||bb!=this._folder)k.logThreadlistFromSearch(this._query,this._folder);if(this._selection&&db!=this._selection)k.logThreadFromSearch(this._query,this._selection);};da.prototype.hideView=function(){"use strict";this._active=false;h.hide(this._rootElement);sa(this,false);pa(this);};da.prototype.openSearchThread=function(za){"use strict";if(za==ca){ya(this);}else q.updateDetailState(p.DETAIL.RECENT_MESSAGES,{query:this._query,thread_id:za});};da.prototype.updateKeyboardSelection=function(za){"use strict";var ab=this._keyboardSelection;this._keyboardSelection=za;ja(this,ab);};da.prototype.destroy=function(){"use strict";ea(this);};function ea(za){za._searchThreadsSubscription&&m.unsubscribe(za._searchThreadsSubscription.subscriber_id,za._searchThreadsSubscription.query);za._searchThreadsSubscription=null;}function fa(za){var ab={};j.getSupportedFolders().forEach(function(bb){var cb=za._orderedThreadlist.getThreadlistUntilTimestamp(0,bb);ab[bb]=cb.length>0?za._threads.getThreadMetaNow(cb[cb.length-1]).timestamp:Infinity;}.bind(this));return ab;}function ga(za){var ab=za._namesChangedSinceLastRedraw;za._namesChangedSinceLastRedraw=false;if(ab)return true;if(!za._remoteResultsCompleted)return true;var bb=fa(za),cb=za._oldestTimestamps;za._oldestTimestamps=bb;var db=q.getCurrentStateData();if(za._query!==db.query||za._folder!==db.folder)return true;for(var eb in cb)if(cb[eb]>bb[eb])return true;return false;}function ha(za){var ab=q.getCurrentStateData();if(za._selection!=ab.thread_id)return true;return false;}function ia(za){var ab=q.getCurrentStateData();za._detailState=q.getCurrentDetailState();za._query=ab.query;za._folder=ab.folder;za._selection=ab.thread_id;}function ja(za,ab){var bb=z(wa(ab));if(bb){h.removeClass(bb,"_kv");bb.removeAttribute('aria-selected');}var cb=z(wa(za._keyboardSelection));if(cb){h.addClass(cb,"_kv");cb.setAttribute('aria-selected',true);}t.updateSelection(cb&&cb.id);}function ka(za,ab){if(za._keyboardSelection&&za._keyboardSelection!=ca&&za._threadIDs.indexOf(za._keyboardSelection)<0)za._keyboardSelection=null;if(!za._keyboardSelection)if(za._threadIDs.length){za._keyboardSelection=za._threadIDs[0];}else if(!ab){za._keyboardSelection=ca;ja(za);}var bb=za._threadIDs.slice(0);bb.push(ca);if(za._active)o.updateThreadlistIndex(za,bb.map(wa),wa(za._keyboardSelection));}function la(za){var ab=i.scry(za._threadlistRows,"._l5");ab.filter(function(bb){return aa(bb)!==q.getCurrentStateData().folder;}).forEach(h.show.bind(h));}function ma(za){var ab=i.scry(za._threadlistRows,"._l5");ab.forEach(h.hide.bind(h));}function na(za){la(za);za._manager.draw();}function oa(za){h.show(za._loadingSpinner);sa(za,false);h.hide(za._threadlistRows);h.hide(za._loadMoreButton);ma(za);ea(za);if(za._query){var ab=[],bb=[];za._remoteResultsCompleted=false;n.search(za._query,function(cb){var db=l.separateCanonicalThreadsInFolder(cb,q.getCurrentStateData().folder);ab=db.canonical_in_folder;bb=db.remaining;xa(za);h.show(za._threadlistRows);ua(za,ab);na(za);},function(cb,db){za._remoteResultsCompleted=true;var eb=l.orderResults(ab,bb,cb,q.getCurrentStateData().folder);if(eb.length>0){h.conditionShow(za._loadMoreButton,!db);va(za,eb);}else ta(za);h.hide(za._loadingSpinner);na(za);},function(cb,db){if(cb)za._searchThreadsSubscription={subscriber_id:cb,query:db};});}else{n.clearTimer();h.hide(za._loadingSpinner);i.empty(za._threadlistRows);h.show(za._threadlistRows);za._threadIDs=[];}pa(za);}function pa(za){var ab=!!za._query&&za._active,bb=ab^h.shown(za._searchMessagesIndicator);h.conditionShow(za._searchMessagesIndicator,ab);za._manager.sizeToFit(ab);bb&&za._manager.draw();}function qa(za){ea(za);h.addClass(za._loadMoreButton,'async_saving');var ab=m.getMoreThreadlist(za._query,function(bb,cb){h.removeClass(za._loadMoreButton,'async_saving');h.conditionShow(za._loadMoreButton,!cb);va(za,bb);za._manager.poke();});if(ab)za._searchThreadsSubscription={subscriber_id:ab,query:za._query};}function ra(za,ab){if(za._threadIDs.length){s.renderThreadsFromIDs(za._threadlistRows,za._threadIDs,za._keyboardSelection,wa,ab,p.MASTER.SEARCH);za._manager.poke();}}function sa(za,ab){ab=ab&&za._active;h.conditionClass(za._searchMessagesIndicator,"_33x",ab!==false);h.conditionShow(za._noMessagesIndicator,ab!==false);}function ta(za){za._threadIDs=[];ka(za,false);var ab=i.tx._("No people or conversations named {query}",{query:za._query}),bb=i.create('div',{},ab);i.setContent(za._noMessagesIndicator,bb);sa(za,true);}function ua(za,ab){va(za,ab,true);}function va(za,ab,bb){za._threadIDs=ab;ka(za,bb);s.renderThreadsFromIDs(za._threadlistRows,ab,za._keyboardSelection,wa,null,p.MASTER.SEARCH);t.updateSelection(za._keyboardSelection);if(za._keyboardSelection==ca)ja(za);}function wa(za){if(za)return ba+za;return null;}function xa(za){var ab=i.tx._("Showing results for name: {query}",{query:za._query});i.setContent(za._threadSearchResultDescription,ab);}function ya(za){if(za._query){q.updateDetailState(p.DETAIL.SEARCH_SNIPPET,{query:za._query,message_query:za._query});t.focusSearch();}}e.exports=da;},null);
__d("WebMessengerMasterViewControlManager",["ArbiterMixin","DOM","WebMessengerFlexibleScrollArea","WebMessengerMasterViewTabBarControl","WebMessengerMasterViewSearchInputControl","WebMessengerMasterViewRecentThreadsControl","WebMessengerMasterViewSearchThreadsControl","WebMessengerStateManager","WebMessengerStateConstants","Style","WebMessengerTemplates","WebMessengerEvents","WebMessengerSubscriptionsHandler","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){var u=t(g);for(var v in u)if(u.hasOwnProperty(v))x[v]=u[v];var w=u===null?null:u.prototype;x.prototype=Object.create(w);x.prototype.constructor=x;x.__superConstructor__=u;function x(y){"use strict";this._rootElement=y;h.empty(this._rootElement);var z=q[':fb:web-messenger:master-view'].build();h.setContent(this._rootElement,z.getRoot());this._tabBarControl=new j(this,z.getNode('masterViewTabBar'),z.getNode('masterViewTopContent'));this._searchInputControl=new k(this,z.getNode('masterViewSearchInput'));this._searchThreadsControl=new m(this,z.getNode('masterViewSearchThreads'),z.getNode('searchMessagesIndicator'),z.getNode('noMessages'));this._threadlistRowsWrapper=z.getNode('threadlistRowsWrapper');this._flexArea&&this._flexArea.destroy();var aa={fade:true,persistent:true};this._flexArea=new i(this._threadlistRowsWrapper,aa).setInfiniteScrollHandler(this.inform.bind(this,'scrolledNearBottom')).setContainer(this._rootElement).setMinFlexAreaHeight(40).draw();this._recentThreadsControl=new l(this,z.getNode('masterViewRecentThreads'),z.getNode('masterInfoBox'),z.getNode('masterViewTabBar'));s.addSubscriptions(r.subscribe(r.FOCUS_AND_SELECT_SEARCH,this._searchInputControl.focusAndSelectSearch.bind(this._searchInputControl)),r.subscribe(r.FOCUS_SEARCH,this._searchInputControl.focus.bind(this._searchInputControl)),r.subscribe(r.MASTER_DOM_CHANGED,function(){this._tabBarControl.updateView();this._flexArea&&this._flexArea.draw();}.bind(this)),n.subscribe(o.STATE_CHANGE_EVENT,this.updateOnStateChange.bind(this)));this._resizeNodes=[this._rootElement,this._threadlistRowsWrapper,h.find(this._threadlistRowsWrapper,'div.uiScrollableAreaBody')];}x.prototype.updateOnStateChange=function(){"use strict";var y=n.getCurrentMasterState();this._tabBarControl.updateView();this._searchInputControl.updateView();switch(y){case o.MASTER.RECENT_THREADS:this._searchThreadsControl.hideView();this._recentThreadsControl.updateView();break;case o.MASTER.SEARCH:this._recentThreadsControl.hideView();this._searchThreadsControl.updateView();break;}};x.prototype.scrollIntoView=function(y,z){"use strict";this._flexArea&&this._flexArea.scrollIntoView(y,z);};x.prototype.scrollToBottom=function(y){"use strict";this._flexArea&&this._flexArea.scrollToBottom(y);};x.prototype.scrollToTop=function(y){"use strict";this._flexArea&&this._flexArea.scrollToTop(y);};x.prototype.isScrolledToTop=function(){"use strict";return this._flexArea&&this._flexArea.isScrolledToTop();};x.prototype.getScrollTop=function(){"use strict";return this._flexArea.getScrollableArea().getScrollTop();};x.prototype.draw=function(){"use strict";this._flexArea&&this._flexArea.draw();};x.prototype.poke=function(){"use strict";this._flexArea&&this._flexArea.poke();};x.prototype.sizeToFit=function(y){"use strict";this._flexArea&&this._flexArea.setSizeToFit(y);};x.prototype.addScrollCallback=function(y){"use strict";this._flexArea&&this._flexArea.addScrollCallback(y);};x.prototype.forceFireScrollCallbacks=function(){"use strict";this._flexArea&&this._flexArea._onScroll();};x.prototype.getFlexAreaElement=function(){"use strict";return this._flexArea.flexArea;};x.prototype.resizeTo=function(y){"use strict";this._resizeNodes.forEach(function(z){p.set(z,'width',y+'px');});r.masterDOMChanged();};x.prototype.destroy=function(){"use strict";this._tabBarControl.destroy();this._recentThreadsControl.destroy();this._searchThreadsControl.destroy();this._flexArea.destroy();};e.exports=x;},null);
__d("WebMessengerPageTitleRenderer",["DocumentTitle","MercuryAPIArgsSource","MercuryParticipants","WebMessengerStateConstants","WebMessengerStateManager","tx","MercuryThreadMetadataRenderer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=b('MercuryThreadMetadataRenderer').get(),n=b('MercuryThreads').get(),o={updateTitleForState:function(r,s,t){this.withTitleForState(r,s,t||function(u){var v=k.getCurrentDetailState(),w=k.getCurrentStateData();if(r===v&&s===w)g.set(u);});},withTitleForState:function(r,s,t){switch(r){case j.DETAIL.RECENT_MESSAGES:p(s.thread_id,t);break;default:q(t);break;}}};function p(r,s){if(!r){q(s);return;}n.getThreadMeta(r,function(t){if(t.name){s(l._("{conversation_name} - Messages",{conversation_name:t.name}));return;}i.getMulti(t.participants,function(u){var v=[];for(var w in u)if(u.hasOwnProperty(w))v.push(u[w]);var x=m.renderParticipantList(r,v,u[i.user]?t.participants.length-1:t.participants.length,{abbr_mode:true,last_separator_uses_and:true,names_renderer:function(y){var z=[];if(y.length===1&&y[0].id===i.user){z.push(y[0].name);}else for(var aa=0;aa<y.length;aa++)if(y[aa].id!==i.user)z.push(y[aa].name);return z;}});s(l._("{conversation_name} - Messages",{conversation_name:x}));});},h.WEBMESSENGER);}function q(r){r("Messages");}e.exports=o;},null);
__d("WebMessengerPageTitleControl",["WebMessengerPageTitleRenderer","WebMessengerStateManager","WebMessengerStateConstants","WebMessengerSubscriptionsHandler","WebMessengerEvents"],function(a,b,c,d,e,f,g,h,i,j,k){var l=function(){var m=function(){g.updateTitleForState(h.getCurrentDetailState(),h.getCurrentStateData());};j.addSubscriptions(h.subscribe(i.STATE_CHANGE_EVENT,m),k.subscribe(k.DETAIL_DOM_CHANGED,m));};e.exports=l;},null);
__d("WebMessengerThreadMessagesAgent",["MercuryAPIArgsSource","MessagingTag","WebMessengerConstants","MercuryMessages","MercuryOrderedThreadlist","MercuryThreadInformer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i){var j=b('MercuryMessages').get(),k=b('MercuryOrderedThreadlist').get(),l=b('MercuryThreadInformer').get(),m=b('MercuryThreads').get(),n=21,o=false,p='n_inbox_n_unreads',q=i.THREADLIST_MAX_READ_PRELOAD_NUM,r=i.THREADLIST_MAX_UNREAD_PRELOAD_NUM;function s(){"use strict";this._active=true;this._iterative=o;this._strategy=p;this._requestInFlight=false;this._requestIsQueued=false;this._pendingThreadIds={};this._processedThreadIds={};this._threadInformerSubscriptions=[];this._threadInformerSubscriptions.push(l.subscribe('threadlist-updated',t.bind(null,this)));}s.prototype.turnOn=function(){"use strict";this._active=true;};s.prototype.turnOff=function(){"use strict";this._active=false;};s.prototype.destroy=function(){"use strict";this._threadInformerSubscriptions.forEach(l.unsubscribe);this._threadInformerSubscriptions=[];};function t(w){if(w._active&&!w._requestIsQueued){if(w._requestInFlight){w._requestIsQueued=true;return;}var x=u(w);if(x.length){w._requestInFlight=true;if(x.length>n){x=x.slice(0,n);w._requestIsQueued=true;}}x.forEach(function(y){w._processedThreadIds[y]=true;w._pendingThreadIds[y]=true;j.getThreadMessagesRange(y,0,i.INITIAL_MESSAGES_LIMIT+1,function(){v(w,y);},null,g.WEBMESSENGER);});}}function u(w){var x=k.getThreadlistUntilTimestamp(0,h.INBOX),y=x.filter(function(da){return !w._processedThreadIds[da]&&!j.hasLoadedNMessages(da,i.INITIAL_MESSAGES_LIMIT+1);});if(w._strategy===p){var z=[],aa=[];for(var ba=0;ba<y.length;ba++){var ca=m.getThreadMetaNow(y[ba]);if(ca){if(ca.unread_count&&aa.length<r)aa.push(y[ba]);if(!ca.unread_count&&z.length<q)z.push(y[ba]);if(aa.length>=r&&z.length>=q)break;}}y=z.concat(aa);}return y;}function v(w,x){if(w._pendingThreadIds[x])delete w._pendingThreadIds[x];if(Object.keys(w._pendingThreadIds).length===0){if(!w._iterative)w._active=false;w._requestInFlight=false;if(w._requestIsQueued){w._requestIsQueued=false;t(w);}}}e.exports=s;},null);
__d("WebMessengerAdsControl",["AdsMouseStateStore","Animation","Arbiter","CSS","CurrentUser","DOM","EgoAdsObjectSet","Event","KeyedCallbackManager","MercuryParticipants","UIPagelet","URI","UserActivity","Vector","WebMessengerAdsConfig","WebMessengerStateManager","cx","shield","WebMessengerSubscriptionsHandler","copyProperties","cx","csx","throttle","WebMessengerConstants","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,w,aa,ba,ca){var da=b('MercuryThreads').get(),ea=600,fa=ca.ADS_ROTATION_INTERVAL_PASSIVE,ga=ca.ADS_ROTATION_THRESHOLD_ACTIVE,ha=ca.MAX_ADS,ia=2,ja=165,ka=g.STATES,la='data-height',ma=new o(),na='webMessengerAdsStage',oa=0,pa={};function qa(){}z(qa,{init:function(){this._ads=new m();this._initializedAds=false;this._loadingCount=null;this._stage=null;this._drawCount=0;this._lastRefresh=0;this._pageletInProgress=null;this._lastMousedOnAds=false;this._waitOn(['codes','container','sidebar','footer'],this.start.bind(this));y.addSubscriptions(s.subscribe(x(this._refreshIfReady,this)),i.subscribe('footerLoaded',function(){ma.setResource('footer',1);}),i.subscribe(['sidebar/initialized','sidebar/show','sidebar/hide'],this._sideBarChanged.bind(this)),ma);return this;},setContainer:function(xa){ma.setResource('container',xa);this._container=xa;},setTrackingCodes:function(xa){ma.setResource('codes',xa);},getTrackingCodes:function(){return ma.getResource('codes');},updateRhcID:function(){var xa=l.scry(this._container,'div.ego_section')[0];if(!xa)return;g.updateRhcID(l.getID(xa));},start:function(){this._stage=l.create('div',{id:na,className:"_2rn"});this._ego=l.find(this._container,"._81");l.insertAfter(this._ego,this._stage);this.updateRhcID();this._updateFooterHeight();this.waitForAdsLoad(this._container,this._processOnPageUnits.bind(this));y.addSubscriptions(n.listen(window,'resize',ba(this.draw,100,this)),n.listen(this._ego,'mouseenter',x(this._mouseEvent,this,true)),n.listen(this._ego,'mouseleave',x(this._mouseEvent,this,false)));},stateChanged:function(xa,ya){xa=xa||{};ya=ya||{};if(xa.thread_id&&ya.thread_id&&ya.thread_id!==xa.thread_id)this._refreshIfReady(true);},draw:function(){var xa=this._loadingCount<=0;if(!this._initializedAds||!this._drawCount&&!xa)return;this._adjustAdsToFit();},_processOnPageUnits:function(){this._ads.init(va(this._ego));this._initializedAds=true;this._adjustAdsToFit();},_processStagedUnits:function(){this._pageletInProgress=false;var xa=va(this._stage);if(!this._lastMousedOnAds&&xa.length&&!this._focusedOnAds()){l.empty(this._ego);while(this._stage.childNodes.length)l.appendContent(this._ego,this._stage.firstChild);this._ads.init(xa);this._lastRefresh=Date.now();this._adjustAdsToFit();}},waitForAdsLoad:function(xa,ya){var za=va(xa);this._loadingCount=za.length;if(!this._loadingCount){this._lastRefresh=Date.now()-fa/2;this._pageletInProgress=false;return;}var ab=function(bb){ua(bb);if(--this._loadingCount<=0)ya();}.bind(this);za.forEach(function(bb){function cb(){setTimeout(ab.bind(null,bb),0);}var db=l.scry(bb,'img.img')[0];if(!db||db.complete){cb();}else n.listen(db,{load:cb,error:cb,abort:cb});}.bind(this));},_adjustAdsToFit:function(){this._drawCount++;var xa=t.getViewportDimensions().y,ya=xa-this._footerHeight-ja,za=ya,ab=0;while(za>0&&ab<this._ads.getCount()){za-=ta(this._ads.getUnit(ab));if(za>=0)ab++;}ab=Math.max(ab,ia);for(var bb=0;bb<this._ads.getCount();bb++)sa(this._ads.getUnit(bb),bb>=ab);j.conditionShow(this._ego,ab);j.addClass(this._ads.getUnit(0),'ego_unit_no_top_border');var cb=l.scry(this._container,'.ego_section');cb.forEach(function(db){ra(db,l.scry(db,'[data-onscreen]').length);});ra(this._container,true);this._registerImpressions(ab);this._registerHoldoutImpressions(ya);i.inform('WebMessengerAdsControl/adjustAds');},_waitOn:function(xa,ya){ma.executeOrEnqueue(xa,ya);},_mouseEvent:function(xa){this._lastMousedOnAds=xa;},intentShown:function(){if(!u.stateRefresh)return false;var xa=g.getState();switch(xa){case ka.STATIONARY:return !u.refreshOnStationary;case ka.INTENT:case ka.HOVER:return true;default:return false;}},_focusedOnAds:function(){return l.contains(this._container,document.activeElement);},_refreshIfReady:function(xa){var ya=xa?ga:fa;if(this._lastRefresh===0){this._lastRefresh=Date.now();return;}else if(this._pageletInProgress||!this._drawCount||this._lastMousedOnAds||this._focusedOnAds()||this.intentShown()||this._lastRefresh+ya>Date.now())return;ma.reset();this._waitOn(['codes'],this.waitForAdsLoad.bind(this,this._stage,this._processStagedUnits.bind(this)));this._pageletInProgress=q.loadFromEndpoint('WebEgoPane',na,{pid:43,data:[k.getID(),ha,++oa,wa()]},{crossPage:true,bundle:false,handler:this.onLoadHandler.bind(this)});},onLoadHandler:function(){if(!u.fade)return;(new h(this._container)).from('opacity',0).to('opacity',1).duration(ea).go();},_updateFooterHeight:function(){j.hide(this._ego);this._footerHeight=t.getElementDimensions(this._container).y;j.show(this._ego);},_registerImpression:function(xa){var ya=this.getTrackingCodes();if(!ya||!ya[xa])return null;var za=l.create('iframe',{src:r('/ai.php').addQueryData({aed:ya[xa]}),width:0,height:0,frameborder:0,scrolling:'no',className:'fbEmuTracking'});za.setAttribute('aria-hidden','true');l.appendContent(this._container,za);return za;},_registerImpressions:function(xa){var ya=this.getTrackingCodes(),za=pa;pa={};for(var ab=0;ab<xa;ab++){if(!this._ads.getUnit(ab))continue;var bb=l.scry(this._ads.getUnit(ab),"div._4u8");if(!bb.length)continue;var cb=bb[0].getAttribute('data-ad'),db=JSON.parse(cb).adid;if(db in za){pa[db]=za[db];delete za[db];}else{if(!ya||!ya[db])continue;var eb=this._registerImpression(db);delete ya[db];if(eb)pa[db]=eb;}}for(db in za)l.remove(za[db]);},_registerHoldoutImpressions:function(xa){var ya=this._ads.getHoldoutAdIDsForSpace(xa,ta);if(ya)ya.forEach(this._registerImpression.bind(this));},_sideBarChanged:function(xa,ya){if(xa=='sidebar/initialized')ma.setResource('sidebar',1);this._initializedAds&&this.draw();}});function ra(xa,ya){j.conditionClass(xa,"_2rn",!ya);}function sa(xa,ya){j.conditionClass(xa,"_22r",ya);xa.setAttribute('aria-hidden',ya?'true':'false');if(ya){xa.removeAttribute('data-onscreen');}else xa.setAttribute('data-onscreen','1');}function ta(xa){if(!xa)return 0;var ya=xa.getAttribute(la)||ua(xa);return parseInt(ya,10);}function ua(xa){var ya=t.getElementDimensions(xa).y;xa.setAttribute(la,ya);return ya;}function va(xa){return l.scry(xa,'div.ego_unit');}function wa(){var xa=v.getCurrentStateData();if(xa.thread_id){var ya=da.getThreadMetaNow(xa.thread_id);if(ya)return ya.participants.map(p.getUserID).filter(function(za){return za&&za!=k.getID();});}return [];}e.exports=qa;},null);
__d("WebMessengerApp",["Arbiter","WebMessengerDetailViewControlManager","DOM","WebMessengerMasterViewControlManager","WebMessengerPageTitleControl","PageTransitions","WebMessengerPermalinks","WebMessengerShortcuts","SnowflakePermalinkUtils","WebMessengerStateConstants","WebMessengerStateManager","WebMessengerStateStore","WebMessengerThreadMessagesAgent","URI","WebMessengerAdsControl","emptyFunction","WebMessengerSubscriptionsHandler","WebMessengerWidthControl","clickRefAction","userAction","WebMessengerTemplates","MercuryServerRequests","MercuryThreadInformer","MercuryStateCheck"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){var ba=b('MercuryServerRequests').get(),ca=b('MercuryThreadInformer').get();b('MercuryStateCheck');d(['VideoCallCore'],v);var da,ea;function fa(la,ma){var na=ma&&ma.getQueryData().hasOwnProperty('theater'),oa=ma&&o.isPermalinkURI(ma);if(na){da=g.subscribe('PhotoSnowlift.CLOSE',ga.bind(null,la),g.SUBSCRIBE_NEW);return false;}else if(oa){ea=g.subscribe('PhotoSnowflake.CLOSE',ga.bind(null,la),g.SUBSCRIBE_NEW);return false;}var pa=m.processURI(ma);if(pa){var qa=q.getCurrentStateData();if(pa.redirect){m.goNextURI(pa.master_state,pa.detail_state,pa.data,pa.replace);}else q.updateStateOnURI(pa.master_state,pa.detail_state,pa.data);l.transitionComplete();la._adsControl.stateChanged(qa,q.getCurrentStateData());return true;}ka(la);return false;}function ga(la){l.registerHandler(fa.bind(null,la),6);if(da){da.unsubscribe();da=null;}if(ea){ea.unsubscribe();ea=null;}}function ha(){var la=q.getCurrentStateData();r.setLastSeen(la.folder,la.thread_id);}function ia(la,ma,na,oa,pa){w.engage();ga(this);g.inform('chat/set_does_page_occlude_tabs',true,g.BEHAVIOR_PERSISTENT);g.inform('chat/set_show_tab_unread_ui',false,g.BEHAVIOR_PERSISTENT);new s();ba.handleUpdate(ma);i.empty(la);var qa=aa[':fb:web-messenger:page-skeleton'].build();i.setContent(la,qa.getRoot());n.registerGeneralShortcuts();this._masterViewManager=new j(qa.getNode('masterView'));this._detailViewManager=new h(qa.getNode('detailView'));this._pageTitleControl=new k();oa&&i.prependContent(qa.getRoot(),oa);this._widthControl=new x(this._masterViewManager.resizeTo.bind(this._masterViewManager),this._detailViewManager.resizeTo.bind(this._detailViewManager),pa);this._adsControl=u.init();var ra=na?new t(na):m.getDefaultURI();fa(this,ra);y('web_messenger').set_namespace('web_messenger');z('web_messenger').uai('load').add_event('tti',0,window._cstart);w.addSubscriptions(ca.subscribe('threads-deleted',function(sa,ta){var ua=q.getCurrentStateData().thread_id,va=q.getCurrentDetailState();if(va==p.DETAIL.RECENT_MESSAGES&&ta[ua]){q.updateDetailState(p.DETAIL.RECENT_MESSAGES,{thread_id:null});}else ha();}),q.subscribe(p.STATE_CHANGE_EVENT,ha));d(['MercuryBrowserAlerts'],function(sa){w.addSubscriptions(ca.subscribe('messages-received',function(ta,ua){for(var va in ua){var wa=ua[va];for(var xa=0;xa<wa.length;xa++)sa.messageReceived(wa[xa]);}}));sa.subscribe('before-alert',function(ta,event){if(event.threadID==ja())event.cancelAlert();});});}function ja(){var la=q.getCurrentDetailState(),ma=q.getCurrentStateData();if(la==p.DETAIL.RECENT_MESSAGES||la==p.DETAIL.SEARCH_CONTEXT)return ma.thread_id;return null;}function ka(la){var ma=true;d(['ChatTabModel'],function(na){ma&&na.persistLocalRaised();});w.release();g.inform('chat/set_does_page_occlude_tabs',false,g.BEHAVIOR_PERSISTENT);g.inform('chat/set_show_tab_unread_ui',true,g.BEHAVIOR_PERSISTENT);la._masterViewManager.destroy();la._detailViewManager.destroy();ma=false;}e.exports=ia;},null);
__d("WebMessengerComposerDataSource",["MercuryConstants","ExpandableDataSource","MercuryConfig","MercuryIDs","WebMessengerStateManager"],function(a,b,c,d,e,f,g,h,i,j,k){for(var l in h)if(h.hasOwnProperty(l))n[l]=h[l];var m=h===null?null:h.prototype;n.prototype=Object.create(m);n.prototype.constructor=n;n.__superConstructor__=h;function n(r){"use strict";r=r||{};r.kanaNormalization=true;h.call(this,r,g.MercuryTypeaheadConstants.COMPOSER_THREADS_INITIAL_LIMIT,g.MercuryTypeaheadConstants.COMPOSER_SHOW_MORE_LIMIT);this._maxResults=g.MercuryTypeaheadConstants.COMPOSER_FRIENDS_MAX+g.MercuryTypeaheadConstants.COMPOSER_THREADS_INITIAL_LIMIT+g.MercuryTypeaheadConstants.COMPOSER_NON_FRIENDS_MAX;this._statesPerTokens={};this.subscribe('fetchComplete',function(s,t){var u=t.fetch_context,v=t.response.getPayload().entries;if(u.bootstrap)q(v);});}n.prototype.buildData=function(r){"use strict";var s=[],t=[],u=[],v=[];r.forEach(function(x){var y=m.getEntry.call(this,x);switch(y.render_type){case g.MercuryTypeaheadConstants.FRIEND_TYPE:if(s.length<g.MercuryTypeaheadConstants.COMPOSER_FRIENDS_MAX)s.push(x);break;case g.MercuryTypeaheadConstants.THREAD_TYPE:var z=x;if(i.MercuryFBIDGK){z=y.mercury_thread.thread_fbid;y.uid=z;m.setEntry.call(this,z,y);}t.push(z);break;case g.MercuryTypeaheadConstants.NON_FRIEND_TYPE:if(u.length<g.MercuryTypeaheadConstants.COMPOSER_NON_FRIENDS_MAX)u.push(x);break;case g.MercuryTypeaheadConstants.FB4C_TYPE:if(v.length<g.MercuryTypeaheadConstants.COMPOSER_FRIENDS_MAX)v.push(x);break;}}.bind(this));var w=s.concat(v,t,u);if(!this.hasLoadedAllResults()){this._maxResults=w.length+1;}else this._maxResults=w.length;return m.buildData.call(this,w);};n.prototype.query=function(r,s,t){"use strict";this.value=r;m.query.call(this,r,s,t);};n.prototype.getQueryData=function(r,s){"use strict";var t=m.getQueryData.call(this,r,s);t.existing_token_ids=p();return t;};n.prototype.getStates=function(){"use strict";var r=o();if(!this._statesPerTokens[r])this._statesPerTokens[r]={};return this._statesPerTokens[r];};n.prototype.fetchHandler=function(r,s){"use strict";this.getState('loaded_all_threads_per_query')[s.value]=r.getPayload().end_of_threads;this.getState('loaded_initial_per_query')[s.value]=true;m.fetchHandler.call(this,r,s);};n.prototype.hasLoadedInitialResults=function(r){"use strict";if(r===undefined)r=this.value;return this.getState('loaded_initial_per_query')[r];};n.prototype.hasLoadedAllResults=function(r){"use strict";if(r===undefined)r=this.value;return this.getState('loaded_all_threads_per_query')[r];};function o(){var r=p().sort();return ','+r.join(',');}function p(){var r=k.getCurrentStateData();return (r.participants||[]).map(function(s){return j.tokenize(s).value;});}function q(r){r.forEach(function(s){s.render_type=g.MercuryTypeaheadConstants.FRIEND_TYPE;});}e.exports=n;},null);
__d("MercuryRecipientsDataSource",["DataSource","WebMessengerConstants"],function(a,b,c,d,e,f,g,h){for(var i in g)if(g.hasOwnProperty(i))k[i]=g[i];var j=g===null?null:g.prototype;k.prototype=Object.create(j);k.prototype.constructor=k;k.__superConstructor__=g;function k(l){"use strict";l=l||{};l.kanaNormalization=true;g.call(this,l);}k.prototype.buildData=function(l){"use strict";var m=[],n=[];l.forEach(function(o){var p=j.getEntry.call(this,o);if(p.render_type==h.NON_FRIEND_TYPE){var q=h.COMPOSER_NON_FRIENDS_MAX;if(n.length<q)n.push(o);}else if(m.length<h.COMPOSER_FRIENDS_MAX){p.render_type=h.FRIEND_TYPE;m.push(o);}}.bind(this));return j.buildData.call(this,m.concat(n));};e.exports=k;},null);