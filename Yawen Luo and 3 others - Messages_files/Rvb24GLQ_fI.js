/*!CK:1616018845!*//*1409634680,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["zivV0"]); }

__d("MercuryMessageSourceTags",[],function(a,b,c,d,e,f){e.exports={CHAT:"source:chat",EMAIL:"source:email",MESSENGER:"source:messenger",MOBILE:"source:mobile"};},null);
__d("MercuryTimePassed",[],function(a,b,c,d,e,f){e.exports={TODAY:0,WEEK_AGO:1,MONTH_AGO:2,CURRENT_YEAR:3,OTHER_YEAR:4};},null);
__d("MessagingEvent",[],function(a,b,c,d,e,f){e.exports={DELETE:"delete",DELETE_MESSAGES:"delete_messages",DELIVER:"deliver",ERROR:"error",READ:"read",REPORT_SPAM:"report_spam",REPORT_SPAM_MESSAGES:"report_spam_messages",UNMARK_SPAM:"unmark_spam",SUBSCRIBE:"subscribe",CHANGE_MUTE_SETTINGS:"change_mute_settings",TAG:"tag",UNREAD:"unread",UNSUBSCRIBE:"unsubscribe",DELIVER_LOG:"deliver_log",MORE_THREADS:"more_threads",READ_ALL:"read_all",READ_RECEIPT:"read_receipt",DELIVERY_RECEIPT:"delivery_receipt",SENT_PUSH:"sent_push",DELIVER_FAST_PAST:"deliver_fast_path",MESSENGER_STATUS:"messenger_status",UPDATE_PINNED_THREADS:"update_pinned_threads"};},null);
__d("SplitImage.react",["React","Image.react","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j){var k=g.createClass({displayName:'SplitImage',render:function(){var l=this.props.size;return (g.createElement(g.DOM.div,Object.assign({},this.props,{className:j(this.props.className,"_55lt"),style:Object.assign({},(this.props.style||{}),{width:l,height:l})}),this.renderImages()));},renderImages:function(){if(!this.props.srcs)return null;var l=this.props.srcs,m=Array.isArray(l);if(!m||l.length==1)return this.renderOne(m?l[0]:l);return l.length==2?this.renderTwo(l):this.renderThree(l);},renderOne:function(l){return (g.createElement(h,{src:l,width:this.props.size,height:this.props.size,alt:""}));},renderTwo:function(l){var m=this.props.size,n=Math.floor(m/2),o=-Math.floor(n/2),p=(("_55lu")+(this.props.border?' '+"_57xo":''));return (g.createElement(g.DOM.div,null,g.createElement(g.DOM.div,{className:"_55lu",style:{width:n}},g.createElement(h,{src:l[0],width:m,height:m,style:{marginLeft:o}})),g.createElement(g.DOM.div,{className:p,style:{width:n}},g.createElement(h,{src:l[1],width:m,height:m,style:{marginLeft:o}}))));},renderThree:function(l){var m=this.props.size,n=Math.floor(m/3*2),o=-Math.floor((m-n)/2),p=Math.floor(m/2),q=m-n,r=-Math.floor((p-q)/2),s=(("_55lu")+(this.props.border?' '+"_57pl":'')),t=(("_55lu")+(this.props.border?' '+"_57pm":''));return (g.createElement(g.DOM.div,null,g.createElement(g.DOM.div,{className:s,style:{width:n}},g.createElement(h,{src:l[0],width:m,height:m,style:{marginLeft:o}})),g.createElement(g.DOM.div,{className:t,style:{width:q,height:p}},g.createElement(h,{src:l[1],width:p,height:p,style:{marginLeft:r}})),g.createElement(g.DOM.div,{className:"_55lu",style:{width:q,height:p}},g.createElement(h,{src:l[2],width:p,height:p,style:{marginLeft:r}}))));}});e.exports=k;},null);
__d("loadImage",[],function(a,b,c,d,e,f){"use strict";function g(h,i){var j=new Image();j.onload=function(){i(j.width,j.height,j);};j.src=h;}e.exports=g;},null);
__d("PhotoResizeMath",[],function(a,b,c,d,e,f){var g={getScaledPhotoDimensions:function(h,i,j,k,l){var m=h/i,n=j/k;if(j&&k&&l==='stretch')return {width:j,height:k};if((!j&&k)||((l==='contain')!==(m>=n)))return {width:k*m,height:k};if(j)return {width:j,height:j/m};return {width:h,height:i};}};e.exports=g;},null);
__d("PixelzFocus",[],function(a,b,c,d,e,f){"use strict";var g={search:function(h,i){var j=0,k=h.length-1;while(j<=k){var l=j+Math.floor((k-j)/2),m=h[l];if(m>i){k=l-1;}else if(m<i){j=l+1;}else return l;}return Math.min(j,k);},forceSpecificPoint:function(h,i,j){var k=1e-09,l=g.search(h,i-j-k)+1,m=g.search(h,i+j);return h.slice(l,m+1);},findBiggestSets:function(h,i){var j=[],k=-1;for(var l=0;l<h.length;++l){var m=h[l],n=l,o=g.search(h,m+i),p=o-n;if(p>k)j=[];if(p>=k){k=p;j.push({low:n,high:o});}}return j;},getBestSet:function(h,i,j){var k=-1,l=null;for(var m=0;m<i.length;++m){var n=i[m],o=h[n.low],p=h[n.high],q=o+(p-o)/2,r=Math.min(o-(q-j),(q+j)-p);if(r>k){k=r;l=n;}}return l;},getFocusFromSet:function(h,i){var j=h[i.low],k=h[i.high];return j+(k-j)/2;},clampFocus:function(h,i){var j=i/2,k=1-(i/2);if(h<j)return j;if(h>k)return k;return h;},convertFromCenterToCSS:function(h,i){if(Math.abs(1-i)<1e-05)return 0;return (h-i/2)/(1-i);},convertFromCSSToCenter:function(h,i){return h*(1-i)+i/2;},getVisible:function(h,i){if(h<i)return h/i;return i/h;},getHidden:function(h,i){return 1-g.getVisible(h,i);},focusHorizontally:function(h,i){return h<i;},convertVectorFromCenterToCSS:function(h,i,j){var k=g.focusHorizontally(i,j),l;if(k){l=h.x/100;}else l=h.x/100;var m=g.convertFromCenterToCSS(l,g.getVisible(i,j));if(k){return {x:m,y:0};}else return {x:0,y:m};},getCropRect:function(h,i,j){var k=g.focusHorizontally(i,j),l=g.getVisible(i,j);if(k){var m=(1-l)*h.x;return {left:m,top:0,width:l,height:1};}else{var n=(1-l)*h.y;return {left:0,top:n,width:1,height:l};}}};e.exports=g;},null);
__d("Pixelz.react",["arrayContains","copyProperties","cx","loadImage","joinClasses","React","PhotoResizeMath","PixelzFocus"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";var o=l.PropTypes,p=l.createClass({displayName:'Pixelz',propTypes:{width:o.number,height:o.number,resizeMode:o.oneOf(['contain','cover','stretch']),alt:o.string,letterbox:o.bool,borderRadius:o.number,insetBorderColor:o.string,animated:o.bool,upscale:o.bool,cropRect:function(q,r,s){var t=q[r],u='Invalid prop `'+r+'` supplied to `'+s+'`, expected a rectangle with values normalized '+'between 0 and 1.';if(t.left<0||t.top<0||t.width<0||t.height<0||t.left+t.width>1||t.top+t.height>1)return new Error(u);},focus:function(q,r,s){var t=q[r],u='Invalid prop `'+r+'` supplied to `'+s+'`, expected either a {x, y, type} vector where type '+'is `css` or `center` or an array of {x, y} vectors. All the vectors '+'have with values normalized between 0 and 1.';if(Array.isArray(t)){for(var v=0;v<t.length;++v)if(!(t[v].x>=0&&t[v].x<=1)||!(t[v].y>=0&&t[v].y<=1))return new Error(u);}else{if(!t.type)t.type='css';if(!(t.x>=0&&t.x<=1)||!(t.y>=0&&t.y<=1)||!g(['center','css'],t.type))return new Error(u);}}},getDefaultProps:function(){return {resizeMode:'cover',alt:'',letterbox:true,upscale:true,cropRect:{width:1,height:1,top:0,left:0},focus:{x:.5,y:.5,type:'css'}};},getInitialState:function(){return {srcDimensions:{}};},getSrcDimensions:function(){var q=this.props.src,r=this.state.srcDimensions[q];if(r)return r;j(q,function(s,t){var u={};u[q]={width:s,height:t};this.setState({srcDimensions:u});}.bind(this));return null;},getCropSrcDimensions:function(){var q=this.getSrcDimensions();return {width:q.width*this.props.cropRect.width,height:q.height*this.props.cropRect.height};},getUpscaleCropDimensions:function(){var q=this.getCropSrcDimensions();return m.getScaledPhotoDimensions(q.width,q.height,this.props.width,this.props.height,this.props.resizeMode);},getCropDimensions:function(){var q=this.getUpscaleCropDimensions(),r=this.getCropSrcDimensions();if(!this.props.upscale)return {width:Math.min(q.width,r.width),height:Math.min(q.height,r.height)};return q;},getCropAspectRatio:function(){var q=this.getCropDimensions();return q.width/q.height;},getContainerDimensions:function(){if(this.props.letterbox&&this.props.width&&this.props.height)return {width:this.props.width,height:this.props.height};return this.getCropDimensions();},getContainerAspectRatio:function(){var q=this.getContainerDimensions();return q.width/q.height;},getContainerPosition:function(){return {left:0,top:0};},getFocus:function(){var q=this.props.focus;if(!Array.isArray(q)&&q.type==='css')return {x:q.x,y:q.y};var r=this.getContainerAspectRatio(),s=this.getCropAspectRatio(),t=n.getVisible(r,s),u=n.focusHorizontally(r,s),v;if(!Array.isArray(q)){v=n.convertFromCenterToCSS(u?q.x:q.y,t);}else{var w=q.map(function(z){return u?z.x:z.y;});w.sort();var x=n.findBiggestSets(w,t),y=n.getBestSet(w,x,t);v=n.getFocusFromSet(w,y);}return {x:u?v:.5,y:u?.5:v};},getCropPosition:function(){var q=this.getCropDimensions(),r=this.getContainerDimensions(),s=this.getFocus();return {left:s.x*(r.width-q.width),top:s.y*(r.height-q.height)};},getScaleDimensions:function(){var q=this.getCropDimensions();return {width:q.width/this.props.cropRect.width,height:q.height/this.props.cropRect.height};},getScalePosition:function(){var q=this.getScaleDimensions();return {left:-q.width*this.props.cropRect.left,top:-q.height*this.props.cropRect.top};},getClipCropRectangle:function(){var q=this.getContainerDimensions(),r=this.getCropDimensions(),s=this.getContainerPosition(),t=this.getCropPosition(),u=Math.max(s.left,t.left),v=Math.max(s.top,t.top),w=Math.min(s.top+q.height,t.top+r.height),x=Math.min(s.left+q.width,t.left+r.width);return {left:u,top:v,width:x-u,height:w-v};},getClipCropPosition:function(){var q=this.getClipCropRectangle();return {left:q.left,top:q.top};},getClipCropDimensions:function(){var q=this.getClipCropRectangle();return {width:q.width,height:q.height};},getClipScalePosition:function(){var q=this.getScalePosition(),r=this.getClipCropPosition(),s=this.getCropPosition();return {left:q.left+(s.left-r.left),top:q.top+(s.top-r.top)};},getClipScaleDimensions:function(){return this.getScaleDimensions();},areDimensionsEqual:function(q,r){return q.width===r.width&&q.height===r.height;},shouldAddAllNodesAndStyles:function(){return this.props.animated;},hasCrop:function(){if(this.shouldAddAllNodesAndStyles())return true;var q=this.getContainerDimensions(),r=this.getClipCropDimensions(),s=this.getClipScaleDimensions();if(this.areDimensionsEqual(q,r)||this.areDimensionsEqual(r,s))return false;return true;},hasContainer:function(){if(this.shouldAddAllNodesAndStyles()||this.hasInsetBorder())return true;var q=this.getContainerDimensions(),r=this.getClipScaleDimensions();if(this.areDimensionsEqual(q,r))return false;return true;},hasInsetBorder:function(){return this.shouldAddAllNodesAndStyles()||this.props.insetBorderColor;},applyPositionStyle:function(q,r){if(this.shouldAddAllNodesAndStyles()||r.left)q.left=Math.round(r.left);if(this.shouldAddAllNodesAndStyles()||r.top)q.top=Math.round(r.top);},applyDimensionsStyle:function(q,r){q.width=Math.round(r.width);q.height=Math.round(r.height);},applyBorderRadiusStyle:function(q){if(this.shouldAddAllNodesAndStyles()||this.props.borderRadius)q.borderRadius=this.props.borderRadius||0;},getScaleStyle:function(){var q={},r=this.getClipCropDimensions(),s=this.getClipScaleDimensions();if(this.shouldAddAllNodesAndStyles()||!this.areDimensionsEqual(r,s)){this.applyPositionStyle(q,this.getClipScalePosition());}else this.applyPositionStyle(q,this.getClipCropPosition());this.applyDimensionsStyle(q,this.getClipScaleDimensions());this.applyBorderRadiusStyle(q);return q;},getCropStyle:function(){var q={};this.applyPositionStyle(q,this.getClipCropPosition());this.applyDimensionsStyle(q,this.getClipCropDimensions());this.applyBorderRadiusStyle(q);return q;},getInsetBorderStyle:function(){var q={borderColor:this.props.insetBorderColor||'transparent'};this.applyPositionStyle(q,this.getClipCropPosition());this.applyDimensionsStyle(q,this.getClipCropDimensions());this.applyBorderRadiusStyle(q);return q;},getContainerStyle:function(){var q={};this.applyDimensionsStyle(q,this.getContainerDimensions());this.applyBorderRadiusStyle(q);return q;},getScale:function(){var q=this.getScaleStyle(),r=q.width,s=q.height;q=h({},q);delete q.width;delete q.height;return (l.createElement(l.DOM.img,Object.assign({},this.props,{alt:this.props.alt,className:k(this.props.className,(("_56wb")+(this.shouldAddAllNodesAndStyles()?' '+"_56t5":''))),src:this.props.src,style:Object.assign({},(this.props.style||{}),q),width:r,height:s})));},getCrop:function(){var q=this.getScale();if(!this.hasCrop())return q;return (l.createElement(l.DOM.div,{className:(("_56ma")+(this.shouldAddAllNodesAndStyles()?' '+"_56t5":'')),style:this.getCropStyle()},q));},getInsetBorder:function(){if(!this.hasInsetBorder())return null;return (l.createElement(l.DOM.div,{className:(("_56lv")+(this.shouldAddAllNodesAndStyles()?' '+"_56t5":'')),style:this.getInsetBorderStyle()}));},getContainer:function(){var q=this.getCrop();if(!this.hasContainer())return q;var r=this.getInsetBorder();return (l.createElement(l.DOM.div,{className:(("_56jj")+(this.shouldAddAllNodesAndStyles()?' '+"_56t5":'')),style:this.getContainerStyle()},q,r));},render:function(){var q=this.getSrcDimensions();if(!q)return l.createElement(l.DOM.span,null);return this.getContainer();}});e.exports=p;},null);
__d("RangedCallbackManager",["CallbackManagerController","copyProperties","createObjectFrom"],function(a,b,c,d,e,f,g,h,i){var j=function(k,l,m){this._resources=[];this._reachedEndOfArray=false;this._error=false;this._existingIDs={};this._controller=new g(this._constructCallbackArg.bind(this));this._getValueHandler=k;this._compareValuesHandler=l;this._skipOnStrictHandler=m;};h(j.prototype,{executeOrEnqueue:function(k,l,m,n,o){return this._controller.executeOrEnqueue({start:k,limit:l},m,{strict:!!n,skipOnStrictHandler:o});},unsubscribe:function(k){this._controller.unsubscribe(k);},getUnavailableResources:function(k){var l=this._controller.getRequest(k),m=[];if(l&&!this._reachedEndOfArray){var n=l.request,o=this._filterForStrictResults(l.options),p=n.start+n.limit;for(var q=o.length;q<p;q++)m.push(q);}return m;},addResources:function(k){k.forEach(function(l){if(!this._existingIDs[l]){this._existingIDs[l]=true;this._resources.push(l);this._error=null;}}.bind(this));this.resortResources();this._controller.runPossibleCallbacks();},addResourcesWithoutSorting:function(k,l){var m=this._resources.slice(0,l);m=m.concat(k);m=m.concat(this._resources.slice(l));this._resources=m;h(this._existingIDs,i(k,true));this._error=null;this._controller.runPossibleCallbacks();},removeResources:function(k){k.forEach(function(l){if(this._existingIDs[l]){this._existingIDs[l]=false;var m=this._resources.indexOf(l);if(m!=-1)this._resources.splice(m,1);}}.bind(this));},removeAllResources:function(){this._resources=[];this._existingIDs={};},resortResources:function(){this._resources=this._resources.sort(function(k,l){return this._compareValuesHandler(this._getValueHandler(k),this._getValueHandler(l));}.bind(this));},setReachedEndOfArray:function(){if(!this._reachedEndOfArray){this._reachedEndOfArray=true;this._error=null;this._controller.runPossibleCallbacks();}},hasReachedEndOfArray:function(){return this._reachedEndOfArray;},setError:function(k){if(this._error!==k){this._error=k;this._controller.runPossibleCallbacks();}},getError:function(k,l,m){var n=this._filterForStrictResults({strict:m});return k+l>n.length?this._error:null;},hasResource:function(k){return this._existingIDs[k];},getResourceAtIndex:function(k){return this._resources[k];},getAllResources:function(){return this._resources.concat();},getCurrentArraySize:function(k){return this._filterForStrictResults(k).length;},_filterForStrictResults:function(k){var l=this._resources;if(k&&k.strict){var m=k.skipOnStrictHandler||this._skipOnStrictHandler;if(m)l=l.filter(m);}return l;},_constructCallbackArg:function(k,l){var m=this._filterForStrictResults(l);if(!this._reachedEndOfArray&&!this._error&&k.start+k.limit>m.length){return false;}else{var n=m.slice(k.start,k.start+k.limit),o=k.start+k.limit>m.length?this._error:null;return [n,o];}},getElementsUntil:function(k){var l=[];for(var m=0;m<this._resources.length;m++){var n=this._getValueHandler(this._resources[m]);if(this._compareValuesHandler(n,k)>0)break;l.push(this._resources[m]);}return l;}});e.exports=j;},null);
__d("filterObject",[],function(a,b,c,d,e,f){'use strict';var g=Object.prototype.hasOwnProperty;function h(i,j,k){if(!i)return null;var l={};for(var m in i)if(g.call(i,m)&&j.call(k,i[m],m,i))l[m]=i[m];return l;}e.exports=h;},null);
__d("mergeObjects",["copyProperties"],function(a,b,c,d,e,f,g){function h(){var i={};for(var j=0;j<arguments.length;j++)g(i,arguments[j]);return i;}e.exports=h;},null);
__d("DateConsts",["fbt"],function(a,b,c,d,e,f,g){var h=1000,i=60,j=60,k=24,l=7,m=365.242,n=12,o=i*j,p=o*k,q=p*m,r=h*p*l,s=h*p*m,t="Day:",u="Month:",v="Year:",w=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],x=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],y=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],z=["January","February","March","April","May","June","July","August","September","October","November","December"],aa=['',"st","nd","rd","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","st","nd","rd","th","th","th","th","th","th","th","st"],ba={getWeekdayName:function(ca){return x[ca];},getWeekdayNameShort:function(ca){return w[ca];},getMonthName:function(ca){return z[ca-1];},getMonthNameShort:function(ca){return y[ca-1];},getOrdinalSuffix:function(ca){return aa[ca];},getDaysInMonth:function(ca,da){return (new Date(ca,da,0)).getDate();},getCurrentTimeInSeconds:function(){return Date.now()/h;},DAYS_PER_YEAR:m,HOUR_PER_DAY:k,MIN_PER_HOUR:j,MONTHS_PER_YEAR:n,MS_PER_SEC:h,MS_PER_WEEK:r,MS_PER_YEAR:s,SEC_PER_MIN:i,SEC_PER_HOUR:o,SEC_PER_DAY:p,SEC_PER_YEAR:q,DAY_LABEL:t,MONTH_LABEL:u,YEAR_LABEL:v};e.exports=ba;},null);
__d("URLMatcher",[],function(a,b,c,d,e,f){var g='!"#%&\'()*,-./:;<>?@[\\]^_`{|}',h='\u2000-\u206F\u00ab\u00bb\uff08\uff09',i='(?:25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])',j='(?:(?:ht|f)tps?)://',k='(?:(?:'+i+'[.]){3}'+i+')',l='\\[(?:(?:[A-Fa-f0-9]{1,4}::?){1,7}[A-Fa-f0-9]{1,4})\\]',m='(?:\\b)www\\d{0,3}[.]',n='[^\\s'+g+h+']',o='(?:(?:(?:[.:\\-_%@]|'+n+')*'+n+')|'+l+')',p='(?:[.][a-z]{2,4})',q='(?::\\d+){0,1}',r='(?=[/?#])',s='(?:'+'(?:'+j+o+q+')|'+'(?:'+k+q+')|'+'(?:'+l+q+')|'+'(?:'+m+o+p+q+')|'+'(?:'+o+p+q+r+')'+')',t='[/#?]',u='\\([^\\s()<>]+\\)',v='[^\\s()<>?#]+',w=new RegExp(s,'im'),x='^\\[[0-9]{1,4}:[0-9]{1,4}:[A-Fa-f0-9]{1,4}\\]',y=new RegExp(x,'im'),z='(?:'+'(?:'+t+')'+'(?:'+'(?:'+u+'|'+v+')*'+')*'+')*',aa=new RegExp('('+'(?:'+s+')'+'(?:'+z+')'+')','im'),ba=new RegExp('('+'(?:'+j+o+q+')|'+'(?:'+m+o+p+q+')'+')'),ca=/[\s'";]/,da=new RegExp(t,'im'),ea=new RegExp('[\\s!"#%&\'()*,./:;<>?@[\\]^`{|}\u00ab\u00bb\u2000-\u206F\uff08\uff09]','im'),fa=new RegExp('[\\s()<>?#]','im'),ga=new RegExp('\\s()<>'),ha=function(oa){if(oa&&oa.indexOf('@')!=-1){return (ba.exec(oa))?oa:null;}else return oa;},ia=function(oa){return ja(oa,aa);},ja=function(oa,pa){var qa=(pa.exec(oa)||[])[1]||null;return ha(qa);},ka=function(oa){return w.exec(oa);},la=function(oa){return !ca.test(oa.charAt(oa.length-1));},ma=function(oa){do{var pa=w.exec(oa);if(!pa)return null;var qa=false;if(pa[0][0]==='['&&pa.index>0&&oa[pa.index-1]==='@'){var ra=y.exec(pa[0]);if(ra){qa=true;oa=oa.substr(pa.index+ra[0].length);}}}while(qa);var sa=oa.substr(pa.index+pa[0].length);if(sa.length===0||!(da.test(sa[0])))return ha(pa[0]);var ta=0,ua=0,va=1,wa=0,xa=ua;for(var ya=1;ya<sa.length;ya++){var za=sa[ya];if(xa===ua){if(za==='('){wa=wa+1;xa=va;}else if(da.test(za)||!(ea.test(za))){ta=ya;}else if(fa.test(za))break;}else if(za==='('){wa=wa+1;}else if(za===')'){wa=wa-1;if(wa===0){xa=ua;ta=ya;}}else if(ga.test(za))break;}return ha(pa[0]+sa.substring(0,ta+1));},na={};na.permissiveMatch=ia;na.matchToPattern=ja;na.matchHost=ka;na.trigger=la;na.match=ma;e.exports=na;},null);
__d("formatDate",["DateConsts","DateFormatConfig","fbt","invariant"],function(a,b,c,d,e,f,g,h,i,j){function k(o,p,q){q=q||{};if(!p||!o)return '';if(typeof o==='string')o=parseInt(o,10);if(typeof o==='number')o=new Date(o*1000);j(o instanceof Date);j(!isNaN(o.getTime()));j(o.getTime()<1e+15);if(typeof p!=='string'){var r=m();for(var s in r){var t=r[s];if(t.start<=o.getTime()&&p[t.name]){p=p[t.name];break;}}}var u;if(q.skipPatternLocalization||n()||p.length===1){u=p;}else{j(h.formats[p]);u=h.formats[p];}var v=q.utc?'getUTC':'get',w=o[v+'Date'](),x=o[v+'Day'](),y=o[v+'Month'](),z=o[v+'FullYear'](),aa=o[v+'Hours'](),ba=o[v+'Minutes'](),ca=o[v+'Seconds'](),da=o[v+'Milliseconds'](),ea='';for(var fa=0;fa<u.length;fa++){var ga=u.charAt(fa);switch(ga){case '\\':fa++;ea+=u.charAt(fa);break;case 'd':ea+=l(w,2);break;case 'j':ea+=w;break;case 'S':ea+=g.getOrdinalSuffix(w);break;case 'D':ea+=g.getWeekdayNameShort(x);break;case 'l':ea+=g.getWeekdayName(x);break;case 'F':case 'f':ea+=g.getMonthName(y+1);break;case 'M':ea+=g.getMonthNameShort(y+1);break;case 'm':ea+=l(y+1,2);break;case 'n':ea+=y+1;break;case 'Y':ea+=z;break;case 'y':ea+=(''+z).slice(2);break;case 'a':if(aa<12){ea+="am";}else ea+="pm";break;case 'A':if(aa<12){ea+="AM";}else ea+="PM";break;case 'g':ea+=(aa===0||aa===12)?12:aa%12;break;case 'G':ea+=aa;break;case 'h':if(aa===0||aa===12){ea+=12;}else ea+=l(aa%12,2);break;case 'H':ea+=l(aa,2);break;case 'i':ea+=l(ba,2);break;case 's':ea+=l(ca,2);break;case 'X':ea+=l(da,3);break;default:ea+=ga;}}return ea;}function l(o,p){return Array(p-(''+o).length+1).join('0')+o;}function m(){var o=new Date(),p=o.getTime(),q=o.getFullYear(),r=o.getDate()-((o.getDay()-h.weekStart+6)%7),s=new Date(q,o.getMonth()+1,0).getDate(),t=new Date(q,1,29).getMonth()===1?366:365,u=1000*60*60*24;return [{name:'today',start:o.setHours(0,0,0,0)},{name:'withinDay',start:p-u},{name:'thisWeek',start:new Date(o.getTime()).setDate(r)},{name:'withinWeek',start:p-u*7},{name:'thisMonth',start:o.setDate(1)},{name:'withinMonth',start:p-u*s},{name:'thisYear',start:o.setMonth(0)},{name:'withinYear',start:p-u*t},{name:'older',start:-Infinity}];}k.periodNames=['today','thisWeek','thisMonth','thisYear','withinDay','withinWeek','withinMonth','withinYear','older'];function n(){if(typeof window==='undefined'||!window||!window.location)return false;var o=window.location.pathname,p='/intern';return o.substr(0,p.length)===p;}e.exports=k;},null);
__d("MercuryThreadMuter",["AsyncDialog","AsyncRequest","CurrentUser","DOM","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j){var k=b('MercuryThreads').get(),l={getUserIDEmail:function(){return i.getID()+'@facebook.com';},getThreadMuteSettingForUser:function(m){return m.mute_settings&&m.mute_settings[l.getUserIDEmail()];},isThreadMuted:function(m){return l.getThreadMuteSettingForUser(m)!==undefined;},showMuteChangeDialog:function(m){g.send(new h('/ajax/mercury/mute_thread_dialog.php'),function(n){n.subscribe('confirm',function(){this.hide();var o;j.scry(this.getRoot(),'input[type="radio"]').forEach(function(r){if(r.checked)o=r.value;});switch(o){case 'always':o=-1;break;case '1hour':o=3600;break;case '8am':var p=new Date(),q=new Date();q.setHours(8);q.setMinutes(0);q.setSeconds(0);if(q>p){o=q-p;}else o=q-p+(24*3600*1000);o/=1000;break;default:o=0;}k.updateThreadMuteSetting(m,o);}.bind(n));});}};e.exports=l;},null);
__d("WebMessengerThreadPermalinks",["MercuryIDs","MessagingTag","URI","WebMessengerPermalinkConstants","WWWBase","requireWeak"],function(a,b,c,d,e,f,g,h,i,j,k,l){'use strict';var m={getThreadURI:function(q,r,s){if(g.isCanonical(q)){n(q,r,s);}else o(q,r,s);}};function n(q,r,s){var t=new i(k.uri),u=g.tokenize(q).value;t.setPath(p(s)+'/'+u);r&&r(t.toString());}function o(q,r,s){l(['MercuryServerRequests'],function(t){var u=t.get();u.getServerThreadID(q,function(v){var w=new i(k.uri);w.setPath(j.getURIPathForThreadID(v,p(s)));r&&r(w.toString());});});}function p(q){var r=j.BASE_PATH;if(q&&q!=h.INBOX)r+='/'+q;return r;}e.exports=m;},null);
__d("MercuryThreadImage.react",["MercuryParticipants","MercuryParticipantsConstants","Pixelz.react","React","SplitImage.react"],function(a,b,c,d,e,f,g,h,i,j,k){'use strict';var l=j.createClass({displayName:'MercuryThreadImage',propTypes:{thread:j.PropTypes.object.isRequired,viewer:j.PropTypes.string.isRequired},getInitialState:function(){return {participantImages:[]};},componentDidMount:function(){this._getParticipantImages(this.props);},componentWillReceiveProps:function(m,n){this._getParticipantImages(m);},render:function(){if(this.props.thread.image_src)return (j.createElement(i,{height:h.BIG_IMAGE_SIZE,resizeMode:'cover',src:this.props.thread.image_src,width:h.BIG_IMAGE_SIZE}));if(this.state.participantImages.length>0)return (j.createElement(k,{srcs:this.state.participantImages,border:true,size:h.BIG_IMAGE_SIZE}));return null;},_getParticipantImages:function(m){var n=m.thread,o=m.viewer;if(n.image_src)return;var p=g.getIDForUser(o),q=n.participants.filter(function(s){return s!=p;}),r=[];if(!q.length){r=[p];}else if(q.length==1){r=q;}else r=q.slice(0,3);g.getOrderedBigImageMulti(r,function(s){this.isMounted()&&this.setState({participantImages:s});}.bind(this));}});e.exports=l;},null);
__d("MercuryParticipantListRenderer",["fbt"],function(a,b,c,d,e,f,g){'use strict';function h(){this.$MercuryParticipantListRenderer0=false;this.$MercuryParticipantListRenderer1=function(o){return o.name;};}h.prototype.renderParticipantList=function(o){var p=o.map(this.$MercuryParticipantListRenderer1);switch(p.length){case 0:return i(this.$MercuryParticipantListRenderer0);case 1:return j(p);case 2:return k(p);case 3:return l(p);default:return m(p);}};h.prototype.setIsNewThread=function(o){this.$MercuryParticipantListRenderer0=o;return this;};h.prototype.setNameRenderer=function(o){this.$MercuryParticipantListRenderer1=o;return this;};function i(o){if(o){return ("New Message");}else return ("No Participants");}function j(o){return o[0];}function k(o){return (g._("{participant1}, {participant2}",[g.param("participant1",o[0]),g.param("participant2",o[1])]));}function l(o){return (g._("{participant1}, {participant2}, {participant3}",[g.param("participant1",o[0]),g.param("participant2",o[1]),g.param("participant3",o[2])]));}function m(o){return (g._("{participant1}, {participant2}, {participant3}, {others_link}",[g.param("participant1",o[0]),g.param("participant2",o[1]),g.param("participant3",o[2]),g.param("others_link",n(o.length-3))]));}function n(o){if(o>1){return (g._("{others_count} others",[g.param("others_count",o)]));}else return ("1 other");}e.exports=h;},null);
__d("MercuryThreadTitle.react",["MercuryParticipantListRenderer","MercuryParticipants","React","fbt"],function(a,b,c,d,e,f,g,h,i,j){'use strict';var k=i.createClass({displayName:'MercuryThreadTitle',propTypes:{thread:i.PropTypes.object.isRequired,viewer:i.PropTypes.string.isRequired,showUnreadCount:i.PropTypes.bool},getDefaultProps:function(){return {showUnreadCount:false};},getInitialState:function(){return {participantNames:''};},componentDidMount:function(){this._renderParticipantsList(this.props);},componentWillReceiveProps:function(l){this._renderParticipantsList(l);},render:function(){return (i.createElement(i.DOM.span,null,this.props.thread.name?this._renderThreadTitle():this.state.participantNames));},_renderThreadTitle:function(){var l=this.props.thread;if(!l.unread_count||!this.props.showUnreadCount)return l.name;return this._renderTitleWithUnreadCount(l.name,l.unread_count);},_renderParticipantsList:function(l){if(l.thread.name)return;var m=h.getIDForUser(l.viewer),n=l.thread.participants;if(n.length>1)n=n.filter(function(o){return o!=m;});h.getMulti(n,function(o){if(!this.isMounted())return;var p=n.map(function(s){return o[s];}),q=new g().renderParticipantList(p),r=(l.showUnreadCount&&l.thread.unread_count)?this._renderTitleWithUnreadCount(q,l.thread.unread_count):q;this.setState({participantNames:r});}.bind(this));},_renderTitleWithUnreadCount:function(l,m){return (j._("{conversation-title} ({unread-count})",[j.param("conversation-title",l),j.param("unread-count",m)]));}});e.exports=k;},null);
__d("MercuryErrorInfo",["MercuryActionStatus","MercuryErrorType","fbt"],function(a,b,c,d,e,f,g,h,i){var j={getMessage:function(k){var l='';if(j.isConnectionError(k)){l="This message didn't send.";if(j.isTransient(k))l=i._("{message} Check your internet connection and click to try again.",[i.param("message",l)]);}else{if(k&&k.description){l=k.description;}else l="This message failed to send.";if(j.isTransient(k))l=i._("{message} Click to send again.",[i.param("message",l)]);}return l;},isConnectionError:function(k){if(k&&k.type==h.TRANSPORT)return k.code===1001||k.code===1004||k.code===1006;return false;},isTransient:function(k){return k&&k.is_transient;},isPermanent:function(k){return k?!this.isTransient(k):false;},hasErrorStatus:function(k){return k.status===g.FAILED_UNKNOWN_REASON||k.status===g.UNABLE_TO_CONFIRM||k.status===g.ERROR;}};e.exports=j;},null);
__d("MercuryMessages",["AsyncRequest","BanzaiODS","CurrentUser","KeyedCallbackManager","MercuryActionStatus","MercuryActionTypeConstants","MercuryAssert","MercuryAttachmentType","MercuryGenericConstants","MercuryIDs","MercuryLogMessageType","MercuryMessageClientState","MercuryMessageSourceTags","MercuryPayloadSource","MercurySendLogger","MercurySingletonMixin","MercurySourceType","MercuryTimePassed","MercuryMessageIDs","MercuryParticipants","PresenceUtil","RangedCallbackManager","ReportState","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","copyProperties","debounceAcrossTransitions","formatDate","invariant","isNode","randomInt","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma){'use strict';function na(fb,gb){var hb=gb;if(fb._localIdsMap[gb])hb=fb._localIdsMap[gb];return fb._messages[hb];}var oa=new j();function pa(fb,gb){if(gb.status===undefined)gb.status=k.UNSENT;gb.timestamp_absolute="Today";gb.message_id=gb.message_id||fb.generateNewClientMessageID(gb.timestamp);var hb=z.getIDForUser(fb._fbid);gb.specific_to_list=gb.specific_to_list||[];if(gb.specific_to_list.length&&gb.specific_to_list.indexOf(hb)===-1)gb.specific_to_list.push(hb);if(!gb.thread_id){if(gb.specific_to_list.length==1){gb.thread_id='user:'+fb._fbid;}else if(gb.specific_to_list.length==2){var ib=gb.specific_to_list[0]==hb?gb.specific_to_list[1]:gb.specific_to_list[0];if(p.tokenize(ib).type=='email'){gb.thread_id=o.PENDING_THREAD_ID;}else gb.thread_id=fb._threads.getThreadIDForParticipant(ib);}gb.thread_id=gb.thread_id||'root:'+gb.message_id;}if(!gb.specific_to_list.length){var jb=fb._serverRequests.tokenizeThreadID(gb.thread_id);if(jb.type=='user')gb.specific_to_list=['fbid:'+jb.value,hb];}}function qa(fb,gb,hb,ib){var jb=bb(hb)?[s.CHAT]:[],kb=Date.now(),lb=ia(new Date(kb),'g:ia'),mb={action_type:gb,thread_id:ib,author:z.getIDForUser(fb._fbid),author_email:null,coordinates:null,timestamp:kb,timestamp_absolute:(new Date(kb)).toLocaleDateString(),timestamp_relative:lb,timestamp_time_passed:x.TODAY,is_unread:false,is_cleared:false,is_forward:false,is_filtered_content:false,is_spoof_warning:false,source:hb,source_tags:jb};return mb;}function ra(fb){switch(fb){case t.UNKNOWN:case t.SERVER_INITIAL_DATA:case t.SERVER_FETCH_THREAD_INFO:case t.SERVER_THREAD_SYNC:return true;}return false;}function sa(fb){return fb&&fb.substr(0,6)==='server';}function ta(fb,gb){if(!fb._threadsToMessages[gb])fb._threadsToMessages[gb]=new ba(function(hb){return na(fb,hb).timestamp;},function(hb,ib){return ib-hb;});return fb._threadsToMessages[gb];}function ua(fb){var gb=[];return JSON.stringify(fb,function(hb,ib){if(typeof ib==='object'&&ib!==null){if(ka(ib))return '<'+ib.nodeName+'>';if(gb.indexOf(ib)!==-1)return 'CIRCULAR';gb.push(ib);}return ib;});}ca.registerCallback('mercury-messages',function(){var fb={},gb={},hb=wa._getInstances();for(var ib in hb){fb[ib]={};for(var jb in hb[ib]._messages){var kb=hb[ib]._messages[jb];if(Object.keys(kb).length===0)continue;var lb=kb.thread_id;fb[ib][lb]=fb[ib][lb]||{};fb[ib][lb][kb.message_id]=JSON.parse(ua(kb));}gb[ib]=ga({},hb[ib]._localIdsMap);}var mb={};mb.local_message_ids=gb;mb.messages=fb;return mb;});function va(fb,gb,hb){gb.forEach(function(ib){var jb=ta(fb,ib);jb.setReachedEndOfArray();fb._threadInformer.reorderedMessages(ib,hb);});}function wa(fb){this._fbid=fb;this._serverRequests=da.getForFBID(this._fbid);this._threadInformer=ea.getForFBID(this._fbid);this._threads=fa.getForFBID(this._fbid);this._failedHistoryFetchThreads={};this._threadsToMessages={};this._titanMessagesCount={};this._localTitanMessagesCount={};this._messages={};this._attachmentData={};this._messagesNeedingAttachmentData={};this._localIdsMap={};this._serverRequests.subscribe('update-messages',function(gb,hb){var ib=(hb.actions||[]).filter(function(kb){var lb=kb.action_type;return (kb.is_forward||kb.thread_id)&&(lb==l.LOG_MESSAGE||lb==l.USER_GENERATED_MESSAGE||lb==l.SEND_MESSAGE||lb==l.CLEAR_CHAT||lb==l.DELETE_THREAD||lb==l.DELETE_MESSAGES);}),jb=ra(hb.payload_source);if(sa(hb.payload_source))ib.forEach(function(kb){if(!kb.is_forward){var lb=this._threads.getThreadMetaNow(kb.thread_id);if(lb)kb.is_cleared=kb.timestamp<lb.chat_clear_time;}}.bind(this));this.handleUpdates(ib,jb,hb.payload_source,hb.from_client);if(hb.end_of_history)va(this,hb.end_of_history,hb.payload_source);}.bind(this));}ga(wa.prototype,{getMessagesFromIDs:function(fb){return (fb||[]).map(na.bind(null,this)).filter(function(gb){return gb;});},hasLoadedNMessages:function(fb,gb){var hb=ta(this,fb);return hb.hasReachedEndOfArray()||hb.getCurrentArraySize()>=gb;},hasLoadedExactlyNMessages:function(fb,gb){var hb=ta(this,fb);return hb.getCurrentArraySize()==gb;},clearMercuryInternalState_DO_NOT_USE:function(){this._failedHistoryFetchThreads={};this._threadsToMessages={};this._titanMessagesCount={};this._localTitanMessagesCount={};this._messages={};this._attachmentData={};this._messagesNeedingAttachmentData={};this._localIdsMap={};},getThreadMessagesRange:function(fb,gb,hb,ib,jb,kb){var lb=ta(this,fb),mb=function(sb){ib(xa(this,sb));}.bind(this),nb=lb.executeOrEnqueue(gb,hb,mb),ob=lb.getUnavailableResources(nb),pb=this._failedHistoryFetchThreads[fb];if(ob.length&&!pb){var qb=(this._titanMessagesCount[fb]||0)-(this._localTitanMessagesCount[fb]||0),rb=ob.length+(this._localTitanMessagesCount[fb]||0);this._serverRequests.fetchThreadMessages(fb,qb,rb,jb,kb);}else this._failedHistoryFetchThreads[fb]=false;return nb;},getThreadMessagesSinceTimestamp:function(fb,gb){var hb=ta(this,fb),ib=hb.getElementsUntil(gb);return xa(this,ib);},hasLoadedAllMessages:function(fb){return ta(this,fb).hasReachedEndOfArray();},getCurrentlyLoadedMessages:function(fb){var gb=ta(this,fb).getAllResources();return xa(this,gb);},unsubscribe:function(fb,gb){m.isThreadID(gb);var hb=ta(this,gb);hb.unsubscribe(fb);},addAttachmentData:function(fb,gb,hb){var ib=na(this,fb);if(ib){var jb=ib.attachments.indexOf(gb);if(jb!=-1){ib.attachments[jb]=hb;this._threadInformer.updatedMessage(ib.thread_id,ib.message_id,'attach');}}else{if(!this._attachmentData[fb])this._attachmentData[fb]=[];this._attachmentData[fb].push({attach_key:gb,data:hb});}},shouldSortOutOfOrderMessages:function(fb,gb,hb){if(fb==t.CLIENT_CHANNEL_MESSAGE){var ib=this.getThreadMessagesSinceTimestamp(gb,hb);if(ib.length>0){h.bumpEntityKey('chat.web','channel.messages_reordered');return true;}}return false;},handleUpdates:function(fb,gb,hb,ib){var jb,kb={},lb={};for(var mb=0;mb<fb.length;mb++){var nb=fb[mb];if(nb.is_forward||hb==t.SERVER_SEARCH){if(!this._messages[nb.message_id]){this._messages[nb.message_id]=nb;cb(this,nb);}continue;}if(nb.client_state===r.SEND_TO_SERVER){this._messages[nb.message_id]=nb;cb(this,nb);continue;}var ob=nb.action_type;if(hb==t.CLIENT_CHANNEL_MESSAGE&&ob==l.USER_GENERATED_MESSAGE&&nb.threading_id&&this._localIdsMap[nb.threading_id]===nb.threading_id){nb.client_message_id=nb.threading_id;nb.status=k.SUCCESS;nb.action_type=l.SEND_MESSAGE;ob=nb.action_type;}if(ob==l.SEND_MESSAGE){var pb=nb.client_message_id;if(pb&&this._localIdsMap[pb]&&nb.status){var qb=na(this,pb),rb=qb.status;if(qb.status==k.SUCCESS)continue;if(nb.status==k.UNCONFIRMED){if(!lb[nb.thread_id])lb[nb.thread_id]=[];lb[nb.thread_id].push(pb);}else if(!kb[nb.thread_id])kb[nb.thread_id]=[];this.updateLocalMessage(nb,hb);if(typeof rb!==undefined||nb.status==k.FAILED_UNKNOWN_REASON||nb.status==k.UNABLE_TO_CONFIRM||nb.status==k.SUCCESS||nb.status==k.ERROR)this._threadInformer.updatedMessage(nb.thread_id,na(this,pb).message_id,hb);}continue;}else if(ob==l.DELETE_THREAD){ta(this,nb.thread_id).removeAllResources();continue;}else if(ob==l.DELETE_MESSAGES){var sb=nb.message_ids.map(function(zb){return na(this,zb).message_id;}.bind(this));jb=ta(this,nb.thread_id);jb.removeResources(sb);this._threadInformer.reorderedMessages(nb.thread_id,hb);continue;}else if(ob==l.LOG_MESSAGE){if(nb.log_message_type==q.SERVER_ERROR)this._failedHistoryFetchThreads[nb.thread_id]=true;}else if(ob==l.CLEAR_CHAT){var tb=ta(this,nb.thread_id).getAllResources();tb.map(na.bind(null,this)).forEach(function(zb){zb.is_cleared=true;});continue;}var ub=na(this,nb.message_id);if((nb.threading_id&&this._localIdsMap[nb.threading_id])||(ub&&!ub.is_forward))continue;if(!kb[nb.thread_id])kb[nb.thread_id]=[];kb[nb.thread_id].push(nb.message_id);this._messages[nb.message_id]=nb;cb(this,nb);if(nb.threading_id&&nb.threading_id!=nb.message_id)y.addServerID(nb.threading_id,nb.message_id);gb=gb||this.shouldSortOutOfOrderMessages(hb,nb.thread_id,nb.timestamp);if(!gb)this._threadInformer.receivedMessage(nb);}for(var vb in kb){jb=ta(this,vb);var wb=jb.getAllResources(),xb=wb.filter(function(zb){var ac=this._messages[zb];return ac.action_type==l.LOG_MESSAGE&&ac.log_message_type==q.SERVER_ERROR;}.bind(this));jb.removeResources(xb);ya(this,vb,kb[vb]);if(ib)za(this,vb,kb[vb]);if(gb){jb.addResources(kb[vb]);this._threadInformer.reorderedMessages(vb,hb);}else jb.addResourcesWithoutSorting(kb[vb].reverse(),0);this._threadInformer.updatedThread(vb);}var yb=Object.keys(lb);if(yb.length)this._serverRequests.requestMessageConfirmation(lb);},sendMessage:function(fb,gb,hb){var event=u.CLIENT_SEND_ATTEMPTED;if(fb.status===k.RESENDING)event=u.CLIENT_RESEND_ATTEMPTED;var ib=false;if(p.isValid(fb.thread_id))ib=!p.isMultichat(fb.thread_id);setTimeout(function(){u.log(event,fb.message_id,{canonical:ib});},0);gb=gb||Function.prototype;pa(this,fb);this._localIdsMap[fb.message_id]=fb.message_id;if(fb.thread_id=='root:'+fb.message_id)ta(this,fb.thread_id).setReachedEndOfArray();this._serverRequests.sendNewMessage(fb,hb);if(fb.thread_id==o.PENDING_THREAD_ID){this._messages[fb.message_id]=fb;return oa.executeOrEnqueue(fb.message_id,gb);}else gb(fb.thread_id);},isOutbound:function(fb){return fb.author==z.user;},isInbound:function(fb){return !this.isOutbound(fb);},isSending:function(fb){return (fb.status===k.UNSENT||fb.status===k.UNCONFIRMED||fb.status===k.UNABLE_TO_CONFIRM||fb.status===k.RESENDING);},isFirstMessage:function(fb){var gb=ta(this,fb.thread_id);if(gb.getCurrentArraySize()===0)return false;var hb=gb.getResourceAtIndex(gb.getCurrentArraySize()-1),ib=na(this,hb).message_id,jb=na(this,fb.message_id).message_id;return gb.hasReachedEndOfArray()&&ib==jb;},unsubscribeSend:function(fb){oa.unsubscribe(fb);},resendMessage:function(fb,gb){var hb=ga({},fb);hb.status=k.RESENDING;hb.timestamp=Date.now();hb.message_id=fb.message_id;this._messages[fb.message_id]=hb;var ib=ta(this,fb.thread_id);ib.resortResources([fb.message_id]);this.sendMessage(hb,null,gb);this._threadInformer.reorderedMessages(fb.thread_id,t.CLIENT_SEND_MESSAGE);},deleteMessages:function(fb,gb){if(gb.length){var hb=ta(this,fb),ib=hb.getCurrentArraySize()==gb.length&&hb.hasReachedEndOfArray();this._serverRequests.deleteMessages(fb,gb,ib);}},deleteLocalMessage:function(fb){if(this._localTitanMessagesCount[fb])this._localTitanMessagesCount[fb]--;},markMessagesSpam:function(fb,gb){if(gb.length){var hb=ta(this,fb),ib=hb.getCurrentArraySize()==gb.length&&hb.hasReachedEndOfArray();if(ib){this._serverRequests.markThreadSpam(fb);}else this._serverRequests.markMessagesSpam(fb,gb);}},updateLocalMessage:function(fb,gb){var hb=na(this,fb.client_message_id);hb.status=fb.status;if(fb.status===k.SUCCESS||fb.error_data)hb.error_data=fb.error_data;var ib=fb.message_id,jb=fb.client_message_id;if(this._messages[ib])return false;this._localIdsMap[jb]=ib;this._messages[ib]=this._messages[jb];y.addServerID(jb,ib);this._messages[jb]={};var kb=na(this,jb);if(fb.timestamp)kb.timestamp=fb.timestamp;if(fb.attachments&&fb.attachments.length){kb.raw_attachments=null;kb.attachments=fb.attachments;cb(this,kb,ib);}if(fb.log_message_data)kb.log_message_data=fb.log_message_data;if(ab(kb))this._localTitanMessagesCount[kb.thread_id]--;return true;},constructUserGeneratedMessageObject:function(fb,gb,hb,ib,jb){var kb=qa(this,l.USER_GENERATED_MESSAGE,gb,hb);if(typeof fb=='string')fb=fb.replace(/^\s+/,'').replace(/\s+$/,'');kb.body=fb;kb.has_attachment=false;kb.html_body=false;kb.attachments=[];kb.specific_to_list=ib||[];kb.creator_info=jb;return kb;},constructLogMessageObject:function(fb,gb,hb,ib){var jb=qa(this,l.LOG_MESSAGE,fb,gb);jb.log_message_type=hb;jb.log_message_data=ib;return jb;},generateNewClientMessageID:function(fb){var gb=fb+':'+(la(0,4294967295)+1)+'-'+aa.getSessionID();return '<'+gb+'@mail.projektitan.com>';},getNumberLocalMessages:function(fb){return this._localTitanMessagesCount[fb]||0;},_uploadMessages:{},updateNewMessage:function(fb,gb,hb){if(hb.preview_attachments.length>0){fb.has_attachment=true;fb.preview_attachments=hb.preview_attachments;}fb.client_state=r.DO_NOT_SEND_TO_SERVER;fb.status=k.RESENDING;this._uploadMessages[gb]=fb;return fb;},updateMessageAfterUpload:function(fb,gb){var hb=this._uploadMessages[fb];ja(hb);hb.image_ids=gb.image_ids;hb.client_state=r.SEND_TO_SERVER;return hb;},clearUploadedMessage:function(fb){delete this._uploadMessages[fb];}});ga(wa,v,{addAttachmentData:function(fb,gb,hb,ib){ib=ib||i.getID();wa.getForFBID(ib).addAttachmentData(fb,gb,hb);}});function xa(fb,gb){var hb=gb.map(na.bind(null,fb));return hb.reverse();}function ya(fb,gb,hb){var ib=hb.filter(function(jb){return ab(na(fb,jb));});if(!fb._titanMessagesCount[gb])fb._titanMessagesCount[gb]=0;fb._titanMessagesCount[gb]+=ib.length;}function za(fb,gb,hb){var ib=hb.filter(function(jb){return ab(na(fb,jb));});if(!fb._localTitanMessagesCount[gb])fb._localTitanMessagesCount[gb]=0;fb._localTitanMessagesCount[gb]+=ib.length;}function ab(fb){var gb=fb.action_type;if(gb==l.USER_GENERATED_MESSAGE)return true;switch(fb.log_message_type){case q.SUBSCRIBE:case q.UNSUBSCRIBE:case q.SERVER_ERROR:case q.LIVE_LISTEN:return false;default:return true;}}function bb(fb){switch(fb){case w.CHAT_WEB:case w.CHAT_JABBER:case w.CHAT_IPHONE:case w.CHAT_MEEBO:case w.CHAT_ORCA:case w.CHAT_TEST:case w.CHAT:case w.DESKTOP:return true;default:return false;}}function cb(fb,gb,hb){hb=hb||gb.message_id;var ib=fb._attachmentData[hb];if(ib){ib.forEach(function(jb){var kb=gb.attachments.indexOf(jb.attach_key);if(kb!==-1)gb.attachments[kb]=jb.data;});delete fb._attachmentData[hb];}else if(!gb.is_forward&&db(fb,gb)){fb._messagesNeedingAttachmentData[hb]=true;eb(fb);}}function db(fb,gb){if(!gb||!gb.attachments)return false;for(var hb=0;hb<gb.attachments.length;hb++){var ib=gb.attachments[hb];if(typeof ib==='string'&&ib.indexOf(n.SHARE)===0)return true;}var jb=gb.forward_message_ids||[];for(hb=0;hb<jb.length;hb++){var kb=na(fb,jb[hb]);if(db(fb,kb))return true;}return false;}var eb=ha(function(fb){var gb={};for(var hb in fb._messagesNeedingAttachmentData){var ib=na(fb,hb);if(db(fb,ib))gb[hb]=true;}var jb=Object.keys(gb);if(jb.length){var kb={message_ids:jb};if(fb._fbid!=i.getID())kb.request_user_id=fb._fbid;new g('/ajax/mercury/attachments/fetch_shares.php').setData(kb).setAllowCrossPageTransition(true).send();}fb._messagesNeedingAttachmentData={};},0,this);e.exports=wa;},null);
__d("MercuryChannelHandler",["Arbiter","ChannelConstants","MercuryActionTypeConstants","MercuryConfig","MercuryGlobalActionType","MercuryMessages","MercuryPayloadSource","MercurySingletonMixin","MercurySendLogger","MessagingReliabilityLogger","MessagingEvent","MessagingTag","MercuryParticipants","MercuryServerRequests","MercuryThreadInformer","PresenceUtil","copyProperties","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){var y=x(n);for(var z in y)if(y.hasOwnProperty(z))ba[z]=y[z];var aa=y===null?null:y.prototype;ba.prototype=Object.create(aa);ba.prototype.constructor=ba;ba.__superConstructor__=y;function ba(ca){"use strict";this.$MercuryChannelHandler0=ca;this.$MercuryChannelHandler1=t.getForFBID(this.$MercuryChannelHandler0);this.$MercuryChannelHandler2=u.getForFBID(this.$MercuryChannelHandler0);this.$MercuryChannelHandler3=l.getForFBID(this.$MercuryChannelHandler0);this.$MercuryChannelHandler4=[];}ba.prototype.$MercuryChannelHandler5=function(ca,da){"use strict";if(j.MercuryFBIDGK){this.$MercuryChannelHandler6(ca,da);}else this.$MercuryChannelHandler7(ca,da);};ba.prototype.$MercuryChannelHandler7=function(ca,da){"use strict";if(ca!=h.getArbiterType('messaging')||!da.obj||!da.obj.message){p.addEntry('channel_receive','invalid_data');return;}var ea=da.obj.message,fa={author:ea.mercury_author_id,author_email:ea.mercury_author_email,body:ea.body,subject:ea.subject,has_attachment:ea.has_attachment,attachments:ea.attachments,html_body:ea.html_body,thread_id:ea.tid,message_id:ea.mid,coordinates:ea.mercury_coordinates,is_spoof_warning:ea.is_spoof_warning,source:ea.mercury_source,source_tags:ea.mercury_source_tags,threading_id:ea.threading_id,timestamp:ea.timestamp,timestamp_absolute:ea.timestamp_absolute,timestamp_relative:ea.timestamp_relative,timestamp_time_passed:ea.timestamp_time_passed,action_type:i.USER_GENERATED_MESSAGE,is_unread:ea.is_unread,action_id:ea.action_id,is_forward:false,forward_count:ea.forward_count||ea.forward,forward_message_ids:ea.forward_msg_ids,location_text:ea.location_text,folder:da.obj.folder};if("sync_id" in ea){fa.sync_id=ea.sync_id;}else fa.action_id=ea.action_id;var ga=[w({},fa)];ga=ga.concat(ea.forward_actions||[]);var ha=m.CLIENT_CHANNEL_MESSAGE;this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:ga,payload_source:ha},ea.tid);if(!ea.is_unread&&ea.mercury_author_id===s.user){var ia={};ia[ea.tid]=da.obj.folder;this.$MercuryChannelHandler8(h.getArbiterType('messaging'),{obj:{event:q.READ,tids:[ea.tid],folder_info:ia,timestamp:ea.timestamp}});}if(ea.mercury_author_id===s.user)if(this.$MercuryChannelHandler3.getMessagesFromIDs([ea.threading_id]).length)o.log(o.CLIENT_CHANNEL_ECHO,ea.threading_id,{canonical:!ea.group_thread_info});p.addEntry('channel_receive','success',[fa.thread_id,fa.message_id,v.getSessionID()]);};ba.prototype.$MercuryChannelHandler6=function(ca,da){"use strict";if(ca!=h.getArbiterType('messaging')||!da.obj||!da.obj.message){p.addEntry('channel_receive','invalid_data');return;}var ea=da.obj.message,fa=ea.other_user_fbid?ea.other_user_fbid:ea.thread_fbid,ga={author:ea.mercury_author_id,author_email:ea.mercury_author_email,body:ea.body,subject:ea.subject,has_attachment:ea.has_attachment,attachments:ea.attachments,html_body:ea.html_body,thread_id:ea.tid,thread_fbid:ea.thread_fbid,other_user_fbid:ea.other_user_fbid,message_id:ea.mid,coordinates:ea.mercury_coordinates,is_spoof_warning:ea.is_spoof_warning,source:ea.mercury_source,source_tags:ea.mercury_source_tags,threading_id:ea.threading_id,timestamp:ea.timestamp,timestamp_absolute:ea.timestamp_absolute,timestamp_relative:ea.timestamp_relative,timestamp_time_passed:ea.timestamp_time_passed,action_type:i.USER_GENERATED_MESSAGE,is_unread:ea.is_unread,is_forward:false,forward_count:ea.forward_count||ea.forward,forward_message_ids:ea.forward_msg_ids,location_text:ea.location_text,folder:da.obj.folder};if("sync_id" in ea){ga.sync_id=ea.sync_id;}else ga.action_id=ea.action_id;var ha=[w({},ga)];ha=ha.concat(ea.forward_actions||[]);var ia=m.CLIENT_CHANNEL_MESSAGE;this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:ha,payload_source:ia},fa);if(!ea.is_unread&&ea.mercury_author_id===s.user){var ja={};ja[fa]=da.obj.folder;this.$MercuryChannelHandler8(h.getArbiterType('messaging'),{obj:{event:q.READ,thread_fbids:ea.thread_fbid?[ea.thread_fbid]:[],other_user_fbids:ea.other_user_fbid?[ea.other_user_fbid]:[],folder_info:ja,timestamp:ea.timestamp}});}if(ea.mercury_author_id===s.user)if(this.$MercuryChannelHandler3.getMessagesFromIDs([ea.threading_id]).length)o.log(o.CLIENT_CHANNEL_ECHO,ea.threading_id,{canonical:!ea.group_thread_info});p.addEntry('channel_receive','success',[fa,ga.message_id,v.getSessionID()]);};ba.prototype.$MercuryChannelHandler8=function(ca,da){"use strict";if(j.MercuryFBIDGK){this.$MercuryChannelHandler9(ca,da);}else this.$MercuryChannelHandlera(ca,da);};ba.prototype.$MercuryChannelHandlera=function(ca,da){"use strict";if(ca!=h.getArbiterType('messaging')||!da.obj||!da.obj.tids)return;var ea=[],fa=da.obj.event==q.READ;(da.obj.tids||[]).forEach(function(ga){ea.push({action_type:i.CHANGE_READ_STATUS,action_id:null,thread_id:ga,mark_as_read:fa,timestamp:da.obj.timestamp||0,folder:da.obj.folder_info[ga]});});this.$MercuryChannelHandler1.handleUpdate({actions:ea,payload_source:m.CLIENT_CHANNEL_MESSAGE});};ba.prototype.$MercuryChannelHandler9=function(ca,da){"use strict";if(ca!=h.getArbiterType('messaging')||!da.obj||(!da.obj.thread_fbids&&!da.obj.other_user_fbids))return;var ea=[],fa=da.obj.event==q.READ;(da.obj.thread_fbids||[]).forEach(function(ga){ea.push({action_type:i.CHANGE_READ_STATUS,action_id:null,thread_fbid:ga,mark_as_read:fa,timestamp:da.obj.timestamp||0,folder:da.obj.folder_info[ga]});});(da.obj.other_user_fbids||[]).forEach(function(ga){ea.push({action_type:i.CHANGE_READ_STATUS,action_id:null,other_user_fbid:ga,mark_as_read:fa,timestamp:da.obj.timestamp||0,folder:da.obj.folder_info[ga]});});this.$MercuryChannelHandler1.handleUpdate({actions:ea,payload_source:m.CLIENT_CHANNEL_MESSAGE});};ba.prototype.$MercuryChannelHandlerb=function(ca,da){"use strict";if(j.MercuryFBIDGK){this.$MercuryChannelHandlerc(ca,da);}else this.$MercuryChannelHandlerd(ca,da);};ba.prototype.$MercuryChannelHandlerd=function(ca,da){"use strict";if(ca!=h.getArbiterType('messaging')||!da.obj||!da.obj.tids)return;var ea=[];(da.obj.tids||[]).forEach(function(fa){ea.push({action_type:i.DELETE_THREAD,action_id:null,thread_id:fa});});this.$MercuryChannelHandler1.handleUpdate({actions:ea,payload_source:m.CLIENT_CHANNEL_MESSAGE});};ba.prototype.$MercuryChannelHandlerc=function(ca,da){"use strict";if(ca!=h.getArbiterType('messaging')||!da.obj||!(da.obj.thread_fbids||da.obj.other_user_fbids))return;var ea=[];(da.obj.thread_fbids||[]).forEach(function(fa){ea.push({action_type:i.DELETE_THREAD,action_id:null,thread_fbid:fa});});(da.obj.other_user_fbids||[]).forEach(function(fa){ea.push({action_type:i.DELETE_THREAD,action_id:null,other_user_fbid:fa});});this.$MercuryChannelHandler1.handleUpdate({actions:ea,payload_source:m.CLIENT_CHANNEL_MESSAGE});};ba.prototype.$MercuryChannelHandlere=function(ca,da){"use strict";if(j.MercuryFBIDGK){this.$MercuryChannelHandlerf(ca,da);}else this.$MercuryChannelHandlerg(ca,da);};ba.prototype.$MercuryChannelHandlerg=function(ca,da){"use strict";if(ca!=h.getArbiterType('messaging')||!da.obj||!da.obj.tids||!da.obj.mids)return;var ea=da.obj.tids[0],fa={action_type:i.DELETE_MESSAGES,action_id:null,thread_id:ea,message_ids:da.obj.mids};this.$MercuryChannelHandler1.handleUpdate({actions:[fa],threads:[da.obj.updated_thread],payload_source:m.CLIENT_CHANNEL_MESSAGE});};ba.prototype.$MercuryChannelHandlerf=function(ca,da){"use strict";if(ca!=h.getArbiterType('messaging')||!da.obj||(!da.obj.thread_fbids&&!da.obj.other_user_fbids)||!da.obj.mids)return;var ea=da.obj.thread_fbids.length?da.obj.thread_fbids[0]:null,fa=da.obj.other_user_fbids.length?da.obj.other_user_fbids[0]:null,ga={action_type:i.DELETE_MESSAGES,action_id:null,thread_fbid:ea,other_user_fbid:fa,message_ids:da.obj.mids};this.$MercuryChannelHandler1.handleUpdate({actions:[ga],threads:[da.obj.updated_thread],payload_source:m.CLIENT_CHANNEL_MESSAGE});};ba.prototype.$MercuryChannelHandlerh=function(ca,da){"use strict";if(ca!=h.getArbiterType('messaging')||!da.obj||!da.obj.folder)return;var ea={action_type:k.MARK_ALL_READ,action_id:da.obj.action_id,folder:da.obj.folder};this.$MercuryChannelHandler1.handleUpdate({global_actions:[ea]});};ba.prototype.$MercuryChannelHandleri=function(ca,da){"use strict";if(j.MercuryFBIDGK){this.$MercuryChannelHandlerj(ca,da);}else this.$MercuryChannelHandlerk(ca,da);};ba.prototype.$MercuryChannelHandlerk=function(ca,da){"use strict";if(ca!=h.getArbiterType('messaging')||!da.obj.tids)return;var ea=m.CLIENT_CHANNEL_MESSAGE;(da.obj.tids||[]).forEach(function(fa){var ga={action_type:i.CHANGE_ARCHIVED_STATUS,action_id:null,thread_id:fa,archived:da.obj.state};this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:[w({},ga)],payload_source:ea},fa);},this);};ba.prototype.$MercuryChannelHandlerj=function(ca,da){"use strict";if(ca!=h.getArbiterType('messaging')||(!da.obj.thread_fbids&&!da.obj.other_user_fbids))return;var ea=m.CLIENT_CHANNEL_MESSAGE;(da.obj.thread_fbids||[]).forEach(function(fa){var ga={action_type:i.CHANGE_ARCHIVED_STATUS,action_id:null,thread_fbid:fa,other_user_fbid:null,archived:da.obj.state};this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:[w({},ga)],payload_source:ea},fa);},this);(da.obj.other_user_fbids||[]).forEach(function(fa){var ga={action_type:i.CHANGE_ARCHIVED_STATUS,action_id:null,thread_fbid:null,other_user_fbid:fa,archived:da.obj.state};this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:[w({},ga)],payload_source:ea},fa);},this);};ba.prototype.$MercuryChannelHandlerl=function(ca,da){"use strict";if(j.MercuryFBIDGK){this.$MercuryChannelHandlerm(ca,da);}else this.$MercuryChannelHandlern(ca,da);};ba.prototype.$MercuryChannelHandlern=function(ca,da){"use strict";if(ca!=h.getArbiterType('messaging')||!da.obj.tids)return;var ea=m.CLIENT_CHANNEL_MESSAGE,fa;(da.obj.tids||[]).forEach(function(ga){if(da.obj.event==q.TAG){fa=da.obj.tag;}else fa=da.obj.marked_as_spam?r.SPAM:r.INBOX;var ha={action_type:i.CHANGE_FOLDER,action_id:null,thread_id:ga,new_folder:fa};this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:[w({},ha)],payload_source:ea},ga);},this);};ba.prototype.$MercuryChannelHandlerm=function(ca,da){"use strict";if(ca!=h.getArbiterType('messaging')||(!da.obj.thread_fbids&&!da.obj.other_user_fbids))return;var ea=m.CLIENT_CHANNEL_MESSAGE,fa;(da.obj.thread_fbids||[]).forEach(function(ga){if(da.obj.event==q.TAG){fa=da.obj.tag;}else fa=da.obj.marked_as_spam?r.SPAM:r.INBOX;var ha={action_type:i.CHANGE_FOLDER,action_id:null,thread_fbid:ga,other_user_fbid:null,new_folder:fa};this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:[w({},ha)],payload_source:ea},ga);},this);(da.obj.other_user_fbids||[]).forEach(function(ga){if(da.obj.event==q.TAG){fa=da.obj.tag;}else fa=da.obj.marked_as_spam?r.SPAM:r.INBOX;var ha={action_type:i.CHANGE_FOLDER,action_id:null,other_user_fbid:ga,thread_fbid:null,new_folder:fa};this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:[w({},ha)],payload_source:ea},ga);},this);};ba.prototype.$MercuryChannelHandlero=function(ca,da){"use strict";if(ca!=h.getArbiterType('messaging')||!da.obj.tag)return;switch(da.obj.tag){case r.ACTION_ARCHIVED:this.$MercuryChannelHandleri(ca,da);break;case r.INBOX:case r.OTHER:this.$MercuryChannelHandlerl(ca,da);break;}};ba.prototype.$MercuryChannelHandlerp=function(ca,da){"use strict";if(j.MercuryFBIDGK){this.$MercuryChannelHandlerq(ca,da);}else this.$MercuryChannelHandlerr(ca,da);};ba.prototype.$MercuryChannelHandlerr=function(ca,da){"use strict";if(ca!=h.getArbiterType('inbox')||!da.obj||!da.obj.seen_timestamp)return;this.$MercuryChannelHandler1.handleUpdate({message_counts:[{seen_timestamp:da.obj.seen_timestamp,folder:r.INBOX}],unseen_thread_ids:[{thread_ids:[],folder:r.INBOX}],payload_source:m.CLIENT_CHANNEL_MESSAGE});};ba.prototype.$MercuryChannelHandlerq=function(ca,da){"use strict";if(ca!=h.getArbiterType('inbox')||!da.obj||!da.obj.seen_timestamp)return;this.$MercuryChannelHandler1.handleUpdate({message_counts:[{seen_timestamp:da.obj.seen_timestamp,folder:r.INBOX}],unseen_thread_fbids:[{thread_fbids:[],other_user_fbids:[],folder:r.INBOX}],payload_source:m.CLIENT_CHANNEL_MESSAGE});};ba.prototype.$MercuryChannelHandlers=function(ca,da){"use strict";if(ca!=h.getArbiterType('mercury')||!da.obj)return;this.$MercuryChannelHandler2.synchronizeInforms(function(){var ea=da.obj,fa=[];(ea.actions||[]).forEach(function(ga){var ha=i.USER_GENERATED_MESSAGE;if(ga.action_type==i.LOG_MESSAGE){var ia=m.CLIENT_CHANNEL_MESSAGE,ja;if(j.MercuryFBIDGK){ja=ga.other_user_fbid||ga.thread_fbid;}else ja=ga.thread_id;this.$MercuryChannelHandler1.handleUpdateWaitForThread({actions:[w({},ga)],payload_source:ia},ja);}else if(ga.action_type!=ha)fa.push(ga);},this);ea.actions=fa;ea.payload_source=m.CLIENT_CHANNEL_MESSAGE;this.$MercuryChannelHandler1.handleUpdate(ea);}.bind(this));};ba.prototype.$MercuryChannelHandlert=function(ca,da){"use strict";this.$MercuryChannelHandler1.handleRoger(da.obj);};ba.prototype.$MercuryChannelHandleru=function(ca,da){"use strict";if(j.MercuryFBIDGK){this.$MercuryChannelHandlerv(ca,da);}else this.$MercuryChannelHandlerw(ca,da);};ba.prototype.$MercuryChannelHandlerw=function(ca,da){"use strict";if(ca!=h.getArbiterType('messaging')||!da.obj||da.obj.mute_settings===undefined||!da.obj.thread_id)return;var ea=i.CHANGE_MUTE_SETTINGS,fa=[{action_type:ea,action_id:null,thread_id:da.obj.thread_id,mute_settings:da.obj.mute_settings}];this.$MercuryChannelHandler1.handleUpdate({actions:fa,payload_source:m.CLIENT_CHANNEL_MESSAGE});};ba.prototype.$MercuryChannelHandlerv=function(ca,da){"use strict";if(ca!=h.getArbiterType('messaging')||!da.obj||da.obj.mute_settings===undefined||(!da.obj.thread_fbid&&!da.obj.other_user_fbid))return;var ea=i.CHANGE_MUTE_SETTINGS,fa=[{action_type:ea,action_id:null,thread_fbid:da.obj.thread_fbid,other_user_fbid:da.obj.other_user_fbid,mute_settings:da.obj.mute_settings}];this.$MercuryChannelHandler1.handleUpdate({actions:fa,payload_source:m.CLIENT_CHANNEL_MESSAGE});};ba.prototype.$MercuryChannelHandlerx=function(ca,da){"use strict";switch(da.obj.event){case q.DELIVER:this.$MercuryChannelHandler5(ca,da);break;case q.READ:case q.UNREAD:this.$MercuryChannelHandler8(ca,da);break;case q.READ_ALL:this.$MercuryChannelHandlerh(ca,da);break;case q.DELETE:this.$MercuryChannelHandlerb(ca,da);break;case q.DELETE_MESSAGES:this.$MercuryChannelHandlere(ca,da);break;case q.TAG:this.$MercuryChannelHandlero(ca,da);break;case q.REPORT_SPAM:this.$MercuryChannelHandlerl(ca,da);break;case q.READ_RECEIPT:this.$MercuryChannelHandlert(ca,da);break;case q.CHANGE_MUTE_SETTINGS:this.$MercuryChannelHandleru(ca,da);break;}};ba.prototype.turnOn=function(){"use strict";if(!this.$MercuryChannelHandler4.length){var ca={mercury:this.$MercuryChannelHandlers,messaging:this.$MercuryChannelHandlerx,inbox:this.$MercuryChannelHandlerp};for(var da in ca)this.$MercuryChannelHandler4.push(g.subscribe(h.getArbiterType(da),ca[da].bind(this)));}};ba.prototype.turnOff=function(){"use strict";if(this.$MercuryChannelHandler4.length){this.$MercuryChannelHandler4.forEach(g.unsubscribe);this.$MercuryChannelHandler4=[];}};w(ba,n);e.exports=ba;},null);
__d("MercuryRoger",["Arbiter","ArbiterMixin","JSLogger","MercuryActionStatus","copyProperties","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k){var l=b('MercuryServerRequests').get(),m=b('MercuryThreads').get(),n={},o=[],p={getSeenBy:function(q,r){if(!q)return [];var s=[],t=n[q.thread_id],u=j.SUCCESS;for(var v in t)if(t[v]>q.timestamp&&(q.status===undefined||q.status===u)&&(!r||v!=q.author))s.push(v);return s;},getSeenTimestamp:function(q,r){var s=n[q];return s?s[r]:null;}};k(p,h);l.subscribe('update-roger',function(q,r){for(var s in r){if(!n[s])n[s]={};for(var t in r[s]){var u=m.getThreadMetaNow(s);if(u&&u.participants)if(u.participants.indexOf(t)==-1){o.push(n);continue;}var v=n[s][t],w=r[s][t];if(!v||w>v)n[s][t]=w;}}if(r)p.inform('state-changed',r);});g.subscribe(i.DUMP_EVENT,function(q,r){r.bad_read_receipts={receipts:o};});e.exports=p;},null);
__d("MercuryDelayedRoger",["ArbiterMixin","LiveTimer","MercuryActionStatus","MercuryConfig","MercuryRoger","copyProperties","setTimeoutAcrossTransitions","MercuryMessages","MercuryThreadInformer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=b('MercuryMessages').get(),o=b('MercuryThreadInformer').get(),p=b('MercuryThreads').get(),q={},r={},s=j['roger.seen_delay'],t=l({getSeenBy:function(x,y){if(r[x])return [];if(!q[x]){var z=p.getThreadMetaNow(x);if(z)q[x]={thread_id:x,author:z.participants[0],timestamp:z.timestamp};}return k.getSeenBy(q[x],y);}},g);function u(x){var y=false;n.getThreadMessagesRange(x,0,1,function(z){var aa=z[0];if(!aa)return;var ba=aa.timestamp;if(aa.action_id||aa.status==i.SUCCESS)ba-=h.getServerTimeOffset();var ca=t.getSeenBy(x);if(r[x]){clearTimeout(r[x]);delete r[x];}var da=ba+s,ea=da-Date.now();if(ea>0)r[x]=m(function(){delete r[x];v(x);},ea);q[x]=aa;var fa=t.getSeenBy(x);if(ca.length||fa.length)y=true;});return y;}function v(x){var y={};y[x]=true;t.inform('state-changed',y);}function w(event,x){var y={};for(var z in x)if(u(z))y[z]=true;for(var aa in y){t.inform('state-changed',y);break;}}k.subscribe('state-changed',function(x,y){for(var z in y)!r[z]&&v(z);});o.subscribe('messages-received',w);o.subscribe('messages-reordered',w);o.subscribe('messages-updated',w);e.exports=t;},null);
__d("MercuryUnseenState",["KeyedCallbackManager","LogHistory","MercuryActionTypeConstants","MercuryConfig","MercurySingletonMixin","MercuryThreadlistConstants","MessagingTag","ReportState","MercuryServerRequests","MercuryThreadInformer","MercuryThreadMuter","MercuryThreads","copyProperties","createObjectFrom","isEmpty"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){var v=l.MAX_UNSEEN_COUNT,w='unseen_thread_hash',x='unseen_thread_list',y=h.getInstance('mercury_unseen_state');function z(oa){this._fbid=oa;this._serverRequests=o.getForFBID(this._fbid);this._threads=r.getForFBID(this._fbid);this._threadInformer=p.getForFBID(this._fbid);this._initialUnseenCount=null;this._lastSeenTimestamp=0;this._maxCount=false;this._unseenResources=new g();this._serverRequests.subscribe('update-unseen',function(pa,qa){ea(this,qa);}.bind(this));this._serverRequests.subscribe('update-thread-ids',function(pa,qa){ma(this,qa);}.bind(this));}s(z.prototype,{getUnseenCount:function(){if(this.exceedsMaxCount()){y.error('unguarded_unseen_count_fetch',{});return 0;}return da(this)||0;},exceedsMaxCount:function(){return this._maxCount||(da(this)>v);},markAsSeen:function(){var oa=da(this);if(oa===null||oa>0||this._maxCount){this._serverRequests.markSeen();var pa=this._serverRequests.getLastActionTimestamp();ha(this,pa,[]);}},markThreadSeen:function(oa,pa){var qa={};qa[oa]=0;ja(this,qa,pa);}});s(z,k);function aa(oa,pa){oa._unseenResources.setResource(w,pa);oa._unseenResources.setResource(x,Object.keys(pa));}function ba(oa,pa){var qa=oa._unseenResources.executeOrEnqueue(w,pa),ra=oa._unseenResources.getUnavailableResources(qa);if(ra.length)oa._serverRequests.fetchUnseenThreadIDs();}function ca(oa){return oa._unseenResources.getResource(w);}function da(oa){var pa=oa._unseenResources.getResource(x);if(pa){return pa.length;}else return oa._initialUnseenCount;}function ea(oa,pa){if(j.MercuryFBIDGK){ga(oa,pa);}else fa(oa,pa);}function fa(oa,pa){var qa=na(pa);if(pa.unseen_thread_ids){pa.unseen_thread_ids.forEach(function(bb){if(bb.folder!=m.INBOX)return;var cb=la(oa,bb.thread_ids),db=oa._lastSeenTimestamp;if(qa&&qa.seen_timestamp)db=qa.seen_timestamp;ha(oa,db,cb);if(qa&&qa.unseen_count>v)oa._maxCount=true;});}else if(qa&&qa.seen_timestamp){oa._lastSeenTimestamp=qa.seen_timestamp;if(qa.unseen_count>v){oa._maxCount=true;aa(oa,{});}else{oa._initialUnseenCount=qa.unseen_count;if(oa._initialUnseenCount===0)aa(oa,{});}}else{if(oa._maxCount)return;var ra=pa.actions;if(!ra||!(ra.length))return;var sa={},ta={};for(var ua=0;ua<ra.length;ua++){var va=ra[ua];if(va.is_forward)continue;var wa=va.action_type,xa=va.thread_id?va.thread_id:va.server_thread_id,ya=va.folder===undefined||va.folder==m.INBOX;if(!ya)continue;if(wa==i.USER_GENERATED_MESSAGE||wa==i.LOG_MESSAGE){var za=sa[xa]?va.timestamp>sa[xa]:false,ab=za||!sa[xa];if(va.is_unread&&ab)oa._threads.getThreadMeta(xa,function(bb){var cb=false;if(bb&&bb.last_read_timestamp)if(bb.last_read_timestamp>=va.timestamp)cb=true;if(!q.isThreadMuted(bb)&&!cb)sa[xa]=va.timestamp;});}else if(wa==i.CHANGE_READ_STATUS&&va.mark_as_read)ta[xa]=va.timestamp;}ia(oa,sa);ja(oa,ta);}}function ga(oa,pa){var qa=na(pa);if(pa.unseen_thread_fbids){pa.unseen_thread_fbids.forEach(function(cb){if(cb.folder!=m.INBOX)return;var db=cb.thread_fbids||[];db=db.concat(cb.other_user_fbids||[]);var eb=la(oa,db),fb=oa._lastSeenTimestamp;if(qa&&qa.seen_timestamp)fb=qa.seen_timestamp;ha(oa,fb,eb);if(qa&&qa.unseen_count>v)oa._maxCount=true;});}else if(qa&&qa.seen_timestamp){oa._lastSeenTimestamp=qa.seen_timestamp;if(qa.unseen_count>v){oa._maxCount=true;aa(oa,{});}else{oa._initialUnseenCount=qa.unseen_count;if(oa._initialUnseenCount===0)aa(oa,{});}}else{if(oa._maxCount)return;var ra=pa.actions;if(!ra||!(ra.length))return;var sa={},ta={};for(var ua=0;ua<ra.length;ua++){var va=ra[ua];if(va.is_forward)continue;var wa=va.action_type,xa=va.other_user_fbid?va.other_user_fbid:va.thread_fbid,ya=va.thread_id?va.thread_id:xa,za=va.folder===undefined||va.folder==m.INBOX;if(!za)continue;if(wa==i.USER_GENERATED_MESSAGE||wa==i.LOG_MESSAGE){var ab=sa[ya]?va.timestamp>sa[ya]:false,bb=ab||!sa[ya];if(va.is_unread&&bb)oa._threads.getThreadMeta(ya,function(cb){var db=false;if(cb&&cb.last_read_timestamp)if(cb.last_read_timestamp>=va.timestamp)db=true;if(!q.isThreadMuted(cb)&&!db)sa[ya]=va.timestamp;});}else if(wa==i.CHANGE_READ_STATUS&&va.mark_as_read)ta[ya]=va.timestamp;}ia(oa,sa);ja(oa,ta);}}function ha(oa,pa,qa){var ra=ca(oa);if(ra===undefined||pa>oa._lastSeenTimestamp||oa._maxCount){oa._lastSeenTimestamp=pa;qa=qa||[];if(qa.length<=v)oa._maxCount=false;var sa={},ta=ca(oa)||{};for(var ua in ta)if(ta[ua]!==true){var va=ta[ua];if(ka(oa,va))sa[ua]=va;}var wa=s(t(qa,true),sa);aa(oa,wa);oa._threadInformer.updatedUnseenState();}}function ia(oa,pa){if(oa._maxCount)return;var qa={},ra=false;for(var sa in pa){var ta=pa[sa];if(ka(oa,ta)){qa[sa]=ta;ra=true;}}if(!ra)return;ba(oa,function(ua){for(var va in qa){var wa=qa[va];if(!ua[va]&&ka(oa,wa))ua[va]=qa[va];}aa(oa,ua);oa._threadInformer.updatedUnseenState();});}function ja(oa,pa,qa){var ra=false;if(!u(pa))ra=true;if(ra)ba(oa,function(sa){var ta=false;for(var ua in pa){var va=pa[ua],wa=va>sa[ua];if(sa[ua]&&(!va||wa)){delete sa[ua];ta=true;}}if(ta){aa(oa,sa);oa._threadInformer.updatedUnseenState();if(qa&&da(oa)===0)oa._serverRequests.markSeen();}});}function ka(oa,pa){return pa>oa._lastSeenTimestamp;}function la(oa,pa){return pa.map(oa._serverRequests.convertThreadIDIfAvailable,oa._serverRequests);}function ma(oa,pa){var qa=ca(oa);if(!qa)return;for(var ra in pa){var sa=pa[ra];if(qa[ra]){qa[sa]=qa[ra];delete qa[ra];}}aa(oa,qa);}function na(oa){var pa=(oa.message_counts||[]);for(var qa=0;qa<pa.length;qa++)if(pa[qa].folder==m.INBOX)return pa[qa];return null;}n.registerCallback('mercury-unseen-state',function(){var oa={};oa.unseen={};oa.unseen_max_count={};oa.unseen_time={};var pa=z._getInstances();for(var qa in pa){oa.unseen[qa]=s({},ca(pa[qa]));oa.unseen_max_count[qa]=pa[qa]._maxCount;oa.unseen_time[qa]=pa[qa]._lastSeenTimestamp;}return oa;});e.exports=z;},null);
__d("MercuryThreadMetadataRawRenderer",["Event","CSS","DOM","MercuryActionStatus","MercuryErrorInfo","MessagingTag","MercuryStatusTemplates","Tooltip","URI","WebMessengerPermalinkConstants","WWWBase","cx","tx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){var u={renderParticipantListWithNoThreadName:function(v,w,x,y,z,aa){var ba={callback:true,check_length:true,show_unread_count:true};aa=aa||{};var ca={};for(var da in aa)if(ba[da]){ca[da]=aa[da];delete aa[da];}var ea=x.map(function(ja){return y[ja];}),fa=this.renderRawParticipantList(v,ea,x.length,aa);fa=this.renderRawTitleWithUnreadCount(fa,ca.show_unread_count?w.unread_count:0);var ga=aa.abbr_mode,ha={};for(var ia in aa)ha[ia]=aa[ia];ha.abbr_mode=true;z.forEach(function(ja){var ka=z.length>1?this._cloneIfDOMElement(fa):fa;i.setContent(ja,ka);if(ca.check_length&&!ga&&ja.scrollWidth>ja.clientWidth){var la=this.renderRawParticipantList(v,ea,x.length,ha),ma=this.renderRawTitleWithUnreadCount(la,ca.show_unread_count?w.unread_count:0);i.setContent(ja,ma);}}.bind(this));ca.callback&&ca.callback(fa);},renderRawParticipantList:function(v,w,x,y){var z={abbr_mode:true,last_separator_uses_and:true,names_renderer:true};y=y||{};var aa=null;if(y.names_renderer){aa=y.names_renderer(w);}else aa=w.map(function(da){return da.name;});var ba=null;if(aa.length===0){if(!v){ba="New Message";}else ba="No Participants";}else if(aa.length==1){ba=aa[0];}else if(aa.length==2){var ca={participant1:aa[0],participant2:aa[1]};if(y.last_separator_uses_and){ba=s._("{participant1} and {participant2}",ca);}else ba=s._("{participant1}, {participant2}",ca);}else if(y.last_separator_uses_and){if(y.abbr_mode){ba=s._("{participant1} and {others_link}",{participant1:aa[0],others_link:this.renderRawParticipantCount(v,{render_subset:true,count:x-1})});}else if(aa.length==3){ba=s._("{participant1}, {participant2} and {participant3}",{participant1:aa[0],participant2:aa[1],participant3:aa[2]});}else ba=s._("{participant1}, {participant2} and {others_link}",{participant1:aa[0],participant2:aa[1],others_link:this.renderRawParticipantCount(v,{render_subset:true,count:x-2})});}else if(aa.length==3){ba=s._("{participant1}, {participant2}, {participant3}",{participant1:aa[0],participant2:aa[1],participant3:aa[2]});}else ba=s._("{participant1}, {participant2}, {participant3}, {others_link}",{participant1:aa[0],participant2:aa[1],participant3:aa[2],others_link:this.renderRawParticipantCount(v,{render_subset:true,count:x-3})});if(Array.isArray(ba))ba=i.create('span',{},ba);return ba;},renderRawTitleWithUnreadCount:function(v,w){var x=v;if(w&&w>1)x=i.create('span',{},s._("{conversation_title} ({unread_count})",{conversation_title:v,unread_count:w}));return x;},renderRawParticipantCount:function(v,w){var x=w.render_subset,y;if(!x){y=w.count>1?s._("{num} people",{num:w.count}):"1 person";}else y=w.count>1?s._("{others_count} others",{others_count:w.count}):"1 other";return y;},renderShortNames:function(v){if(v.length==1)return [v[0].name];return v.map(function(w){return w.short_name;});},renderStatusIndicator:function(v,w,x){var y;if(v==j.RESENDING){y=this.renderResendIndicator();}else if(v!==undefined&&v!=j.UNSENT&&v!=j.UNCONFIRMED&&v!=j.SUCCESS)y=this.renderErrorIndicator(w,x);return y;},renderResendIndicator:function(){return m[':fb:mercury:resend-indicator'].render();},renderErrorIndicator:function(v,w){if(!v)return null;var x=m[':fb:mercury:error-indicator'].render(),y=v.is_transient,z=k.getMessage(v);if(y)if(k.isConnectionError(v)){z=t._("{message} Check your internet connection and click to try again.",[t.param("message",z)]);}else z=t._("{message} Click to send again.",[t.param("message",z)]);n.set(x,z,'above','center');if(w&&y){g.listen(x,'click',w);x.setAttribute('tabindex','0');h.addClass(x,"_55q-");}return x;},_cloneIfDOMElement:function(v){if(v&&v.cloneNode){return v.cloneNode();}else return v;}};e.exports=u;},null);
__d("MercurySeenByAll",["CSS","DataStore","DOM","MercuryParticipants","MercuryDelayedRoger","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k){var l=b('MercuryThreads').get(),m={},n={updateOnSeenChange:function(p,q,r){m[p.tagName]=true;h.set(p,'thread-id',q.thread_id);g.addClass(p,'seenByListener');o(p,q,r);}};function o(p,q,r){var s=null;if(r){s=j.getIDFromVanityOrFBID(r);}else s=j.user;var t=q.participants.filter(function(v){return v!==s;}),u=q.participants.length>0&&q.participants[0]===s;g.conditionClass(p,'repliedLast',u);g.conditionClass(p,'seenByAll',u&&k.getSeenBy(q.thread_id).length===t.length);}k.subscribe('state-changed',function(p,q){for(var r in m){var s=i.scry(document.body,r+'.seenByListener');for(var t=0;t<s.length;t++){var u=s[t],v=h.get(u,'thread-id');if(q[v])l.getThreadMeta(v,function(w){o(u,w);});}}});e.exports=n;},null);
__d("MercuryThreadMetadataRenderer",["CSS","DOM","Emoji","EmoticonsList","HTML","JSLogger","MercuryAttachment","MercuryAttachmentType","MercuryConstants","MercuryMessageSourceTags","MercurySingletonMixin","MercuryThreadImage.react","MercuryThreadMetadataRawRenderer","MercuryThreadTitle.react","MercuryParticipants","React","MercurySeenByAll","MercuryServerRequests","StickerConstants","Style","MercuryThreadlistIconTemplates","MercuryThreads","Tooltip","URI","WebMessengerThreadPermalinks","arrayContains","createArrayFrom","copyProperties","cx","emojiAndEmote","fbt","formatDate","tx","OrionMercuryAttachmentStrings"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma){var na=b('OrionMercuryAttachmentStrings').module,oa=l.create('wm_timestamp');function pa(wa){this._fbid=wa;this._serverRequests=x.getForFBID(wa);this._threads=ba.getForFBID(wa);}ha(pa,q);ha(pa.prototype,{renderTimestamp:function(wa,xa,ya,za){if(za){if(!xa){oa.warn('no_title');xa=(new Date(za)).toLocaleDateString();}wa.setAttribute('title',xa);wa.setAttribute('data-utime',za/1000);if(!ya){oa.warn('no_display');ya=la(new Date(za),'g:ia');}h.setContent(wa,ya);g.show(wa);}},renderMessageSourceTags:function(wa,xa,ya,za){var ab='',bb='',cb='';if(fa(ya,p.MESSENGER)){ab="Sent from Messenger";bb=new da('/mobile/messenger');cb="_9g";}else if(fa(ya,p.MOBILE)){ab="Sent from Mobile";bb=new da('/mobile/');cb="_9j";}else if(fa(ya,p.CHAT)){ab="Sent from chat";cb="_9h";}else if(fa(ya,p.EMAIL)){if(za){ab=ma._("Sent from {email}",{email:za});}else ab="Sent from email";cb="_9i";}if(cb){ca.set(wa,ab);g.addClass(xa,cb);if(bb){wa.setAttribute('href',bb);}else wa.removeAttribute('href');}else g.hide(wa);},renderMessageLocation:function(wa,xa,ya){var za=da('/ajax/messaging/hovercard/map.php').setQueryData(ya);wa.setAttribute('data-hovercard',za);g.removeClass(wa,"_b9");g.show(xa);},renderSpoofWarning:function(wa,xa,ya){if(xa){g.addClass(wa,"_sa");ca.set(wa,ma._("Unable to confirm {name_or_email} as the sender.",{name_or_email:ya.name}));}},renderChatSpoofWarning:function(wa,xa,ya){if(xa)h.appendContent(wa,ma._("Unable to confirm {name_or_email} as the sender.",{name_or_email:ya.name}));},renderCoreThreadlist:function(wa,xa,ya,za,ab){za=za||{};this.renderThreadImage(wa,xa.getNode('image'));var bb=xa.getNode('accessibleName'),cb=[xa.getNode('name')];if(bb)cb.push(bb);va(this,wa,cb,za);if(wa.folder&&ab)ua(xa.getNode('folderBadge'),wa.folder);var db=xa.getNode('timestamp');this.renderTimestamp(db,wa.timestamp_absolute,wa.timestamp_relative,wa.timestamp);this.renderSnippet(wa,xa.getNode('snippet'));ra(xa,wa);ya(xa,wa);},renderAndSeparatedParticipantList:function(wa,xa,ya){ya=ya||{};ya.last_separator_uses_and=true;this._threads.getThreadMeta(wa,function(za){va(this,za,xa,ya);}.bind(this));},renderSnippet:function(wa,xa){var ya=false,za=h.create('span');g.addClass(za,'MercuryRepliedIndicator');h.appendContent(xa,za);w.updateOnSeenChange(za,wa,this._fbid);var ab=wa.snippet;if(ab){if(wa.snippet_has_attachment)h.appendContent(xa,h.create('span',{className:'MercuryAttachmentIndicator'}));if(wa.is_forwarded_snippet)h.appendContent(xa,h.create('strong',{className:"_55q_"},"Forwarded Message:"));if(ab.substr(0,4)=='?OTR'){ab="[encrypted message]";}else ab=ab.replace(/\r\n|[\r\n]/g," ");ab=k(i.htmlEmojiAndEmote(ab));}else{if(wa.is_forwarded_snippet)h.appendContent(xa,h.create('strong',{className:"_55q_"},"Forwarded Message"));if(wa.snippet_has_attachment&&wa.snippet_attachments&&wa.snippet_attachments.length){ya=true;ab=h.create('span');ta(this,wa,ab);}}var bb=wa.participants.length;if(wa.is_subscribed)bb--;if(!ya&&wa.snippet_sender&&u.getIDForUser(this._fbid)!=wa.snippet_sender&&bb>1){u.get(wa.snippet_sender,function(cb){if(cb.short_name){h.appendContent(xa,ma._("{name}: {conversation_snippet}",{name:cb.short_name,conversation_snippet:ab}));}else h.appendContent(xa,ab);});}else h.appendContent(xa,ab);},renderWebMessengerLink:function(wa,xa,ya,za){ea.getThreadURI(wa,function(ab){xa.setAttribute('href',ab);ya&&ya();},za);},renderThreadImage:function(wa,xa){v.renderComponent(v.createElement(r,{thread:wa,viewer:this._fbid}),xa);},renderParticipantList:function(wa,xa,ya,za){return s.renderRawParticipantList(this._serverRequests.getServerThreadIDNow(wa),xa,ya,za);},renderThreadNameAndParticipantList:function(wa,xa,ya,za){var ab=s.renderRawParticipantList(this._serverRequests.getServerThreadIDNow(wa),xa,ya,za),bb=this._threads.getThreadMetaNow(wa);if(!bb.name)return ab;return ma._("{conversation_name} [with {participant_list}]",{conversation_name:bb.name,participant_list:ab});},renderParticipantCount:function(wa,xa){return s.renderRawParticipantCount(this._serverRequests.getServerThreadIDNow(wa),xa);}});function qa(wa){if(!wa.snippet_attachments)return [];return wa.snippet_attachments.filter(function(xa){return xa.attach_type===n.PHOTO;});}function ra(wa,xa){var ya=qa(xa);if(ya.length===0)return;var za=ya[0].thumbnail_url;if(!za)return;var ab=(ya.length==1)?'snippet-thumbnail-single':'snippet-thumbnail-multiple',bb=wa.getNode(ab);if(!bb)return;var cb=h.find(bb,'i');z.set(cb,'background-image','url('+za+')');g.show(bb);}function sa(wa){return wa==y.LIKE_STICKER_ID||wa==y.HOT_LIKE_SMALL_STICKER_ID||wa==y.HOT_LIKE_MEDIUM_STICKER_ID||wa==y.HOT_LIKE_LARGE_STICKER_ID;}function ta(wa,xa,ya){var za=xa.snippet_sender&&u.getIDForUser(wa._fbid)==xa.snippet_sender,ab=function(jb){if(!xa.snippet_sender||za){jb(null);return;}u.get(xa.snippet_sender,function(kb){jb(kb.short_name);});},bb=o.MercurySupportedShareType.FB_ORION,cb=qa(xa),db=cb.length==xa.snippet_attachments.length,eb=xa.snippet_attachments.length===1&&xa.snippet_attachments[0].attach_type===n.VIDEO,fb=xa.snippet_attachments.length===1&&xa.snippet_attachments[0].metadata&&xa.snippet_attachments[0].metadata.type=='fb_voice_message',gb=xa.snippet_attachments.length===1&&xa.snippet_attachments[0].attach_type===n.STICKER,hb=xa.snippet_attachments.length===1&&xa.snippet_attachments[0].attach_type===n.SHARE,ib=xa.snippet_attachments.length===1&&xa.snippet_attachments[0].share_data_type===bb;ab(function(jb){var kb=null;if(db){var lb=aa[':fb:mercury:attachment-icon-text'].build().getRoot();if(cb.length===1){kb=za?"You sent a photo.":ma._("{name} sent a photo.",{name:jb});}else kb=za?ma._("You sent {num_photos} photos.",{num_photos:cb.length}):ma._("{name} sent {num_photos} photos.",{name:jb,num_photos:cb.length});g.addClass(lb,m.getAttachIconClass(cb[0].icon_type));h.appendContent(lb,kb);h.appendContent(ya,lb);}else if(eb){var mb=aa[':fb:mercury:attachment-icon-text'].build().getRoot();if(za){kb="You sent a video.";}else kb=ka._("{sender name} sent a video.",[ka.param("sender name",jb)]);g.addClass(mb,m.getAttachIconClass(xa.snippet_attachments[0].icon_type));h.appendContent(mb,kb);h.appendContent(ya,mb);}else if(fb){var nb=aa[':fb:mercury:attachment-icon-text'].build().getRoot();kb=za?"You sent a voice message.":ma._("{name} sent a voice message.",{name:jb});g.addClass(nb,m.getAttachIconClass(xa.snippet_attachments[0].icon_type));h.appendContent(nb,kb);h.appendContent(ya,nb);}else if(gb){if(sa(xa.snippet_attachments[0].metadata.stickerID)){kb=ja(j.symbols.like);}else kb=za?"You sent a sticker.":ma._("{name} sent a sticker.",{name:jb});h.appendContent(ya,kb);}else if(ib){var ob=aa[':fb:mercury:attachment-icon-text'].build().getRoot();kb=na.getOrionMercuryThreadAttachmentMetadataText(za,jb);g.addClass(ob,m.getAttachIconClass(xa.snippet_attachments[0].icon_type));h.appendContent(ob,kb);h.appendContent(ya,ob);}else if(hb){var pb=aa[':fb:mercury:attachment-icon-text'].build().getRoot();if(za){kb="You shared a link.";}else kb=ka._("{sender name} shared a link.",[ka.param("sender name",jb)]);g.addClass(pb,m.getAttachIconClass(xa.snippet_attachments[0].icon_type));h.appendContent(pb,kb);h.appendContent(ya,pb);}else xa.snippet_attachments.filter(function(qb){return qb.attach_type===n.FILE||qb.attach_type===n.PHOTO||qb.attach_type===n.VIDEO;}).forEach(function(qb){var rb=aa[':fb:mercury:attachment-icon-text'].build().getRoot();h.appendContent(rb,qb.name);g.addClass(rb,m.getAttachIconClass(qb.icon_type));h.appendContent(ya,rb);});});}function ua(wa,xa){ga(wa).forEach(function(ya){h.setContent(ya,xa);});}function va(wa,xa,ya,za){ya=ga(ya);if(xa.name){ya.forEach(function(bb){v.renderComponent(v.createElement(t,{thread:xa,viewer:wa._fbid,showUnreadCount:!!za.show_unread_count}),bb);});return;}var ab=xa.participants;if(xa.participants.length>1)ab=xa.participants.filter(function(bb){return bb!=u.getIDForUser(wa._fbid);});u.getMulti(ab,function(bb){s.renderParticipantListWithNoThreadName(wa._serverRequests.getServerThreadIDNow(xa.thread_id),xa,ab,bb,ya,za);});}e.exports=pa;},null);